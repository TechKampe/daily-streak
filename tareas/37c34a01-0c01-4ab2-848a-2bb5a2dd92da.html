<!doctype html><html lang="es"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no"><title>Paso a Paso | K√§mpe</title><link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;700&display=swap" rel="stylesheet"><style>
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
:root{--ctaBg:#0B214A;--ctaText:#00E6BC;--accent:#00E6BC;--ok:#04FFB4;--error:#F9577E;--shadow:0 8px 18px rgba(11,33,74,.25);--ui-scale:1;--cardH:90px;--chip:30px;--gap:10px;--fsTitle:clamp(18px,4.6vw,24px);--fsBody:clamp(14px,3.2vw,16px)}
html,body{height:100%;margin:0;font-family:'Baloo 2',system-ui,-apple-system,Segoe UI,Roboto,Ubuntu;background:#fff;color:#1A1B2F;overflow:hidden;overscroll-behavior:none}
button{font-family:inherit}
.scene{position:relative;display:flex;flex-direction:column;gap:8px;transform-origin:top center;transform:scale(var(--ui-scale));padding:0 14px calc(env(safe-area-inset-bottom)+8px) 14px}
@supports(height:100svh){.scene{height:100svh}}
@supports not (height:100svh){.scene{height:100dvh}}
@supports not (height:100dvh){.scene{height:100vh}}
.top-spacer{height:calc(80px + env(safe-area-inset-top));flex:0 0 auto}
.header{display:flex;align-items:center;justify-content:space-between;min-height:44px}
.progress{flex:1;display:flex;align-items:center;gap:10px}
.progress span{font-weight:700;font-size:clamp(14px,3.8vw,18px)}
.bar{height:8px;background:#EAFBFF;border:1px solid var(--accent);border-radius:8px;flex:1;position:relative;overflow:hidden}
.bar i{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--ok),#00E6BC);transition:width .3s}
.avatar{position:absolute;left:14px;top:8px;max-height:72px;opacity:.9;filter:drop-shadow(0 4px 10px rgba(0,0,0,.08))}
.title{font-weight:800;font-size:var(--fsTitle);margin:0}
.task{font-size:clamp(16px,4.2vw,18px);font-weight:700;margin-top:2px}
.board{flex:1;display:flex;flex-direction:column;gap:8px;touch-action:none}
.card{border:1px solid var(--accent);border-radius:14px;padding:10px 12px;display:grid;grid-template-columns:36px 1fr 56px;grid-template-rows:auto 30px;grid-template-areas:"pos text ctr""chips chips chips";align-items:center;min-height:var(--cardH);background:#fff;transition:transform .18s ease,box-shadow .18s}
.card.moving{transform:translateY(-2px);box-shadow:0 6px 16px rgba(11,33,74,.18)}
.pos{grid-area:pos;width:30px;height:30px;border-radius:999px;border:1px solid var(--accent);display:flex;align-items:center;justify-content:center;color:#00E6BC;font-weight:700}
.text{grid-area:text;font-size:var(--fsBody);font-weight:600;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.ctr{grid-area:ctr;display:flex;flex-direction:column;gap:8px;align-items:flex-end}
.ctrl{width:44px;height:36px;border-radius:12px;border:1px solid var(--accent);background:#fff;color:#0B214A;font-weight:800;box-shadow:none}
.ctrl:active{transform:translateY(1px)}
.chips{grid-area:chips;display:flex;gap:6px;flex-wrap:wrap;margin-top:6px}
.chip{min-width:var(--chip);height:var(--chip);border-radius:999px;border:1px solid var(--accent);background:#fff;color:#0B214A;font-weight:700;padding:0 10px}
.chip.sel{background:#C5FFDF;border-color:#00E6BC;color:#0B214A}
.cta{display:flex;gap:8px;justify-content:space-between;align-items:center}
.btn{flex:1;height:52px;background:var(--ctaBg);color:var(--ctaText);border:none;border-radius:24px;font-weight:800;font-size:clamp(16px,4.4vw,18px);box-shadow:var(--shadow)}
.btn[disabled]{opacity:.4;box-shadow:none}
.secondary{flex:0 0 auto;background:#fff;color:#0B214A;border:1px solid var(--accent);box-shadow:none;padding:0 16px}
.shake{animation:shake .18s linear 1}
@keyframes shake{0%,100%{transform:translateX(0)}20%{transform:translateX(-2px)}60%{transform:translateX(2px)}}
.toast{position:absolute;left:50%;transform:translateX(-50%);bottom:calc(72px + env(safe-area-inset-bottom) + 8px);background:#C5FFDF;color:#0B214A;border-radius:12px;padding:8px 12px;font-weight:700;border:1px solid #00E6BC;opacity:0;pointer-events:none;transition:opacity .2s,transform .2s}
.toast.show{opacity:1;transform:translate(-50%,-6px)}
.intro,.summary{position:fixed;inset:0;background:rgba(255,255,255,.96);display:flex;align-items:center;justify-content:center;padding:18px;z-index:10}
.panel{width:100%;max-width:720px;max-height:90svh;background:#fff;border:1px solid var(--accent);border-radius:16px;padding:16px 16px 18px 16px;overflow-y:auto}
.badge{display:inline-block;background:#C5FFDF;color:#0B214A;border-radius:12px;padding:6px 10px;border:1px solid #00E6BC;font-weight:700}
.panel h1{margin:0 0 6px 0;font-size:clamp(18px,5.2vw,24px)}
.panel p{margin:8px 0;font-size:var(--fsBody)}
.panel .mini{font-size:14px;color:#0B214A}
.panel .actions{display:flex;gap:10px;position:sticky;bottom:0;margin-top:10px;background:linear-gradient(180deg,transparent 0,#fff 30%);padding-top:8px}
.sr{position:absolute;left:-9999px}
.summary{overflow:auto}
.sum-wrap{width:100%;max-width:760px;margin:0 auto;padding:calc(env(safe-area-inset-top)+12px) 16px calc(env(safe-area-inset-bottom)+28px)}
.s-card{border:1px solid var(--accent);border-radius:14px;padding:12px;margin:12px 0}
.s-card h3{margin:0 0 6px 0;font-size:18px}
.order-row{display:flex;gap:6px;flex-wrap:wrap;margin:6px 0}
.tag{border:1px solid var(--accent);border-radius:12px;padding:4px 8px;font-size:14px}
.ok{color:#0B214A;border-color:#04FFB4;background:rgba(4,255,180,.1)}
.err{color:#0B214A;border-color:#F9577E;background:rgba(249,87,126,.1)}
.tip{background:#C5FFDF;border:1px solid #00E6BC;border-radius:12px;padding:8px 10px;margin-top:6px}
.summary .final{display:flex;gap:10px;position:sticky;bottom:0;background:linear-gradient(180deg,transparent 0,#fff 30%);padding-top:10px}
.compact .title{font-size:clamp(16px,3.8vw,18px)}
.compact .task{font-size:clamp(14px,3.6vw,16px)}
.compact .card{min-height:78px}
.compact .chip{min-width:26px;height:26px}
.compact .ctrl{height:32px}
.compact .btn{height:48px}
:focus-visible{outline:2px solid #00E6BC;outline-offset:2px}
</style></head><body>
<img class="avatar" src="https://techkampe.github.io/daily-streak/assets/Avatar 2_low.png" alt="Avatar" loading="eager">
<div class="scene" id="scene" aria-live="polite">
  <div class="top-spacer" aria-hidden="true"></div>
  <div class="header" aria-label="Encabezado de progreso">
    <div class="progress"><span id="progressLabel">Reto 1/3</span><div class="bar" aria-hidden="true"><i id="barFill"></i></div></div>
    <div style="width:100px;flex:0 0 100px" aria-hidden="true"></div>
  </div>
  <h2 class="title">Paso a Paso, Maestro del Oficio üõ†Ô∏è</h2>
  <div class="task" id="taskPrompt">Ordena los pasos: ‚Ä¶</div>
  <div class="board" id="board" role="list" aria-label="Lista de pasos para ordenar"></div>
  <div class="cta">
    <button class="btn secondary" id="shuffleBtn" aria-label="Reiniciar orden">Reordenar</button>
    <button class="btn" id="confirmBtn" aria-label="Confirmar orden">Confirmar orden</button>
  </div>
  <div class="toast" id="toast">Reto guardado. ¬°Vamos!</div>
</div>

<div class="intro" id="intro">
  <div class="panel" role="dialog" aria-modal="true" aria-labelledby="introTitle">
    <span class="badge">Desaf√≠o diario</span>
    <h1 id="introTitle">Paso a Paso, Maestro del Oficio üõ†Ô∏è</h1>
    <p class="mini">Est√°s en pr√°cticas: el orden importa para trabajar seguro y con eficiencia. En 3 turnos, ordena acciones reales de oficios t√©cnicos.</p>
    <p class="mini">Usa ‚Üë/‚Üì o elige el n√∫mero en cada tarjeta. Confirma para avanzar.</p>
    <div class="actions">
      <button class="btn" id="startBtn" aria-label="Empezar">¬°Listo, jugar!</button>
    </div>
  </div>
</div>

<div class="summary" id="summary" hidden>
  <div class="sum-wrap">
    <h1>Paso a Paso, Maestro del Oficio üõ†Ô∏è</h1>
    <p id="scoreTxt" class="mini"></p>
    <div id="results"></div>
    <div class="final">
      <button class="btn" onclick="completeTask()">Ver mi recompensa</button>
    </div>
  </div>
</div>

<script>
const root=document.documentElement,scene=document.getElementById('scene'),board=document.getElementById('board'),taskPrompt=document.getElementById('taskPrompt'),progressLabel=document.getElementById('progressLabel'),barFill=document.getElementById('barFill'),confirmBtn=document.getElementById('confirmBtn'),shuffleBtn=document.getElementById('shuffleBtn'),toast=document.getElementById('toast'),intro=document.getElementById('intro'),summary=document.getElementById('summary'),results=document.getElementById('results'),scoreTxt=document.getElementById('scoreTxt');
const MAX_LABEL=48;
function t(s){return s.length>MAX_LABEL?s.slice(0,MAX_LABEL-1)+"‚Ä¶":s}
const challenges=[
 {id:'elec',prompt:'Ordena los pasos: Cambiar un enchufe seguro',steps:['Cortar corriente en el magnetot√©rmico','Verificar ausencia de tensi√≥n','Conectar y fijar el nuevo enchufe','Restablecer corriente y probar'],explain:'Eliminamos el riesgo primero; luego comprobamos. Se interviene sin tensi√≥n y al final se rearma y prueba.',tip:'Usa un comprobador homologado, no buscapolos.'},
 {id:'plom',prompt:'Ordena los pasos: Desatascar el sif√≥n',steps:['Colocar cubo y guantes bajo el sif√≥n','Aflojar tuercas y retirar el sif√≥n','Limpiar residuos y juntas','Montar, ajustar y comprobar fugas'],explain:'Contienes el agua, desmontas y limpias. Montas con cuidado y verificas al final para evitar fugas.',tip:'Aprieta a mano: el exceso de fuerza da√±a juntas.'},
 {id:'call',prompt:'Ordena los pasos: Gestionar la llamada',steps:['Saludar e identificarte con la empresa','Escuchar y confirmar el problema','Pedir direcci√≥n y contacto','Proponer franja y registrar la visita'],explain:'Saludas y generas confianza. Confirmas el problema, tomas datos y cierras con cita y registro.',tip:'Repite en voz alta la direcci√≥n para confirmar.'}
].map(c=>({...c,steps:c.steps.map((s,i)=>({id:`${c.id}-${i}`,label:t(s)}))}));
let current=0,order=[],correctOrders=challenges.map(c=>c.steps.map(s=>s.id)),playerOrders=[];
function shuffle(a){const r=[...a];for(let i=r.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[r[i],r[j]]=[r[j],r[i]]}return r}
function renderChallenge(i,reshuffle=true){
 const ch=challenges[i];
 taskPrompt.textContent=ch.prompt;
 if(reshuffle||!order.length) order=shuffle(ch.steps);
 board.innerHTML='';
 order.forEach((step,idx)=>board.appendChild(cardEl(step,idx,order.length)));
 progressLabel.textContent=`Reto ${i+1}/${challenges.length}`;
 barFill.style.width=`${((i)/challenges.length)*100}%`;
 ensureFits();
}
function cardEl(step,idx,count){
 const c=document.createElement('div');c.className='card';c.setAttribute('role','listitem');c.setAttribute('data-id',step.id);
 const pos=document.createElement('div');pos.className='pos';pos.textContent=idx+1;c.appendChild(pos);
 const tx=document.createElement('div');tx.className='text';tx.textContent=step.label;c.appendChild(tx);
 const ctr=document.createElement('div');ctr.className='ctr';
 const up=document.createElement('button');up.className='ctrl';up.setAttribute('aria-label',`Subir paso ${idx+1}`);up.textContent='‚Üë';up.onclick=()=>move(idx,-1);
 const down=document.createElement('button');down.className='ctrl';down.setAttribute('aria-label',`Bajar paso ${idx+1}`);down.textContent='‚Üì';down.onclick=()=>move(idx,1);
 ctr.appendChild(up);ctr.appendChild(down);c.appendChild(ctr);
 const chips=document.createElement('div');chips.className='chips';
 for(let n=0;n<count;n++){const b=document.createElement('button');b.className='chip'+(n===idx?' sel':'');b.textContent=n+1;b.setAttribute('aria-label',`Mover a posici√≥n ${n+1}`);b.onclick=()=>moveTo(idx,n);chips.appendChild(b)}
 c.appendChild(chips);
 return c
}
function move(idx,delta){
 const ni=idx+delta;if(ni<0||ni>=order.length)return;
 board.classList.add('moving');setTimeout(()=>board.classList.remove('moving'),150);
 [order[idx],order[ni]]=[order[ni],order[idx]];
 renderChallenge(current,false)
}
function moveTo(from,to){
 if(from===to)return;
 const it=order.splice(from,1)[0];order.splice(to,0,it);
 renderChallenge(current,false)
}
function showToast(msg){toast.textContent=msg;toast.classList.add('show');setTimeout(()=>toast.classList.remove('show'),900)}
function onConfirm(){
 confirmBtn.classList.add('shake');setTimeout(()=>confirmBtn.classList.remove('shake'),200);
 const chosen=Array.from(board.children).map(c=>c.getAttribute('data-id'));
 playerOrders[current]=chosen;
 if(current<challenges.length-1){current++;renderChallenge(current,true);showToast('Reto guardado. ¬°Vamos!')}
 else{barFill.style.width='100%';setTimeout(()=>showSummary(),500)}
}
function showSummary(){
 enableScrollForSummary(true);
 scene.style.display='none';
 summary.hidden=false;
 let correctCount=0;results.innerHTML='';
 challenges.forEach((ch,idx)=>{
  const correct=correctOrders[idx],player=playerOrders[idx]||[];
  const isRight=correct.join('|')===player.join('|');if(isRight)correctCount++;
  const sc=document.createElement('div');sc.className='s-card';
  const h=document.createElement('h3');h.textContent=`Turno ${idx+1} ¬∑ ${ch.prompt.replace('Ordena los pasos: ','')}`;sc.appendChild(h);
  const status=document.createElement('div');status.className='tag '+(isRight?'ok':'err');status.textContent=isRight?'¬°Orden perfecto!':'Revisa el orden';sc.appendChild(status);
  const p1=document.createElement('div');p1.className='order-row';p1.innerHTML='<strong style="min-width:84px">Tu orden:</strong>';player.forEach((id,n)=>{const s=ch.steps.find(x=>x.id===id);const t=document.createElement('span');t.className='tag';t.textContent=`${n+1}. ${s?s.label:''}`;p1.appendChild(t)});sc.appendChild(p1);
  const p2=document.createElement('div');p2.className='order-row';p2.innerHTML='<strong style="min-width:84px">Correcto:</strong>';correct.forEach((id,n)=>{const s=ch.steps.find(x=>x.id===id);const t=document.createElement('span');t.className='tag';t.textContent=`${n+1}. ${s?s.label:''}`;p2.appendChild(t)});sc.appendChild(p2);
  const ex=document.createElement('p');ex.textContent=ch.explain;sc.appendChild(ex);
  const tip=document.createElement('div');tip.className='tip';tip.textContent='Consejo: '+ch.tip;sc.appendChild(tip);
  results.appendChild(sc);
 });
 scoreTxt.textContent=`Resultado: ${correctCount}/${challenges.length} secuencias en el orden correcto.`;
}
function enableScrollForSummary(on){
 if(on){document.documentElement.style.overflowY='auto';document.body.style.overflowY='auto';document.documentElement.style.overscrollBehavior='auto';document.body.style.overscrollBehavior='auto'}
 else{document.documentElement.style.overflow='hidden';document.body.style.overflow='hidden';document.documentElement.style.overscrollBehavior='none';document.body.style.overscrollBehavior='none'}
}
document.getElementById('startBtn').onclick=()=>{intro.remove();renderChallenge(current,true);ensureFits()}
confirmBtn.onclick=onConfirm;
shuffleBtn.onclick=()=>{order=shuffle(order);renderChallenge(current,false)}
function assertNoOverflow(){return scene.scrollHeight<=scene.clientHeight}
function applyCompactMode(){document.body.classList.add('compact')}
function fitBoardToViewport(){const ch=parseInt(getComputedStyle(root).getPropertyValue('--cardH'));if(ch>78)root.style.setProperty('--cardH','78px')}
function autoscaleUI(){let s=parseFloat(getComputedStyle(root).getPropertyValue('--ui-scale'));if(!s||s>1)s=1;while(!assertNoOverflow()&&s>0.88){s-=0.02;root.style.setProperty('--ui-scale',s.toFixed(2))}}
function ensureFits(){root.style.setProperty('--ui-scale','1');document.body.classList.remove('compact');root.style.setProperty('--cardH','90px');if(!assertNoOverflow()){applyCompactMode();if(!assertNoOverflow()){fitBoardToViewport();if(!assertNoOverflow()){autoscaleUI()}}}}
window.addEventListener('resize',ensureFits);window.addEventListener('orientationchange',ensureFits);
</script>
<script>
function completeTask(){if(window.ReactNativeWebView){window.ReactNativeWebView.postMessage(JSON.stringify({action:'TASK_COMPLETED'}))}}
</script>
</body></html>