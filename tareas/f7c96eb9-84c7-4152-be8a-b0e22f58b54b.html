<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Entrevista con el reclutador el√©ctrico ‚Äî K√§mpe</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="color-scheme" content="light dark">
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@500;700;800&display=swap" rel="stylesheet">
  <style>
    /* ============== Reset + Layout base ============== */
    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; padding: 0; overflow: hidden; overscroll-behavior: none; background: #0d1b3d; }
    :root{
      --blue-900:#0a1640;
      --blue-800:#152a76;
      --blue-700:#1b43d6;
      --cyan:#2ad8ff;
      --lime:#9dff57;
      --pink:#ff4d9a;
      --yellow:#ffd44d;
      --glass: rgba(255,255,255,0.12);
      --glass-strong: rgba(255,255,255,0.18);
      --text:#f5f7ff;
      --muted:#b8c2ff;
      --ok:#39ff88;
      --warn:#ffd44d;
      --bad:#ff6b6b;
      --shadow: 0 8px 24px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.08);
    }

    /* Fortnite-like vibrant gradient background */
    body::before{
      content:"";
      position:fixed; inset:0;
      background:
        radial-gradient(1200px 600px at 80% -10%, rgba(90,160,255,.35), transparent 60%),
        radial-gradient(900px 700px at -10% 10%, rgba(42,216,255,.25), transparent 50%),
        linear-gradient(135deg, var(--blue-900), #0e2a88 60%, #0f41ff 120%);
      z-index:-1;
    }

    .scene{
      width: 100%;
      display: grid;
      grid-template-rows: auto 1fr auto;
      padding: env(safe-area-inset-top) 12px calc(env(safe-area-inset-bottom));
      gap: 10px;
      contain: layout size;
      touch-action: none;
    }
    /* Safe viewport height with fallbacks */
    @supports (height: 100svh) { .scene { height: 100svh; } }
    @supports not (height: 100svh) { .scene { height: 100dvh; } }
    @supports not (height: 100dvh) { .scene { height: 100vh; } }

    header.app{
      display:flex; align-items:center; justify-content:space-between;
      padding: 8px 8px;
      background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.06));
      backdrop-filter: blur(10px);
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.18);
      box-shadow: var(--shadow);
      min-height: 56px;
    }
    .branding{ display:flex; align-items:center; gap:10px; min-width: 0;}
    .branding img{ width:34px; height:34px; object-fit:contain; filter: drop-shadow(0 2px 6px rgba(0,0,0,.4)); }
    .title{
      font-family: Manrope, system-ui, sans-serif;
      color: var(--text);
      font-weight: 800;
      font-size: clamp(14px, 3.6vw, 18px);
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
      letter-spacing:.2px;
    }

    .progress{
      color: var(--cyan);
      font-family: Manrope, system-ui, sans-serif;
      font-weight: 700;
      font-size: clamp(12px, 3.5vw, 14px);
      padding: 6px 10px;
      border-radius: 999px;
      background: linear-gradient(180deg, rgba(42,216,255,.18), rgba(42,216,255,.08));
      border: 1px solid rgba(42,216,255, .35);
      box-shadow: inset 0 0 12px rgba(42,216,255,.15);
      min-width:56px; text-align:center;
    }

    /* Chat area */
    .chat{
      position: relative;
      display:flex; flex-direction: column; justify-content: center; align-items: stretch;
      gap: 12px;
      padding: 8px;
      overflow: hidden; /* no scroll in gameplay */
    }

    .bubble{
      display:flex; gap:10px; align-items:flex-start;
      background: var(--glass);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,.16);
      border-radius: 16px;
      padding: 10px 12px;
      color: var(--text);
      box-shadow: var(--shadow);
      max-width: 100%;
    }
    .bubble .avatar{
      width: 40px; height: 40px; border-radius: 10px; object-fit: cover;
      border:1px solid rgba(255,255,255,.2);
      background: rgba(255,255,255,.06);
      flex: 0 0 auto;
    }
    .bubble .content{ min-width: 0; }
    .bubble .name{
      font-family: Manrope, system-ui, sans-serif; font-weight: 800;
      font-size: clamp(12px, 3.4vw, 14px);
      color: #e7ecff; margin-bottom: 2px; letter-spacing:.2px;
    }
    .bubble .text{
      font-family: Manrope, system-ui, sans-serif; font-weight: 600;
      font-size: clamp(13px, 3.8vw, 16px);
      line-height: 1.2; color: #f7fbff;
    }

    /* Choices */
    .choices{
      display:flex; flex-direction: column; gap: 8px;
      position: relative;
      padding: 8px 0 calc(env(safe-area-inset-bottom) + 2px);
    }
    .btn{
      -webkit-tap-highlight-color: transparent;
      display:flex; gap:10px; align-items:center; justify-content:center;
      border: 0; border-radius: 12px; padding: 12px 14px;
      min-height: 48px;
      font-family: Manrope, system-ui, sans-serif; font-weight: 800;
      font-size: clamp(14px, 4vw, 16px);
      color: #0a1030; text-shadow: none;
      cursor: pointer; transition: transform .06s ease, box-shadow .12s ease, filter .12s ease;
      outline: 2px solid transparent; outline-offset: 2px;
    }
    .btn:focus-visible{ outline-color: #fff; box-shadow: 0 0 0 3px rgba(42,216,255,.6) inset; }
    .btn:hover{ filter: brightness(1.04); }
    .btn:active{ transform: translateY(1px) scale(.995); }
    .btn.correct { background: linear-gradient(180deg, #80ffcc, #2cfaa0); box-shadow: 0 6px 16px rgba(44,250,160,.35); }
    .btn.partial { background: linear-gradient(180deg, #ffe88e, #ffc84f); box-shadow: 0 6px 16px rgba(255,200,79,.35); }
    .btn.wrong { background: linear-gradient(180deg, #ff9db4, #ff6b6b); box-shadow: 0 6px 16px rgba(255,107,107,.35); }
    .btn.neutral { background: linear-gradient(180deg, #a6c4ff, #5aa0ff); box-shadow: 0 6px 16px rgba(90,160,255,.35); color: #071231;}
    .btn[disabled]{ opacity:.7; pointer-events:none; }

    /* Reaction Toast */
    .reaction{
      position: absolute; inset: auto 12px 44% 12px;
      display: none; align-items:center; gap:10px;
      padding: 10px 12px; border-radius: 12px;
      background: var(--glass-strong); border:1px solid rgba(255,255,255,.22);
      backdrop-filter: blur(10px);
      color: var(--text);
      box-shadow: var(--shadow);
      animation: pop .16s ease;
    }
    .reaction img{ width:28px; height:28px; border-radius:8px; border:1px solid rgba(255,255,255,.2); }
    .reaction .rtext{ font-family: Manrope, system-ui; font-weight: 700; font-size: clamp(12px,3.6vw,14px); }
    @keyframes pop { from { transform: translateY(6px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

    /* Intro screen */
    .introCard{
      display:flex; flex-direction: column; justify-content:center; align-items:stretch; gap:12px;
      padding: 12px; border-radius: 16px;
      background: var(--glass); border:1px solid rgba(255,255,255,.16);
      box-shadow: var(--shadow);
      margin: 6px 0;
      min-height: min(54vh, 420px);
    }
    .introTitle{
      font-family: Manrope; font-weight: 800; color: var(--text);
      font-size: clamp(18px, 5.2vw, 24px); line-height:1.1;
      text-wrap: balance;
    }
    .introDesc{
      font-family: Manrope; font-weight: 600; color: var(--muted);
      font-size: clamp(13px, 3.8vw, 16px);
    }
    .tutorial{
      font-family: Manrope; font-weight: 700; color: #eaffff;
      font-size: clamp(12px, 3.6vw, 14px);
      background: linear-gradient(180deg, rgba(42,216,255,.18), rgba(42,216,255,.08));
      border:1px solid rgba(42,216,255,.3);
      border-radius: 12px; padding: 10px 12px;
    }
    .startRow{ display:flex; gap:8px; }
    .startBtn{ width:100%; }
    .legend{
      display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-top:4px;
      color: #dfe6ff; font-family: Manrope; font-weight:700; font-size: clamp(11px,3.2vw,13px);
      opacity:.92;
    }
    .legend img{ width:22px; height:22px; border-radius:6px; border:1px solid rgba(255,255,255,.2); }

    /* Results screen */
    .results{
      display:none; flex-direction: column; gap:12px;
      padding: 8px 0 16px;
    }
    .scoreCard, .decision, .mentorCard{
      background: var(--glass); border:1px solid rgba(255,255,255,.16);
      backdrop-filter: blur(10px);
      border-radius: 16px; padding: 12px; box-shadow: var(--shadow);
    }
    .scoreTitle{
      font-family: Manrope; font-weight:800; color:var(--text);
      font-size: clamp(16px, 4.8vw, 20px); margin-bottom: 8px;
    }
    .chips{ display:flex; gap:8px; flex-wrap:wrap; }
    .chip{
      padding: 6px 10px; border-radius: 999px; font-family: Manrope; font-weight:800;
      font-size: clamp(11px,3.3vw,13px); color:#071231;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.2);
    }
    .chip.ok{ background: #2cfaa0; }
    .chip.partial{ background: #ffc84f; }
    .chip.bad{ background: #ff6b6b; color:#140a0a; }

    .decision{
      display:grid; grid-template-columns: auto 1fr; gap:10px; align-items:start;
    }
    .decision .index{
      width:28px; height:28px; border-radius: 8px;
      display:flex; align-items:center; justify-content:center;
      font-family: Manrope; font-weight:900; font-size: 14px; color:#071231;
      background: #a6c4ff; box-shadow: inset 0 1px 0 rgba(255,255,255,.3);
    }
    .decision .dtitle{
      font-family: Manrope; font-weight:800; color:#e7ecff;
      font-size: clamp(13px,3.8vw,16px);
    }
    .decision .dchoice{
      font-family: Manrope; font-weight:700; color:#0a1030;
      font-size: clamp(12px,3.6vw,14px);
      padding: 6px 8px; border-radius: 10px; margin: 6px 0 4px;
      display:inline-flex; align-items:center; gap:6px;
    }
    .decision .dexp{
      font-family: Manrope; font-weight:600; color:#dfe6ff;
      font-size: clamp(12px,3.4vw,14px); line-height:1.25;
    }
    .tag-ok{ background:#2cfaa0; }
    .tag-partial{ background:#ffc84f; }
    .tag-bad{ background:#ff6b6b; color:#140a0a; }

    .mentorCard{ display:flex; gap:10px; align-items:flex-start; }
    .mentorCard img{ width:40px; height:40px; border-radius:10px; border:1px solid rgba(255,255,255,.2); }
    .mentorCard .mtext{
      font-family: Manrope; font-weight:700; color:#f7fbff;
      font-size: clamp(13px,3.8vw,16px); line-height:1.2;
    }

    .rewardBar{ display:flex; gap:10px; align-items:center; }
    .rewardBtn{
      width:100%;
      text-align:center;
      text-decoration:none;
      color:#071231;
      font-family: Manrope; font-size: clamp(14px,4.2vw,16px); font-weight: 900;
      padding: 12px 14px; border-radius: 12px;
      background: linear-gradient(180deg, #9dff57, #4cff94);
      box-shadow: 0 8px 18px rgba(77,255,148,.35);
      border:0;
      display:inline-block;
    }
    .warnInit{
      color:#ffe88e; font-family: Manrope; font-weight:700; font-size: clamp(11px,3.2vw,13px);
    }

    /* Small helper for accessibility */
    .sr-only{
      position:absolute !important; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0;
    }

    /* Responsive tune (mobile-first; looks fine on 320x640) */
  </style>
</head>
<body>
  <!-- Intro Scene -->
  <section class="scene" id="introScene" role="dialog" aria-label="Introducci√≥n al reto">
    <header class="app" aria-label="Barra superior">
      <div class="branding">
        <img src="https://techkampe.github.io/daily-streak/assets/kampe_logo_blanco.png" alt="K√§mpe" />
        <div class="title">Entrevista con el reclutador el√©ctrico</div>
      </div>
      <div class="progress" aria-hidden="true">Ready</div>
    </header>

    <div class="introCard" role="group" aria-label="Descripci√≥n y tutorial">
      <div class="introTitle">Simulaci√≥n breve de entrevista</div>
      <div class="introDesc">Practica respuestas profesionales para un puesto de aprendiz electricista. Toma buenas decisiones sobre motivaci√≥n, trato al cliente y seguridad.</div>
      <div class="tutorial">C√≥mo jugar: elige una respuesta por pantalla y observa la reacci√≥n. Sin scroll durante el juego.</div>

      <div class="legend" aria-label="Personajes">
        <img src="https://techkampe.github.io/daily-streak/assets/Avatar%203_low.png" alt="Reclutador" loading="lazy"> Reclutador
        <img src="https://techkampe.github.io/daily-streak/assets/Avatar%201_low.png" alt="Mentor" loading="lazy"> Mentor
      </div>

      <div class="startRow">
        <button class="btn neutral startBtn" id="startBtn" aria-label="Empezar la entrevista">Empezar</button>
      </div>
    </div>

    <div style="height:1px;"></div>

    <div class="choices" aria-hidden="true">
      <button class="btn neutral" style="opacity:.4; pointer-events:none;">Listo</button>
    </div>
  </section>

  <!-- Gameplay Scene -->
  <section class="scene" id="gameScene" role="application" aria-label="Entrevista interactiva" style="display:none;">
    <header class="app">
      <div class="branding">
        <img src="https://techkampe.github.io/daily-streak/assets/kampe_logo_blanco.png" alt="" />
        <div class="title">Entrevista con el reclutador el√©ctrico</div>
      </div>
      <div class="progress" id="progress">1/5</div>
    </header>

    <div class="chat" id="chat">
      <!-- Bubbles get injected -->
      <div class="reaction" id="reaction" aria-live="polite">
        <img src="https://techkampe.github.io/daily-streak/assets/Avatar%203_low.png" alt="" loading="lazy">
        <div class="rtext">...</div>
      </div>
    </div>

    <div class="choices" id="choices" role="group" aria-label="Opciones de respuesta">
      <!-- Option buttons get injected -->
    </div>
  </section>

  <!-- Results Scene -->
  <section class="scene" id="resultScene" role="document" aria-label="Resultados de la entrevista" style="display:none;">
    <header class="app">
      <div class="branding">
        <img src="https://techkampe.github.io/daily-streak/assets/kampe_logo_blanco.png" alt="" />
        <div class="title">Tu resultado</div>
      </div>
      <div class="progress" id="resultSummary">5/5</div>
    </header>

    <div class="results" id="resultsList" aria-live="polite">
      <!-- Filled by JS -->
    </div>

    <div class="choices">
      <div class="rewardBar">
        <a id="rewardLink" class="rewardBtn" href="#" aria-label="Ver mi recompensa">Ver mi recompensa</a>
      </div>
      <div id="initWarn" class="warnInit" style="display:none;">Aviso: falta initData en la URL. A√∫n puedes ver la recompensa.</div>
    </div>
  </section>

  <span class="sr-only" id="ariaStatus" aria-live="polite"></span>

  <script>
    /* =========================
       K√§mpe ‚Äî Visual Novel Chat
       ========================= */

    // Keep exactly the raw initData substring if present
    const rawInitData = (location.search.match(/[?&]initData=([^&]+)/) || [])[1] || '';
    // Control scroll per scene
    function lockGameplayScroll() {
      document.documentElement.style.overflow = 'hidden';
      document.body.style.overflow = 'hidden';
    }
    function enableResultsScroll() {
      document.documentElement.style.overflowY = 'auto';
      document.body.style.overflowY = 'auto';
    }
    lockGameplayScroll();

    // Avatars mapping
    const AVATARS = {
      mentor: "https://techkampe.github.io/daily-streak/assets/Avatar%201_low.png",
      recruiter: "https://techkampe.github.io/daily-streak/assets/Avatar%203_low.png",
      apprentice: "https://techkampe.github.io/daily-streak/assets/Avatar%202_low.png",
      client: "https://techkampe.github.io/daily-streak/assets/Avatar%204_low.png"
    };

    // Turns data (5 turns)
    const TURNS = [
      {
        key: "motivaci√≥n",
        speaker: "Reclutador",
        avatar: AVATARS.recruiter,
        lines: [
          "¬øQu√© te motiva para este aprendizaje?"
        ],
        options: [
          {
            text: "Aprender con profesionales y crecer; el dinero llega con el buen trabajo.",
            tag: "correct",
            react: "Bien, actitud de crecimiento. üëç",
            why: "Pones el foco en aprendizaje, calidad y progreso: se√±ales de compromiso a largo plazo."
          },
          {
            text: "Necesito dinero ya, eso es lo principal.",
            tag: "partial",
            react: "Entiendo la realidad, pero busco m√°s que eso. ü§î",
            why: "Ser honesto es v√°lido, pero en entrevista equilibra con ganas de aprender y aportar valor."
          },
          {
            text: "Prefiero trabajar solo; as√≠ nadie me molesta.",
            tag: "wrong",
            react: "El trabajo en equipo es clave aqu√≠. ‚ö†Ô∏è",
            why: "Los oficios requieren coordinaci√≥n y comunicaci√≥n; la colaboraci√≥n es esencial."
          }
        ]
      },
      {
        key: "cliente",
        speaker: "Reclutador",
        avatar: AVATARS.recruiter,
        lines: [
          "Un cliente apurado te pide saltarte pruebas. ¬øQu√© haces?"
        ],
        options: [
          {
            text: "Explico que las pruebas garantizan seguridad y priorizo sin saltarlas.",
            tag: "correct",
            react: "Eso es: seguridad primero. ‚úÖ",
            why: "Nunca se negocia la seguridad; comunicar alternativas y priorizar es profesional."
          },
          {
            text: "Hago solo las cr√≠ticas y documento el resto para otra visita.",
            tag: "partial",
            react: "Mejor que nada, pero a√∫n arriesgado. üü°",
            why: "Priorizar ayuda, pero cualquier omisi√≥n debe acordarse formalmente y sin comprometer seguridad."
          },
          {
            text: "Las omito si firma un papel de exenci√≥n.",
            tag: "wrong",
            react: "No es aceptable. ‚ùå",
            why: "Un papel no elimina riesgos ni tu responsabilidad t√©cnica y legal."
          }
        ]
      },
      {
        key: "seguridad",
        speaker: "Reclutador",
        avatar: AVATARS.recruiter,
        lines: [
          "Ves a un compa√±ero trabajar con tensi√≥n para ahorrar tiempo. ¬øC√≥mo reaccionas?"
        ],
        options: [
          {
            text: "Detengo el trabajo, aplico bloqueo/etiquetado y aviso al responsable.",
            tag: "correct",
            react: "Procedimiento correcto. üõëüîí",
            why: "Intervenir, asegurar la energ√≠a (LOTO) y escalar evita incidentes graves."
          },
          {
            text: "Le digo que tenga cuidado y sigo a lo m√≠o.",
            tag: "wrong",
            react: "Insuficiente ante un riesgo cr√≠tico. ‚ö†Ô∏è",
            why: "Advertir sin asegurar la energ√≠a mantiene el peligro; act√∫a y escala."
          },
          {
            text: "Solo digo algo si el jefe est√° cerca.",
            tag: "wrong",
            react: "La seguridad no depende de quien mire. üö´",
            why: "La responsabilidad es de todos, en todo momento."
          }
        ]
      },
      {
        key: "diagn√≥stico",
        speaker: "Reclutador",
        avatar: AVATARS.recruiter,
        lines: [
          "Una l√°mpara parpadea. ¬øCu√°l es tu primer paso?"
        ],
        options: [
          {
            text: "Confirmar: revisar l√°mpara/portal√°mparas y conexiones; luego medir tensi√≥n.",
            tag: "correct",
            react: "Enfoque ordenado. ‚úîÔ∏è",
            why: "Validar lo simple antes de medir reduce errores y costes; luego medici√≥n segura."
          },
          {
            text: "Saco el mult√≠metro y mido sin m√°s.",
            tag: "partial",
            react: "Falta confirmar lo b√°sico. üü°",
            why: "Medir ayuda, pero primero descarta fallos obvios y fisuras mec√°nicas."
          },
          {
            text: "Cambio todo el circuito directo.",
            tag: "wrong",
            react: "Soluci√≥n dr√°stica e ineficiente. ‚ùå",
            why: "Diagnosticar evita reemplazos innecesarios y tiempos muertos."
          }
        ]
      },
      {
        key: "aprendizaje",
        speaker: "Reclutador",
        avatar: AVATARS.recruiter,
        lines: [
          "Te piden una tarea que a√∫n no dominas. ¬øQu√© respondes?"
        ],
        options: [
          {
            text: "Reconozco el l√≠mite, pido gu√≠a y me preparo antes de intentarlo.",
            tag: "correct",
            react: "Responsable y proactivo. ‚úÖ",
            why: "Transparencia + aprendizaje guiado = calidad y seguridad."
          },
          {
            text: "Digo que s√≠ y aprendo sobre la marcha sin molestar.",
            tag: "wrong",
            react: "Riesgo de errores y seguridad. ‚õî",
            why: "Sin supervisi√≥n aumenta el riesgo t√©cnico y de seguridad."
          },
          {
            text: "Prefiero postergarlo; quiz√° lo haga otro.",
            tag: "partial",
            react: "Te falta proactividad. üü°",
            why: "Saber decir 'no' es sano, pero ofrece alternativas y plan de aprendizaje."
          }
        ]
      }
    ];

    // State
    let current = 0;
    const decisions = []; // {key, choice, tag, why}
    const chatEl = document.getElementById('chat');
    const choicesEl = document.getElementById('choices');
    const progressEl = document.getElementById('progress');
    const reactionEl = document.getElementById('reaction');
    const reactionText = reactionEl?.querySelector('.rtext');
    const ariaStatus = document.getElementById('ariaStatus');

    function $(sel){ return document.querySelector(sel); }

    // Intro start
    $('#startBtn').addEventListener('click', () => {
      $('#introScene').style.display = 'none';
      $('#gameScene').style.display = 'grid';
      current = 0;
      renderTurn();
    });

    // Render a single turn
    function renderTurn(){
      const turn = TURNS[current];
      // Progress
      progressEl.textContent = `${current+1}/${TURNS.length}`;
      // Clear chat and choices
      chatEl.querySelectorAll('.bubble').forEach(b=>b.remove());
      choicesEl.innerHTML = '';
      // Messages (1-2 bubbles)
      turn.lines.forEach(line => {
        chatEl.insertAdjacentHTML('beforeend', bubbleHTML(turn.speaker, turn.avatar, line));
      });
      // Options (2-3 big buttons)
      const shuffled = turn.options.map(o => ({...o}));
      // Keep order for clarity; if needed, could shuffle lightly
      shuffled.forEach((opt, idx) => {
        const btn = document.createElement('button');
        btn.className = 'btn neutral';
        btn.setAttribute('aria-label', `Opci√≥n ${idx+1}: ${opt.text}`);
        btn.textContent = opt.text;
        btn.style.whiteSpace = 'normal';
        btn.addEventListener('click', () => selectOption(opt, btn));
        choicesEl.appendChild(btn);
      });
      // Make sure reaction hidden
      reactionEl.style.display = 'none';
      ariaStatus.textContent = `Turno ${current+1} de ${TURNS.length}. Pregunta del reclutador.`;
    }

    function bubbleHTML(name, avatar, text){
      return `
        <div class="bubble">
          <img class="avatar" src="${avatar}" alt="${name}" loading="lazy">
          <div class="content">
            <div class="name">${name}</div>
            <div class="text">${text}</div>
          </div>
        </div>
      `;
    }

    function selectOption(opt, btn){
      // Lock buttons, color the selected one by tag
      [...choicesEl.children].forEach(b => b.disabled = true);
      btn.classList.remove('neutral');
      btn.classList.add(opt.tag === 'correct' ? 'correct' : opt.tag === 'partial' ? 'partial' : 'wrong');

      // Show reaction
      reactionText.textContent = opt.react;
      reactionEl.style.display = 'flex';
      // Record decision
      decisions.push({
        key: TURNS[current].key,
        choice: opt.text,
        tag: opt.tag,
        why: opt.why
      });

      // Auto-advance
      setTimeout(() => {
        reactionEl.style.display = 'none';
        current++;
        if(current < TURNS.length){
          renderTurn();
        } else {
          finishGame();
        }
      }, 1000);
    }

    function finishGame(){
      $('#gameScene').style.display = 'none';
      const res = $('#resultsList');
      res.innerHTML = '';
      // Score
      const ok = decisions.filter(d=>d.tag==='correct').length;
      const partial = decisions.filter(d=>d.tag==='partial').length;
      const bad = decisions.filter(d=>d.tag==='wrong').length;

      // Header summary
      $('#resultSummary').textContent = `${ok}/${TURNS.length}`;
      res.insertAdjacentHTML('beforeend', `
        <div class="scoreCard">
          <div class="scoreTitle">Tu entrevista</div>
          <div class="chips">
            <div class="chip ok">‚úîÔ∏é Correctas: ${ok}</div>
            <div class="chip partial">‚âà Parciales: ${partial}</div>
            <div class="chip bad">‚úñÔ∏é A mejorar: ${bad}</div>
          </div>
        </div>
      `);

      // Decisions list
      decisions.forEach((d, i) => {
        const tagClass = d.tag === 'correct' ? 'tag-ok' : d.tag === 'partial' ? 'tag-partial' : 'tag-bad';
        const tagLabel = d.tag === 'correct' ? 'Correcta' : d.tag === 'partial' ? 'Parcial' : 'Incorrecta';
        const title = prettyKey(d.key);
        res.insertAdjacentHTML('beforeend', `
          <div class="decision" aria-label="Decisi√≥n ${i+1}">
            <div class="index">${i+1}</div>
            <div>
              <div class="dtitle">${title}</div>
              <div class="dchoice ${tagClass}">${tagLabel}: ${d.choice}</div>
              <div class="dexp">${d.why}</div>
            </div>
          </div>
        `);
      });

      // Mentor tip (dynamic)
      const tip = mentorTip(ok, partial, bad);
      res.insertAdjacentHTML('beforeend', `
        <div class="mentorCard">
          <img src="${AVATARS.mentor}" alt="Mentor">
          <div class="mtext">
            ${tip}
          </div>
        </div>
      `);

      // Reward link
      const link = document.getElementById('rewardLink');
      const warn = document.getElementById('initWarn');
      let url = "https://kampe-game-phaser.onrender.com/daily_streak?initData=" + (rawInitData || "");
      link.href = url;
      if(!rawInitData){ warn.style.display = 'block'; }

      // Show results scene and enable scroll only here
      $('#resultScene').style.display = 'grid';
      enableResultsScroll();
      // Make results column scrollable while keeping footer visible
      document.getElementById('resultsList').style.overflowY = 'auto';
    }

    function prettyKey(k){
      switch(k){
        case 'motivaci√≥n': return 'Motivaci√≥n personal';
        case 'cliente': return 'Trato con el cliente';
        case 'seguridad': return 'Fallo en seguridad';
        case 'diagn√≥stico': return 'Diagn√≥stico inicial';
        case 'aprendizaje': return 'Aprendizaje y l√≠mites';
      }
      return k;
    }

    function mentorTip(ok, partial, bad){
      // Tailor message to performance
      if(ok >= 4){
        return "Mentor: Gran trabajo. Mant√©n esa claridad al explicar seguridad y tu plan de aprendizaje. Lleva ejemplos concretos de trabajos o pr√°cticas: suman puntos en la entrevista.";
      } else if(ok === 3){
        return "Mentor: Vas por buen camino. Refuerza c√≥mo priorizas la seguridad y c√≥mo gestionas expectativas del cliente. Practica respuestas breves con estructura: situaci√≥n ‚Üí acci√≥n ‚Üí resultado.";
      } else {
        return "Mentor: Revisa fundamentos de seguridad (LOTO) y c√≥mo comunicarte con clientes bajo presi√≥n. Prep√°rate con 2‚Äì3 ejemplos y recuerda: sin seguridad no hay trabajo.";
      }
    }

    // Accessibility: keyboard friendly navigation hint (optional)
    document.addEventListener('keydown', (e)=>{
      if(e.key === 'Enter'){
        const sceneIntro = document.getElementById('introScene');
        if(sceneIntro && sceneIntro.style.display !== 'none'){
          document.getElementById('startBtn').click();
        }
      }
    });

    // Performance: preconnect images lazily (avatars already small)
    // Mental test: target 320√ó640 no scroll during gameplay ensured by layout grid and overflow hidden.

  </script>
</body>
</html>