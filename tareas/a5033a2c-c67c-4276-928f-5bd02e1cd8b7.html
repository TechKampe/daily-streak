<!DOCTYPE html><html lang="es"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;700&display=swap" rel="stylesheet"><style>
*{box-sizing:border-box}html,body{height:100%;background:#fff;color:#1A1B2F;font-family:"Baloo 2",system-ui,Segoe UI,Roboto,Arial,sans-serif;-webkit-tap-highlight-color:transparent}
html.lock,body.lock{overflow:hidden;overscroll-behavior:none}
:root{--accent:#00E6BC;--ink:#1A1B2F;--cta:#0B214A;--ok:#04FFB4;--err:#F9577E;--ui-scale:1;--cardH:84px;--gap:10px}
.scene{position:relative;width:100%;padding: max(env(safe-area-inset-top),16px) max(env(safe-area-inset-right),16px) max(env(safe-area-inset-bottom),16px) max(env(safe-area-inset-left),16px);display:flex;align-items:stretch;justify-content:center;touch-action:none;transform:translateZ(0)}
@supports(height:100svh){.scene{height:100svh}}
@supports not (height:100svh){@supports(height:100dvh){.scene{height:100dvh}}}
@supports not (height:100dvh){.scene{height:100vh}}
.scaleWrap{transform:scale(var(--ui-scale));transform-origin:top center;flex:1;display:flex;flex-direction:column;max-width:560px;margin:0 auto;position:relative}
.safeTop{height:80px;width:100%}
.cornerGuard{position:absolute;top:0;right:0;width:100px;height:100px;pointer-events:none}
.header{display:flex;align-items:center;justify-content:space-between;margin:6px 0 8px 0;padding-right:110px}
.progress{font-weight:700;color:#00E6BC;font-size:clamp(14px,3.8vw,16px)}
.h1{font-size:clamp(18px,5vw,28px);line-height:1.05;font-weight:700;letter-spacing:.2px;margin:2px 0 6px 0;color:#1A1B2F}
.subtitle{font-size:clamp(13px,3.5vw,15px);opacity:.9;margin-bottom:6px;line-height:1.2;max-width:90%}
.avatar{position:absolute;right:8px;top:110px;opacity:.12;max-width:140px;width:32vw;min-width:110px;pointer-events:none;user-select:none}
.board{flex:1;display:flex;flex-direction:column;gap:var(--gap);justify-content:center}
.card{position:relative;display:grid;grid-template-columns:1fr auto;align-items:center;min-height:var(--cardH);padding:10px 12px;border:1px solid var(--accent);border-radius:14px;background:#fff;box-shadow:0 2px 6px rgba(11,33,74,.06);transition:transform .12s ease,box-shadow .12s ease}
.card:focus-within{outline:2px solid #C5FFDF}
.card.bump{animation:bump .18s ease}
@keyframes bump{0%{transform:scale(.98)}100%{transform:scale(1)}}
.left{display:flex;gap:10px;align-items:center}
.idx{min-width:28px;height:28px;border-radius:999px;background:#C5FFDF;color:#0B214A;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:14px;border:1px solid #00E6BC}
.txt{font-size:clamp(14px,3.8vw,16px);line-height:1.15;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;word-break:keep-all}
.controls{display:flex;flex-direction:column;gap:6px;margin-left:10px}
.ctrl{width:44px;height:44px;border-radius:12px;border:1px solid var(--accent);background:#fff;color:#0B214A;font-weight:700;font-size:18px;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 10px rgba(11,33,74,.12)}
.ctrl:active{transform:translateY(1px)}
.chips{grid-column:1/-1;display:flex;gap:6px;margin:6px 0 0 38px;flex-wrap:wrap}
.chip{min-width:32px;height:32px;border-radius:999px;border:1px dashed var(--accent);background:#fff;color:#0B214A;font-weight:700;font-size:14px;display:flex;align-items:center;justify-content:center;opacity:.9}
.chip.sel{background:#C5FFDF;color:#0B214A;border-style:solid}
.footer{display:flex;gap:10px;align-items:center;justify-content:space-between;margin-top:8px}
.cta{flex:1;height:52px;border-radius:24px;background:#0B214A;color:#00E6BC;border:none;font-weight:800;font-size:clamp(15px,4.5vw,18px);box-shadow:0 8px 18px rgba(11,33,74,.25)}
.cta:disabled{opacity:.45;box-shadow:none}
.cta.vibe{animation:vibe .18s linear 1}
@keyframes vibe{0%,100%{transform:translateX(0)}25%{transform:translateX(-1px)}75%{transform:translateX(1px)}}
.hint{padding:8px 10px;border-radius:12px;background:#C5FFDF;color:#0B214A;border:1px solid #00E6BC;font-size:13px}
.modal{position:fixed;inset:0;background:rgba(26,27,47,.12);display:flex;align-items:center;justify-content:center;padding:18px;z-index:50}
.modalCard{max-height:90svh;max-width:560px;width:100%;background:#fff;border:1px solid var(--accent);border-radius:16px;padding:18px;overflow-y:auto;box-shadow:0 12px 30px rgba(11,33,74,.18)}
.modal h2{font-size:clamp(20px,6vw,28px);margin:4px 0 6px 0;color:#1A1B2F}
.modal p{font-size:clamp(14px,4vw,16px);line-height:1.25;margin:8px 0}
.modal .mini{font-size:13px;background:#C5FFDF;border-radius:12px;padding:8px;border:1px solid #00E6BC}
.modal .start{margin-top:10px}
.toast{position:fixed;left:50%;bottom:18px;transform:translateX(-50%);background:#C5FFDF;border:1px solid #00E6BC;color:#0B214A;padding:8px 12px;border-radius:12px;font-size:13px;opacity:0;pointer-events:none;transition:opacity .2s;z-index:60}
.toast.show{opacity:1}
.compact .h1{font-size:clamp(16px,4.2vw,22px)}
.compact .subtitle{font-size:clamp(12px,3.2vw,14px)}
.compact .card{min-height:68px;padding:8px 10px}
.compact .ctrl{width:40px;height:40px}
.compact .chips{display:none}
.results{display:none;flex-direction:column;gap:12px}
.results.active{display:flex}
.resHeader{display:flex;align-items:center;gap:10px}
.badge{padding:6px 10px;border-radius:12px;background:#C5FFDF;border:1px solid #00E6BC;color:#0B214A;font-weight:700}
.block{border:1px solid #00E6BC;border-radius:14px;padding:12px;background:#fff}
.seqTitle{font-weight:800;margin:0 0 6px 0}
.list{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.col{border:1px dashed #00E6BC;border-radius:12px;padding:8px}
.col h4{margin:0 0 4px 0;font-size:14px;color:#0B214A}
.step{font-size:13px;line-height:1.15;margin:3px 0;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.tip{background:#C5FFDF;border:1px solid #00E6BC;border-radius:12px;padding:10px;color:#0B214A}
.finalBar{position:sticky;bottom:0;background:#fff;padding:12px 0 4px 0}
.finalBar button{width:100%;height:56px;border-radius:24px;background:#0B214A;color:#00E6BC;font-weight:900;box-shadow:0 8px 18px rgba(11,33,74,.25);border:none;font-size:clamp(16px,4.8vw,18px)}
.hide{display:none}
</style></head><body class="lock"><div class="scene"><div class="scaleWrap" id="scaleWrap">
<div class="cornerGuard"></div>
<div class="safeTop"></div>
<img class="avatar" src="https://techkampe.github.io/daily-streak/assets/Avatar%203_low.png" alt="Mentor Avatar" loading="eager">
<div class="header"><div class="progress" id="progress">Reto 1/3</div></div>
<div class="h1">Protocolo Cero: El orden SÍ altera el producto ⚡️</div>
<div class="subtitle" id="subtitle">Ordena los pasos: Sustituir un interruptor</div>
<div class="board" id="board" aria-label="Zona interactiva de ordenación"></div>
<div class="footer">
<div class="hint" id="miniHint">Toca ↑/↓ o elige un número para mover cada paso.</div>
<button id="confirm" class="cta" aria-label="Confirmar orden">Confirmar orden</button>
</div>

<div class="results" id="results"></div>
<div class="finalBar hide" id="finalBar"><button onclick="completeTask()">Ver mi recompensa</button></div>
</div></div>

<div class="modal" id="intro">
  <div class="modalCard">
    <h2>Protocolo Cero: El orden SÍ altera el producto ⚡️</h2>
    <p>Estás en tus primeras prácticas como electricista. Demuestra que dominas los procedimientos de seguridad y montaje, ordenando pasos reales de trabajo.</p>
    <p class="mini">Cómo jugar: usa ↑/↓ o pulsa un número (1,2,3…) en cada tarjeta para colocarla. Confirma y pasa al siguiente reto. Son 3 en total.</p>
    <button class="cta start" id="startBtn">¡Empezar!</button>
  </div>
</div>
<div class="toast" id="toast">Orden guardado</div>

<script>
const data=[{title:"Sustituir un interruptor simple",steps:["Cortar corriente en el cuadro del circuito","Verificar ausencia de tensión con el tester","Desmontar interruptor y etiquetar cables","Conectar el nuevo interruptor según colores","Rearmar tensión y probar funcionamiento"],why:"Cortar y verificar aísla la energía. Luego desmontas y conectas el nuevo equipo. La tensión se restablece al final para probar con seguridad.",tip:"Siempre verifica ausencia de tensión: ver, probar y volver a probar en el punto de trabajo."},{title:"Instalar un enchufe en caja existente",steps:["Cortar corriente del circuito del enchufe","Marcar posición y altura de la caja","Pasar conductores y preparar extremos","Conectar tomacorriente y fijar la placa","Rearmar tensión y probar"],why:"Primero desenergiza y planifica. Preparas conductores, conectas y solo al final energizas para probar sin riesgos.",tip:"Ajusta bien los conductores: sin pelos sueltos ni tensiones mecánicas."},{title:"Preparar una roza para cableado",steps:["Ponerse EPI y proteger la zona de trabajo","Trazar recorrido y marcar con nivel","Cortar corriente si hay cableado cercano","Abrir roza a la profundidad permitida","Colocar tubo y fijarlo; tapar y limpiar"],why:"EPI primero, marcas el recorrido y, si hay riesgo, cortas tensión. Abres, fijas el tubo y tapas para un acabado limpio y seguro.",tip:"Respeta profundidad y verticalidad. Señaliza para evitar taladros futuros sobre el tubo."}];
let current=0,answers=[],uiScale=1;
const board=document.getElementById("board"),progress=document.getElementById("progress"),subtitle=document.getElementById("subtitle"),confirmBtn=document.getElementById("confirm"),results=document.getElementById("results"),finalBar=document.getElementById("finalBar");
function shuffle(a){return a.map(x=>({x,sort:Math.random()})).sort((a,b)=>a.sort-b.sort).map(o=>o.x)}
function renderChallenge(i){
 document.documentElement.classList.add('lock');document.body.classList.add('lock');
 progress.textContent=`Reto ${i+1}/3`;subtitle.textContent=`Ordena los pasos: ${data[i].title}`;
 board.innerHTML="";const correct=data[i].steps.slice(),initial=shuffle(correct);
 initial.forEach((t,idx)=>board.appendChild(cardEl(t,idx,initial.length)));
 ensureFits();
}
function cardEl(text,idx,total){
 const c=document.createElement("div");c.className="card";c.setAttribute("role","group");c.setAttribute("aria-label",text);
 const left=document.createElement("div");left.className="left";
 const idxEl=document.createElement("div");idxEl.className="idx";idxEl.textContent=idx+1;c.dataset.index=idx+1;
 const txt=document.createElement("div");txt.className="txt";txt.textContent=limit48(text);
 left.append(idxEl,txt);
 const ctr=document.createElement("div");ctr.className="controls";
 const up=document.createElement("button");up.className="ctrl";up.setAttribute("aria-label","Subir");up.textContent="↑";
 const down=document.createElement("button");down.className="ctrl";down.setAttribute("aria-label","Bajar");down.textContent="↓";
 ctr.append(up,down);
 const chips=document.createElement("div");chips.className="chips";
 for(let n=1;n<=total;n++){const ch=document.createElement("button");ch.className="chip";ch.textContent=n;ch.dataset.target=n;ch.addEventListener("click",()=>moveTo(c,n-1));chips.appendChild(ch)}
 up.addEventListener("click",()=>moveBy(c,-1));down.addEventListener("click",()=>moveBy(c,1));
 c.append(left,ctr,chips);
 return c;
}
function updateIndices(){
 [...board.children].forEach((el,i)=>{el.dataset.index=i+1;el.querySelector(".idx").textContent=i+1;el.classList.remove("bump");void el.offsetWidth;el.classList.add("bump");
 const chips=el.querySelectorAll(".chip");chips.forEach(ch=>ch.classList.toggle("sel",+ch.dataset.target===i+1));
 });
}
function moveBy(card,delta){
 const nodes=[...board.children];const i=nodes.indexOf(card);let j=i+delta;if(j<0||j>=nodes.length)return;
 board.insertBefore(card,delta<0?nodes[j]:nodes[j].nextSibling);updateIndices()
}
function moveTo(card,position){
 const nodes=[...board.children];const i=nodes.indexOf(card);if(position===i)return;
 board.insertBefore(card, position<i?nodes[position]:nodes[position+1]);updateIndices()
}
function limit48(t){return t.length>48?t.slice(0,45)+"…":t}
function vibrate(ms){try{if(navigator.vibrate)navigator.vibrate(ms)}catch(e){}}
function handleConfirm(){
 confirmBtn.classList.add("vibe");setTimeout(()=>confirmBtn.classList.remove("vibe"),200);vibrate(15);
 const order=[...board.children].map(el=>el.querySelector(".txt").textContent);
 answers.push(order);
 showToast("Orden guardado");
 if(current<2){current++;renderChallenge(current)}else{setTimeout(showResults,500)}
}
function showToast(msg){const t=document.getElementById("toast");t.textContent=msg;t.classList.add("show");setTimeout(()=>t.classList.remove("show"),900)}
function showResults(){
 document.documentElement.classList.remove('lock');document.body.classList.remove('lock');
 results.innerHTML="";results.classList.add("active");board.classList.add("hide");document.querySelector(".footer").classList.add("hide");document.querySelector(".avatar").style.opacity=.08;
 let score=0;
 data.forEach((q,idx)=>{const your=answers[idx];const ok=q.steps;const good=arraysEqual(your,ok);if(good)score++;
 const block=document.createElement("div");block.className="block";
 const head=document.createElement("div");head.className="seqHead";
 const title=document.createElement("div");title.className="seqTitle";title.textContent=q.title;
 const badge=document.createElement("span");badge.className="badge";badge.textContent=good?"¡Correcto!":"Revisa el orden";badge.style.background=good?"#E9FFF7":"#FFE9EE";badge.style.borderColor=good?"#04FFB4":"#F9577E";badge.style.color=good?"#0B214A":"#F9577E";
 const wrap=document.createElement("div");wrap.className="resHeader";wrap.append(badge,document.createTextNode(" "));
 block.append(head,title,wrap);
 const list=document.createElement("div");list.className="list";
 const col1=document.createElement("div");col1.className="col";const c1h=document.createElement("h4");c1h.textContent="Tu orden";col1.appendChild(c1h);
 your.forEach((s,i)=>{const p=document.createElement("div");p.className="step";p.textContent=`${i+1}. ${s}`;col1.appendChild(p)})
 const col2=document.createElement("div");col2.className="col";const c2h=document.createElement("h4");c2h.textContent="Orden correcto";col2.appendChild(c2h);
 ok.forEach((s,i)=>{const p=document.createElement("div");p.className="step";p.textContent=`${i+1}. ${s}`;col2.appendChild(p)})
 list.append(col1,col2);
 const why=document.createElement("div");why.className="tip";why.textContent=q.why;
 const tip=document.createElement("div");tip.className="hint";tip.textContent="Consejo: "+q.tip;
 block.append(list,why,tip);results.appendChild(block);
 });
 const header=document.createElement("div");header.className="resHeader";header.style.marginTop="6px";header.innerHTML=`<div class="h1" style="margin:0">Resultados</div>`;
 const sc=document.createElement("div");sc.className="badge";sc.style.background="#E9FFF7";sc.textContent=`${score}/3 correctos`;
 results.prepend(sc);results.prepend(header);
 finalBar.classList.remove("hide");
}
function arraysEqual(a,b){return a.length===b.length && a.every((v,i)=>v===b[i])}
function assertNoOverflow(){
 const scene=document.querySelector(".scene");return scene.scrollHeight<=scene.clientHeight
}
function applyCompactMode(on){
 document.body.classList.toggle("compact",!!on)
}
function fitBoardToViewport(){
 const count=board.children.length;let h=84;if(count===5)h=80;if(count===4)h=88;if(document.body.classList.contains("compact"))h-=12;document.documentElement.style.setProperty("--cardH",h+"px")
}
function autoscaleUI(){
 const wrap=document.getElementById("scaleWrap");uiScale=1;document.documentElement.style.setProperty("--ui-scale",uiScale);
 if(assertNoOverflow())return;
 let s=1;while(s>0.88){s-=0.02;document.documentElement.style.setProperty("--ui-scale",s);if(assertNoOverflow()){uiScale=s;break}}
}
function ensureFits(){
 applyCompactMode(false);fitBoardToViewport();
 if(!assertNoOverflow()){applyCompactMode(true);fitBoardToViewport()}
 autoscaleUI()
}
window.addEventListener("resize",ensureFits);window.addEventListener("orientationchange",()=>setTimeout(ensureFits,150));
document.getElementById("confirm").addEventListener("click",handleConfirm);
document.getElementById("startBtn").addEventListener("click",()=>{document.getElementById("intro").style.display="none";renderChallenge(current)});
function completeTask(){if(window.ReactNativeWebView){window.ReactNativeWebView.postMessage(JSON.stringify({action:'TASK_COMPLETED'}))}}
function init(){renderChallenge(0);document.getElementById("intro").style.display="flex"} // ensures UI sizing
init();
</script></body></html>