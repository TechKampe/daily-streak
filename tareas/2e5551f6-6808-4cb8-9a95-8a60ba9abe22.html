<!DOCTYPE html><html lang="es"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/><title>Maestro de la Calma ❄️ · Kämpe</title><link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;700&display=swap" rel="stylesheet"><style>
:root{--blue:#0B214A;--turq:#00E6BC;--text:#1A1B2F;--bg:#FFFFFF;--ok:#04FFB4;--err:#F9577E;--info:#C5FFDF;--ui-scale:1}
*{box-sizing:border-box}html,body{height:100%;background:#fff;color:var(--text);font-family:'Baloo 2',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;-webkit-font-smoothing:antialiased;overscroll-behavior:none}
html,body.no-scroll{overflow:hidden}
#app{isolation:isolate}
h1,h2,h3,p{margin:0}
.btn{background:var(--blue);color:var(--turq);border:0;border-radius:24px;padding:12px 16px;min-height:48px;font-weight:700;font-size:clamp(14px,2.8vw,16px);box-shadow:0 8px 18px rgba(11,33,74,.25);cursor:pointer;outline:0;transition:transform .05s ease;touch-action:manipulation}
.btn:active{transform:translateY(1px)}.btn[disabled]{opacity:.45;box-shadow:none;cursor:not-allowed}
.btn.secondary{background:#0b214a14;color:var(--blue);border:1px solid var(--turq);box-shadow:none}
.modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;padding:16px;z-index:30;background:linear-gradient(0deg,rgba(255,255,255,.88),rgba(255,255,255,.88))}
.card{background:#fff;border:1px solid var(--turq);border-radius:16px;max-width:520px;width:100%;max-height:90svh;overflow-y:auto;padding:18px 16px;gap:12px;display:flex;flex-direction:column}
.card h1{font-size:clamp(20px,5vw,28px);line-height:1.1;color:var(--text)}
.card p{opacity:.9;font-size:clamp(14px,3.2vw,16px)}
.badges{display:flex;gap:8px;flex-wrap:wrap}
.badge{background:var(--info);color:var(--blue);border-radius:12px;padding:6px 10px;font-size:12px;border:1px solid #00e6bc55}
.startActions{display:flex;gap:10px;margin-top:8px}
.scene{position:relative;background:#fff;padding:16px;display:flex;flex-direction:column;gap:8px;touch-action:none;padding-top:calc(16px + env(safe-area-inset-top));padding-bottom:calc(16px + env(safe-area-inset-bottom))}
@supports(height:100svh){.scene{height:100svh}}
@supports not (height:100svh){@supports(height:100dvh){.scene{height:100dvh}}}
@supports not (height:100dvh){.scene{height:100vh}}
.scene .layout{transform-origin:top center;transform:scale(var(--ui-scale));display:flex;flex-direction:column;gap:10px;height:100%;}
.topSafe{height:80px;pointer-events:none}
.hud{display:flex;align-items:center;gap:10px;margin-top:-64px;margin-right:120px}
.title{font-weight:700;font-size:clamp(16px,4.4vw,20px);color:var(--text)}
.progress{display:flex;align-items:center;gap:8px}
.pill{font-size:12px;color:#00E6BC;background:#00e6bc17;border:1px solid var(--turq);border-radius:999px;padding:6px 10px}
.bar{width:88px;height:8px;border:1px solid var(--turq);border-radius:99px;position:relative;overflow:hidden;background:#eafff7}
.fill{position:absolute;inset:0;width:0%;background:linear-gradient(90deg,var(--ok),#00e6bc);transition:width .25s}
.watermark{position:absolute;right:6%;bottom:14%;opacity:.08;z-index:0}
.watermark img{width:min(36vw,220px);height:auto;filter:grayscale(20%)}
.chatWrap{flex:1;min-height:0;border:1px solid var(--turq);border-radius:16px;padding:10px;background:#ffffff;position:relative;z-index:1}
.chat{height:100%;overflow-y:auto;scroll-behavior:smooth;touch-action:pan-y pinch-zoom;display:flex;flex-direction:column;gap:8px;padding-right:6px}
.msg{display:flex;gap:8px;align-items:flex-start}
.msg.r{flex-direction:row-reverse}
.avatar{width:34px;height:34px;border-radius:50%;border:1px solid var(--turq);object-fit:cover;background:#fff;flex:0 0 34px}
.bub{max-width:82%;padding:8px 10px;border-radius:14px;border:1px solid var(--turq);font-size:clamp(13px,3.6vw,15px);line-height:1.2;background:#fff}
.bub.me{background:var(--info);color:var(--blue)}
.bub .name{font-weight:700;margin-bottom:2px;font-size:12px;color:#1A1B2F99}
.bub .t{-webkit-line-clamp:5;-webkit-box-orient:vertical;display:-webkit-box;overflow:hidden}
.answers{position:sticky;bottom:0;left:0;right:0;display:grid;grid-template-columns:1fr;gap:8px;z-index:2;margin-top:4px}
.opt{display:flex;align-items:center;justify-content:center;text-align:center;padding:12px 14px;min-height:52px}
.small{font-size:12px;opacity:.9}
.infoNote{background:var(--info);border:1px solid #00e6bc77;border-radius:12px;padding:8px 10px;color:var(--blue);font-size:12px}
.results{display:none}
.results .list{display:grid;gap:10px;margin-top:8px}
.item{border:1px solid var(--turq);border-radius:12px;padding:10px;display:grid;gap:4px;background:#fff}
.row{display:flex;justify-content:space-between;align-items:center;gap:8px}
.tag{font-size:12px;border-radius:10px;padding:4px 8px}
.good{color:#067a5e;background:#04ffb422;border:1px solid #04ffb4}
.ok{color:#0B214A;background:#00e6bc1f;border:1px solid #00e6bc}
.bad{color:#8b1331;background:#f9577e1d;border:1px solid #f9577e}
.results h2{font-size:clamp(18px,5vw,22px)}
.sum{display:flex;gap:8px;flex-wrap:wrap}
.compact .title{font-size:clamp(14px,4vw,18px)}
.compact .answers .btn{padding:10px}
.compact .bub{font-size:clamp(12px,3.2vw,14px)}
.tight .hud{margin-top:-70px}
a,button:focus-visible{outline:2px dashed var(--turq);outline-offset:2px}
</style></head><body class="no-scroll"><div id="app">
<div id="intro" class="modal" role="dialog" aria-modal="true"><div class="card" aria-labelledby="introTitle">
<h1 id="introTitle">Maestro de la Calma ❄️</h1>
<p>Primera visita en solitario como técnico de climatización. Cliente nervioso por ruido y coste. Demuestra empatía, claridad y profesionalidad en 5 turnos.</p>
<div class="badges"><span class="badge">Tipo: Chatbot</span><span class="badge">Duración: 2–4 min</span><span class="badge">Objetivo: trato + diagnóstico seguro</span></div>
<div class="infoNote" aria-live="polite">Tutorial: elige la mejor respuesta; verás la reacción y avanzarás turno a turno.</div>
<div class="startActions"><button id="start" class="btn" aria-label="Empezar reto">Empezar</button><button class="btn secondary" id="how" aria-label="Cómo jugar">¿Cómo se juega?</button></div>
</div></div>

<div id="game" class="scene" aria-live="polite" style="display:none">
<div class="layout">
<div class="topSafe"></div>
<div class="hud" aria-label="Progreso del reto"><div class="title">Maestro de la Calma ❄️</div><div class="progress"><span class="pill" id="step">1/5</span><div class="bar" aria-hidden="true"><div class="fill" id="fill" style="width:0%"></div></div></div></div>
<div class="chatWrap" aria-label="Histórico de chat">
<div class="chat" id="chat"></div>
</div>
<div class="answers" id="answers"></div>
</div>
<div class="watermark"><img src="https://techkampe.github.io/daily-streak/assets/Avatar 2_low.png" alt="" /></div>
</div>

<div id="results" class="modal results" role="dialog" aria-modal="true"><div class="card">
<h2>Resultados — Maestro de la Calma ❄️</h2>
<div class="sum" id="sum"></div>
<div class="list" id="list"></div>
<div class="infoNote" id="tip">Consejo: saluda, pide permiso y prioriza seguridad. Formula preguntas abiertas y da rangos solo tras diagnosticar; confirma antes de reparar.</div>
<button class="btn" onclick="completeTask()">Ver mi recompensa</button>
</div></div>
</div><script>
const AVATARS={mentor:{name:"Hugo (Mentor)",img:"https://techkampe.github.io/daily-streak/assets/Avatar 1_low.png"},yo:{name:"Tú (Aprendiz)",img:"https://techkampe.github.io/daily-streak/assets/Avatar 2_low.png"},cliente:{name:"Laura (Cliente)",img:"https://techkampe.github.io/daily-streak/assets/Avatar 4_low.png"}};
const TURNS=[{pre:[{who:"cliente",t:"Hola, ¿eres el técnico? El aire hace un ruido horrible y temo que sea carísimo."}],opts:[{label:"Hola, soy el técnico. Revisaré y te explico.",type:"good",reactWho:"cliente",react:"Gracias, estoy algo nerviosa.",ex:"Empatizas y explicas el plan; baja la ansiedad."},{label:"Tranquila, seguro no es nada.",type:"ok",reactWho:"cliente",react:"Ojalá... pero suena feo.",ex:"Calmas sin datos; puede sonar condescendiente."},{label:"Hablemos de presupuesto ya.",type:"bad",reactWho:"cliente",react:"¿Sin mirar el equipo?",ex:"Precio sin diagnóstico genera desconfianza."}]},
{pre:[{who:"mentor",t:"Tip: pide permiso y corta corriente antes de abrir."}],opts:[{label:"¿Apagamos el equipo? Revisaré sin tensión.",type:"good",reactWho:"cliente",react:"Sí, adelante.",ex:"Seguridad primero y con permiso del cliente."},{label:"Lo apago luego, solo oigo el ruido primero.",type:"ok",reactWho:"cliente",react:"¿Es seguro?",ex:"Dejas la seguridad para después; mala práctica."},{label:"Lo abro así, total no pasa nada.",type:"bad",reactWho:"cliente",react:"Prefiero que no.",ex:"Imprudente; rompe confianza y seguridad."}]},
{pre:[{who:"cliente",t:"El ruido aparece al arrancar y por la noche."}],opts:[{label:"¿Desde cuándo pasa y dónde se oye más?",type:"good",reactWho:"cliente",react:"Desde hace una semana, en la unidad exterior.",ex:"Preguntas abiertas mejoran el diagnóstico."},{label:"Será un rodamiento. Lo cambio ya.",type:"ok",reactWho:"cliente",react:"¿Sin mirar?",ex:"Hipótesis prematura, sin inspección."},{label:"Fue culpa del instalador, seguro.",type:"bad",reactWho:"cliente",react:"No lo sé...",ex:"Culpabilizar sin pruebas es poco profesional."}]},
{pre:[{who:"cliente",t:"Pero dime, ¿cuánto me costará? Quiero saberlo ya."}],opts:[{label:"Primero diagnostico. Te doy rango antes de reparar.",type:"good",reactWho:"cliente",react:"Vale, gracias por avisar.",ex:"Gestionas expectativas y pides permiso antes de reparar."},{label:"Puede ser entre 50 y 300€, creo.",type:"ok",reactWho:"cliente",react:"Es muy amplio...",ex:"Rango sin base puede generar incertidumbre."},{label:"Barato seguro. Lo dejo listo hoy.",type:"bad",reactWho:"cliente",react:"¿Seguro?",ex:"Promesa arriesgada; puedes perder credibilidad."}]},
{pre:[{who:"mentor",t:"Cierra la fase: plan claro, tiempo y orden."}],opts:[{label:"Plan: inspección 15 min. Te informo y decidas.",type:"good",reactWho:"cliente",react:"Perfecto, adelante.",ex:"Plan+tiempo+decisión informada transmiten profesionalidad."},{label:"Voy a mirar y ya está.",type:"ok",reactWho:"cliente",react:"Bueno...",ex:"Cumple, pero sin contexto ni tiempos."},{label:"Si molesta, te aviso luego.",type:"bad",reactWho:"cliente",react:"Preferiría estar al tanto.",ex:"Falta de transparencia hacia el cliente."}]}];
let state={turn:0,decisions:[]};
const els={intro:document.getElementById("intro"),game:document.getElementById("game"),results:document.getElementById("results"),chat:document.getElementById("chat"),answers:document.getElementById("answers"),step:document.getElementById("step"),fill:document.getElementById("fill"),sum:document.getElementById("sum"),list:document.getElementById("list")};
document.getElementById("start").onclick=()=>{els.intro.style.display="none";els.game.style.display="block";document.body.classList.add("no-scroll");renderTurn();ensureFits()};
document.getElementById("how").onclick=()=>{alert("Lee el chat y elige una respuesta. Tras cada elección verás la reacción y pasarás al siguiente turno. El histórico queda visible en el chat.")};
function addMsg(who,text,me=false){const m=document.createElement("div");m.className="msg"+(me?" r":"");const a=document.createElement("img");a.className="avatar";a.src=AVATARS[who].img;a.alt=AVATARS[who].name;a.loading="lazy";const b=document.createElement("div");b.className="bub"+(me?" me":"");const n=document.createElement("div");n.className="name";n.textContent=AVATARS[who].name;const t=document.createElement("div");t.className="t";t.textContent=text;b.appendChild(n);b.appendChild(t);m.appendChild(a);m.appendChild(b);els.chat.appendChild(m);els.chat.scrollTop=els.chat.scrollHeight}
function setProgress(){const total=TURNS.length;els.step.textContent=(state.turn+1)+"/"+total;els.fill.style.width=((state.turn)/total*100)+"%"}
function renderTurn(){setProgress();const data=TURNS[state.turn];data.pre.forEach(p=>addMsg(p.who,p.t,false));els.answers.innerHTML="";data.opts.forEach((o,i)=>{const btn=document.createElement("button");btn.className="btn opt";btn.setAttribute("aria-label","Opción "+(i+1));btn.textContent=o.label;btn.onclick=()=>choose(o);els.answers.appendChild(btn)});ensureFits()}
function choose(opt){[...els.answers.children].forEach(b=>b.disabled=true);addMsg("yo",opt.label,true);setTimeout(()=>{addMsg(opt.reactWho,opt.react,false);state.decisions.push({t:state.turn+1,label:opt.label,type:opt.type,ex:opt.ex});els.answers.innerHTML="";const ctn=document.createElement("button");ctn.className="btn";ctn.textContent=state.turn===TURNS.length-1?"Ver resultados":"Continuar";ctn.onclick=next;els.answers.appendChild(ctn);ensureFits()},250)}
function next(){if(state.turn<TURNS.length-1){state.turn++;setProgress();els.fill.style.width=((state.turn)/TURNS.length*100)+"%";renderTurn()}else{finish()}}
function finish(){els.game.style.display="none";document.body.classList.remove("no-scroll");els.results.style.display="flex";const good=state.decisions.filter(d=>d.type==="good").length;const ok=state.decisions.filter(d=>d.type==="ok").length;const bad=state.decisions.filter(d=>d.type==="bad").length;els.sum.innerHTML=`<span class="badge">Aciertos: ${good}</span><span class="badge">Parciales: ${ok}</span><span class="badge">Por mejorar: ${bad}</span>`;els.list.innerHTML="";state.decisions.forEach(d=>{const row=document.createElement("div");row.className="item";const r=document.createElement("div");r.className="row";const tt=document.createElement("div");tt.textContent=`Turno ${d.t}: ${trim48(d.label)}`;const tag=document.createElement("span");tag.className="tag "+(d.type==="good"?"good":d.type==="ok"?"ok":"bad");tag.textContent=d.type==="good"?"Correcta":d.type==="ok"?"Parcial":"Incorrecta";r.appendChild(tt);r.appendChild(tag);const ex=document.createElement("div");ex.textContent=d.ex;ex.className="small";row.appendChild(r);row.appendChild(ex);els.list.appendChild(row)});}
function trim48(s){return s.length>48?s.slice(0,45)+"…":s}
function assertNoOverflow(){const scn=document.getElementById("game");return scn.scrollHeight<=scn.clientHeight}
function applyCompactMode(){document.getElementById("game").classList.add("compact")}
function fitBoardToViewport(){document.getElementById("game").classList.add("tight")}
function autoscaleUI(){const scn=document.getElementById("game");const layout=scn.querySelector(".layout");const need=scn.scrollHeight/scn.clientHeight;let scale=Math.max(0.88,1/need);layout.style.setProperty("--ui-scale",scale)}
function ensureFits(){const scn=document.getElementById("game");const layout=scn.querySelector(".layout");layout&&layout.style.setProperty("--ui-scale",1);scn.classList.remove("compact","tight");if(assertNoOverflow())return;applyCompactMode();if(assertNoOverflow())return;fitBoardToViewport();if(assertNoOverflow())return;autoscaleUI()}
addEventListener("resize",ensureFits);addEventListener("orientationchange",ensureFits);
function completeTask(){if(window.ReactNativeWebView){window.ReactNativeWebView.postMessage(JSON.stringify({action:'TASK_COMPLETED'}));}}
</script></body></html>