<!doctype html><html lang="es"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><title>Cliente en crisis: Â¡MantÃ©n la calma! ðŸ”§</title><link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;700&display=swap" rel="stylesheet"><style>
:root{--txt:#1A1B2F;--cta:#0B214A;--ctaTxt:#00E6BC;--acc:#00E6BC;--ok:#04FFB4;--err:#F9577E;--soft:#C5FFDF;--ui-scale:1;--hudH:54px;--btnH:56px;--gap:10px;--radius:16px;--fs-title:clamp(20px,3.9vw,26px);--fs-body:clamp(14px,2.9vw,16px);--fs-small:clamp(12px,2.5vw,14px)}
*{box-sizing:border-box}html,body{height:100%;margin:0;background:#fff;color:var(--txt);font-family:"Baloo 2",system-ui,-apple-system,Segoe UI,Roboto,sans-serif}
html,body{overflow:hidden;overscroll-behavior:none}
button{font-family:inherit}
.hidden{display:none}
.clamp2{display:-webkit-box;-webkit-line-clamp:2;line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.clamp3{display:-webkit-box;-webkit-line-clamp:3;line-clamp:3;-webkit-box-orient:vertical;overflow:hidden}
@supports(height:100svh){.scene{height:100svh}}
@supports not (height:100svh){@supports(height:100dvh){.scene{height:100dvh}}}
@supports not (height:100dvh){.scene{height:100vh}}
.scene{position:relative;isolation:isolate;transform-origin:top center;transform:scale(var(--ui-scale));display:flex;flex-direction:column;padding:calc(env(safe-area-inset-top) + 80px) 16px calc(env(safe-area-inset-bottom) + 12px);gap:var(--gap);touch-action:none}
.hud{height:var(--hudH);display:flex;align-items:center;justify-content:space-between;gap:12px;padding-right:110px}
.brand{font-weight:700;color:var(--acc);font-size:var(--fs-small)}
.progress{display:flex;align-items:center;gap:10px}
.step{font-weight:700;border:1px solid var(--acc);color:var(--txt);border-radius:12px;padding:4px 10px;font-size:var(--fs-small);background:#C5FFDF}
.bar{width:120px;height:8px;border:1px solid var(--acc);border-radius:999px;position:relative}
.fill{position:absolute;left:0;top:0;bottom:0;width:0%;background:linear-gradient(90deg,#00E6BC,#04FFB4);border-radius:999px}
.chatWrap{flex:1 1 auto;border:1px solid var(--acc);border-radius:18px;padding:10px;overflow-y:auto;scroll-behavior:smooth;background:#fff;touch-action:pan-y}
.msg{display:flex;gap:8px;align-items:flex-start;margin:8px 0;max-width:90%}
.msg.me{margin-left:auto;flex-direction:row-reverse}
.msg .avatar{width:36px;height:36px;border-radius:50%;border:1px solid var(--acc);flex:0 0 36px;object-fit:cover;background:#fff}
.bubble{border:1px solid var(--acc);border-radius:14px;padding:8px 10px;max-width:100%;background:#fff}
.me .bubble{background:#0B214A;color:#00E6BC;border-color:#0B214A}
.name{font-weight:700;font-size:12px;margin-bottom:2px;color:var(--txt)}
.me .name{color:#00E6BC}
.text{font-size:var(--fs-body);line-height:1.1;display:-webkit-box;-webkit-line-clamp:4;line-clamp:4;-webkit-box-orient:vertical;overflow:hidden}
.choices{position:sticky;bottom:0;display:grid;grid-template-columns:1fr;gap:8px;margin-top:4px}
.choice{height:var(--btnH);background:var(--cta);color:var(--ctaTxt);border:none;border-radius:24px;box-shadow:0 8px 18px rgba(11,33,74,.25);font-weight:700;font-size:clamp(14px,3.6vw,18px);padding:10px 14px;cursor:pointer;display:flex;align-items:center;justify-content:center}
.choice[disabled]{opacity:.45;box-shadow:none;cursor:default}
.choice:focus-visible{outline:2px solid var(--acc);outline-offset:2px}
.labels{display:flex;gap:6px}
.tag{font-size:11px;border:1px solid var(--acc);border-radius:12px;padding:2px 8px;color:#0B214A;background:#C5FFDF}
.intro,.results{position:fixed;inset:0;z-index:5;background:rgba(26,27,47,.1);display:flex;align-items:center;justify-content:center;padding:16px}
.sheet{background:#fff;border:1px solid var(--acc);border-radius:20px;max-width:520px;width:100%;max-height:90svh;overflow:auto;padding:18px}
.h1{font-size:var(--fs-title);font-weight:800;margin:0 0 6px}
.p{font-size:var(--fs-body);margin:6px 0 10px}
.info{background:#C5FFDF;border-radius:12px;padding:8px 10px;color:#0B214A;border:1px solid var(--acc);font-size:var(--fs-small)}
.start{margin-top:10px}
.primary{background:var(--cta);color:var(--ctaTxt);border:none;border-radius:24px;box-shadow:0 8px 18px rgba(11,33,74,.25);padding:12px 18px;font-weight:800;font-size:16px;width:100%}
.primary:focus-visible{outline:2px solid var(--acc);outline-offset:2px}
.list{display:flex;flex-direction:column;gap:8px;margin:10px 0}
.item{border:1px solid var(--acc);border-radius:12px;padding:10px}
.item h4{margin:0 0 4px;font-size:15px;display:flex;gap:6px;align-items:center}
.k{width:10px;height:10px;background:var(--ok);border-radius:50%}
.bad{background:var(--err)}
.compact .hud{height:46px}
.compact .choice{height:50px;font-size:14px}
.compact .bubble{padding:6px 8px}
.compact .msg .avatar{width:32px;height:32px}
.compact .bar{width:100px}
.compact .scene{padding:calc(env(safe-area-inset-top) + 70px) 14px calc(env(safe-area-inset-bottom) + 10px)}
.scroll-mode html,.scroll-mode body{overflow-y:auto;overscroll-behavior:auto}
</style></head><body>
<div class="intro" role="dialog" aria-modal="true" id="intro">
  <div class="sheet" aria-label="IntroducciÃ³n">
    <div class="labels"><span class="tag">KÃ¤mpe Daily</span><span class="tag">HVAC</span></div>
    <h1 class="h1">Cliente en crisis: Â¡MantÃ©n la calma! ðŸ”§</h1>
    <p class="p clamp3">EstÃ¡s en tu primera intervenciÃ³n en solitario como tÃ©cnico/a de climatizaciÃ³n. El cliente estÃ¡ muy nervioso por un fallo del aire en plena ola de calor.</p>
    <div class="info">Tutorial: Elige la mejor respuesta en 5 turnos. MantÃ©n empatÃ­a, explica simple y marca un plan. Â¡Sin scroll fuera del chat!</div>
    <button class="primary start" id="startBtn" aria-label="Empezar reto">Empezar</button>
  </div>
</div>

<div class="scene" id="scene" aria-live="polite">
  <div class="hud">
    <div class="brand">KÃ¤mpe</div>
    <div class="progress" aria-label="Progreso">
      <div class="step" id="step">0/5</div>
      <div class="bar" aria-hidden="true"><div class="fill" id="fill"></div></div>
    </div>
  </div>
  <div class="chatWrap" id="chat" aria-label="Chat de la escena"></div>
  <div class="choices" id="choices"></div>
</div>

<div class="results hidden" id="results">
  <div class="sheet" aria-label="Resultados">
    <div class="labels"><span class="tag">Resumen</span><span class="tag">Feedback</span></div>
    <h2 class="h1">Tu impacto en la satisfacciÃ³n</h2>
    <div id="scoreLine" class="p"></div>
    <div class="list" id="summaryList"></div>
    <div class="info" id="advice">Consejo: Empieza con empatÃ­a, define tiempos y traduce lo tÃ©cnico en claro. Prioriza seguridad ante fugas y electricidad.</div>
    <button class="primary" onclick="completeTask()">Ver mi recompensa</button>
  </div>
</div>

<script>
const avatars={
  "Mentor":"https://techkampe.github.io/daily-streak/assets/Avatar 1_low.png",
  "TÃº":"https://techkampe.github.io/daily-streak/assets/Avatar 2_low.png",
  "Reclutador":"https://techkampe.github.io/daily-streak/assets/Avatar 3_low.png",
  "Cliente":"https://techkampe.github.io/daily-streak/assets/Avatar 4_low.png"
};
const turns=[{
  npc:[{speaker:"Cliente",text:"Â¡Por fin! Llevo horas derritiÃ©ndome, Â¿va a tardar mucho?"},{speaker:"Mentor",text:"Respira. Saluda, empatiza y marca plan."}],
  choices:[
    {text:"Hola, entiendo el calor. RevisarÃ© y te explico.",type:"correct",react:{speaker:"Cliente",text:"Gracias, solo quiero que funcione. ðŸ™"},ex:"Empatizas y marcas un plan: baja la tensiÃ³n."},
    {text:"Buenas, voy a revisar unidad interior primero.",type:"partial",react:{speaker:"Cliente",text:"Vale, pero hace mucho calor... ðŸ˜“"},ex:"Profesional, falta empatÃ­a inicial."},
    {text:"RelÃ¡jate, si hubieras ventilado no pasaba.",type:"incorrect",react:{speaker:"Cliente",text:"Â¿En serio? Necesito soluciones, no reproches."},ex:"Tono culpabilizador: sube el estrÃ©s."}
  ]
},{
  npc:[{speaker:"Cliente",text:"Â¿CuÃ¡nto vas a tardar? No puedo estar toda la tarde."}],
  choices:[
    {text:"HarÃ© diagnÃ³stico en 10â€“15 min y te lo cuento.",type:"correct",react:{speaker:"Cliente",text:"Ok, me sirve tener tiempos. â±ï¸"},ex:"Fijas tiempos y ofreces visibilidad."},
    {text:"Depende; si se complica, puede ser horas.",type:"partial",react:{speaker:"Cliente",text:"Ufâ€¦ espero que no. ðŸ˜¬"},ex:"Honesto pero poco tranquilizador."},
    {text:"Lo que haga falta. No me metas prisa.",type:"incorrect",react:{speaker:"Cliente",text:"No me hables asÃ­, por favor."},ex:"Defensivo; empeora la relaciÃ³n."}
  ]
},{
  npc:[{speaker:"Cliente",text:"Â¿Entonces quÃ© tiene? Solo echa aire caliente."}],
  choices:[
    {text:"Posible falta de gas; confirmarÃ© con manÃ³metros.",type:"correct",react:{speaker:"Cliente",text:"Bien, dÃ­melo claro cuando lo veas."},ex:"Traduces tÃ©cnica y explicas verificaciÃ³n."},
    {text:"El compresor y la vÃ¡lvula electrÃ³nica fallan.",type:"partial",react:{speaker:"Cliente",text:"No entiendo muchoâ€¦ Â¿es grave?"},ex:"Demasiada jerga; baja claridad."},
    {text:"Ni idea, seguro es un fallo de fÃ¡brica.",type:"incorrect",react:{speaker:"Cliente",text:"Â¿CÃ³mo que ni idea? ðŸ˜ "},ex:"Especulas y eludes responsabilidad."}
  ]
},{
  npc:[{speaker:"Cliente",text:"Â¿Y esto cuÃ¡nto me va a costar? No quiero sorpresas."}],
  choices:[
    {text:"Te doy un rango y no hago nada sin tu ok.",type:"correct",react:{speaker:"Cliente",text:"Perfecto, asÃ­ me quedo tranquilo."},ex:"Transparencia y consentimiento informado."},
    {text:"Depende del gas y mano de obra, te llamo luego.",type:"partial",react:{speaker:"Cliente",text:"PreferirÃ­a saber algo ahora."},ex:"Ambiguo; pospone claridad."},
    {text:"Barato no va a ser, prepÃ¡rate.",type:"incorrect",react:{speaker:"Cliente",text:"QuÃ© manera de asustarâ€¦"},ex:"Alarma y predispone rechazo."}
  ]
},{
  npc:[{speaker:"Cliente",text:"Quiero que hoy funcione. Â¿Puedes dejarlo perfecto?"}],
  choices:[
    {text:"Puedo dejarlo hoy si es seguro; si no, plan.",type:"correct",react:{speaker:"Cliente",text:"Vale, confÃ­o en tu criterio."},ex:"Gestionas expectativas y priorizas seguridad."},
    {text:"Prometo dejarlo perfecto sÃ­ o sÃ­ hoy.",type:"incorrect",react:{speaker:"Cliente",text:"Si no queda perfecto, me enfado."},ex:"Promesa irreal: riesgo de quejas."},
    {text:"Prefiero ver si enfrÃ­a y luego te actualizo.",type:"partial",react:{speaker:"Cliente",text:"Ok, pero dime tiempos."},ex:"Cauto, falta concreciÃ³n de plan."}
  ]
}];
let idx=0,decisions=[],score=0;
const scene=document.getElementById("scene");
const chat=document.getElementById("chat");
const choices=document.getElementById("choices");
const step=document.getElementById("step");
const fill=document.getElementById("fill");
function avatarImg(name){const img=document.createElement("img");img.className="avatar";img.src=avatars[name];img.alt="Avatar de "+name;img.loading="lazy";return img}
function addMsg(speaker,text,me=false){const m=document.createElement("div");m.className="msg"+(me?" me":"");const av=avatarImg(speaker);const b=document.createElement("div");b.className="bubble";const nm=document.createElement("div");nm.className="name clamp2";nm.textContent=speaker;const tx=document.createElement("div");tx.className="text";tx.textContent=text;b.appendChild(nm);b.appendChild(tx);m.appendChild(av);m.appendChild(b);chat.appendChild(m);chat.scrollTop=chat.scrollHeight}
function renderTurn(){updateProgress();const t=turns[idx];t.npc.forEach(n=>addMsg(n.speaker,n.text));renderChoices(t.choices);ensureFits()}
function renderChoices(opts){choices.innerHTML="";opts.forEach((o,i)=>{const btn=document.createElement("button");btn.className="choice clamp2";btn.setAttribute("aria-label","OpciÃ³n "+(i+1));btn.textContent=o.text;btn.onclick=()=>choose(o,btn);choices.appendChild(btn)})}
function choose(o,btn){[...choices.children].forEach(b=>b.disabled=true);addMsg("TÃº",o.text,true);setTimeout(()=>{addMsg(o.react.speaker,o.react.text,false);decisions.push({turn:idx+1,choice:o.text,type:o.type,ex:o.ex});if(o.type==="correct")score+=2;else if(o.type==="partial")score+=1;idx++;if(idx<turns.length){setTimeout(()=>{renderTurn()},350)}else{setTimeout(showResults,450)}updateProgress();ensureFits()},220)}
function updateProgress(){step.textContent=`${Math.min(idx+1,turns.length)}/${turns.length}`;fill.style.width=((idx)/turns.length*100)+"%"}
function start(){document.getElementById("intro").classList.add("hidden"); idx=0;decisions=[];score=0;chat.innerHTML="";choices.innerHTML="";updateProgress();renderTurn()}
document.getElementById("startBtn").addEventListener("click",()=>{start();ensureFits()});
function showResults(){document.body.classList.add("scroll-mode");document.getElementById("results").classList.remove("hidden");const max=turns.length*2;const line=document.getElementById("scoreLine");let mood="ðŸ˜";if(score>=8)mood="ðŸ˜„";else if(score>=5)mood="ðŸ™‚";else if(score<=2)mood="ðŸ˜Ÿ";line.textContent=`SatisfacciÃ³n estimada: ${score}/${max} ${mood}`;const list=document.getElementById("summaryList");list.innerHTML="";decisions.forEach(d=>{const it=document.createElement("div");it.className="item";const h=document.createElement("h4");const dot=document.createElement("span");dot.className="k"+(d.type==="incorrect"?" bad":"");h.appendChild(dot);h.append(" Turno "+d.turn+" Â· "+(d.type==="correct"?"acierto":d.type==="partial"?"parcial":"error"));const p1=document.createElement("div");p1.className="p clamp3";p1.textContent="Tu respuesta: "+d.choice;const p2=document.createElement("div");p2.className="p clamp3";p2.textContent="Impacto: "+d.ex;it.append(h,p1,p2);list.appendChild(it)})}
function assertNoOverflow(){const s=scene;return s.scrollHeight<=s.clientHeight}
function applyCompactMode(){document.body.classList.add("compact")}
function fitBoardToViewport(){document.documentElement.style.setProperty('--hudH','46px');document.documentElement.style.setProperty('--btnH','52px')}
function autoscaleUI(){let scale=1;const s=scene;const diff=s.scrollHeight-s.clientHeight;if(diff>0){scale=Math.max(0.88,1-(diff/s.clientHeight));document.documentElement.style.setProperty('--ui-scale',scale)}}
function ensureFits(){if(assertNoOverflow())return;applyCompactMode();if(assertNoOverflow())return;fitBoardToViewport();if(assertNoOverflow())return;autoscaleUI()}
window.addEventListener("resize",ensureFits);window.addEventListener("orientationchange",ensureFits);
function completeTask(){if(window.ReactNativeWebView){window.ReactNativeWebView.postMessage(JSON.stringify({action:'TASK_COMPLETED'}))}}
</script>
</body></html>