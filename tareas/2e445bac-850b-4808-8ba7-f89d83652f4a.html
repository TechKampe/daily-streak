
<!DOCTYPE html>
<html lang="es" class="gameplay">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>Inspector de Riesgos: Â¡Tu Primera Obra! ğŸ‘· - KÃ¤mpe Games</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@500;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://techkampe.github.io/daily-streak/assets/css/daily_tasks.css">
</head>
<body>
<div class="scene gameplay" id="scene">
<div class="hud">
<div class="hud-titles">
<div class="brand">Inspector de Riesgos ğŸ‘·</div>
<div class="subtitle" id="instruction">Clasifica cada situaciÃ³n</div>
</div>
<div class="progress-row">
<div class="bar-wrap">
<span class="bar-label">Progreso</span>
<div class="bar"><i id="progress"></i></div>
</div>
<span class="badge" id="counter">1/10</span>
</div>
</div>
<div class="main">
<div class="results-header" id="item-display">
<div class="results-title" id="current-item">Cargando...</div>
</div>
<div class="options" id="categories"></div>
</div>
<div class="footer">
<div class="helper">Toca la categorÃ­a correcta</div>
</div>
</div>
<img class="avatar" src="https://techkampe.github.io/daily-streak/assets/Avatar%201_low.png" alt="" loading="lazy">

<div class="modal-backdrop" id="modal">
<div class="modal">
<div class="modal-title">Â¡Tu Primera Obra! ğŸ‘·</div>
<div class="modal-body">Es tu primer dÃ­a. Tu mentor quiere evaluar tu ojo crÃ­tico. Clasifica cada situaciÃ³n segÃºn su riesgo.</div>
<div class="modal-actions">
<button class="cta" onclick="startGame()">Â¡Empezar!</button>
</div>
</div>
</div>

<script>
const items = [
{text: "Charco cerca de enchufe", correct: 0, exp: "Agua + electricidad = riesgo de electrocuciÃ³n inmediato."},
{text: "Zona de trabajo seÃ±alizada", correct: 2, exp: "SeÃ±alizar es una medida preventiva correcta."},
{text: "Herramientas abandonadas", correct: 1, exp: "Pueden causar tropiezos o accidentes."},
{text: "Andamio sin barandilla", correct: 0, exp: "Riesgo de caÃ­da desde altura muy grave."},
{text: "EPIs en su lugar asignado", correct: 2, exp: "OrganizaciÃ³n correcta del equipo de protecciÃ³n."},
{text: "Cables sueltos por el suelo", correct: 1, exp: "Riesgo de tropiezo y daÃ±o al cableado."},
{text: "ExcavaciÃ³n sin protecciÃ³n", correct: 0, exp: "Riesgo de caÃ­da o derrumbe inmediato."},
{text: "Extintor visible y accesible", correct: 2, exp: "Cumple normativa de seguridad contra incendios."},
{text: "Escombros apilados en paso", correct: 1, exp: "Obstruye evacuaciÃ³n y causa tropiezos."},
{text: "Casco puesto correctamente", correct: 2, exp: "ProtecciÃ³n bÃ¡sica obligatoria bien aplicada."}
];

const categories = ["ğŸš¨ Peligro Inmediato", "âš ï¸ Potencial Desorden", "âœ… Buena PrÃ¡ctica"];
let idx = 0, answers = [], blocked = false;

const scene = document.getElementById('scene');
const itemEl = document.getElementById('current-item');
const catsEl = document.getElementById('categories');
const progEl = document.getElementById('progress');
const counterEl = document.getElementById('counter');
const modal = document.getElementById('modal');

function startGame() {
modal.classList.remove('active');
render();
}

function render() {
if (idx >= items.length) { showResults(); return; }
blocked = false;
const item = items[idx];
itemEl.textContent = item.text;
progEl.style.width = ((idx) / items.length * 100) + '%';
counterEl.textContent = (idx + 1) + '/' + items.length;
catsEl.innerHTML = categories.map((c, i) => 
`<button class="btn-option" onclick="selectCategory(${i})">${c}</button>`
).join('');
ensureFits();
}

function selectCategory(catIdx) {
if (blocked) return;
blocked = true;
const item = items[idx];
const correct = catIdx === item.correct;
const btns = catsEl.querySelectorAll('.btn-option');
btns[catIdx].classList.add(correct ? 'correct' : 'incorrect');
if (!correct) btns[item.correct].classList.add('correct');
answers.push({
text: item.text,
user: categories[catIdx],
correctCat: categories[item.correct],
correct: correct,
exp: item.exp
});
setTimeout(() => { idx++; render(); }, 600);
}

function showResults() {
setTimeout(() => {
document.documentElement.classList.replace('gameplay', 'results');
scene.classList.replace('gameplay', 'results');
const score = answers.filter(a => a.correct).length;
scene.innerHTML = `
<div class="results-header">
<div class="results-title">Â¡InspecciÃ³n Completada!</div>
<div class="results-score">${score}/${items.length}</div>
<div class="results-subtitle">Situaciones clasificadas correctamente</div>
</div>
<div class="results-list">
${answers.map(a => `
<div class="result-item ${a.correct ? 'correct' : 'incorrect'}">
<div class="result-question">${a.text}</div>
<div class="result-answer">${a.correct ? 'âœ“ ' + a.correctCat : 'âœ— Dijiste: ' + a.user}</div>
${!a.correct ? `<div class="result-answer">Correcto: ${a.correctCat}</div>` : ''}
<div class="result-explanation">${a.exp}</div>
</div>
`).join('')}
<div class="result-item">
<div class="result-question">ğŸ’¡ Consejo del Mentor</div>
<div class="result-explanation">En obra, pregÃºntate siempre: Â¿Esto puede causar daÃ±o ahora, despuÃ©s, o estÃ¡ bien? Esa clasificaciÃ³n mental te salvarÃ¡.</div>
</div>
</div>
<div class="footer">
<button class="cta" onclick="completeTask()">Ver mi recompensa</button>
</div>`;
}, 500);
}

function completeTask() {
if (window.ReactNativeWebView) {
window.ReactNativeWebView.postMessage(JSON.stringify({ action: 'TASK_COMPLETED' }));
}
}

function ensureFits() {
scene.classList.remove('compact', 'compact-xs');
document.documentElement.style.setProperty('--ui-scale', 1);
if (scene.scrollHeight > scene.clientHeight) scene.classList.add('compact');
if (scene.scrollHeight > scene.clientHeight) scene.classList.add('compact-xs');
if (scene.scrollHeight > scene.clientHeight) {
document.documentElement.style.setProperty('--ui-scale', Math.max(0.88, scene.clientHeight / scene.scrollHeight));
}
}

window.addEventListener('load', () => { modal.classList.add('active'); ensureFits(); });
window.addEventListener('resize', ensureFits);
window.addEventListener('orientationchange', () => setTimeout(ensureFits, 100));
</script>
</body>
</html>
