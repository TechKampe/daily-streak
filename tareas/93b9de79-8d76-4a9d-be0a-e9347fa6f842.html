
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no">
<meta name="theme-color" content="#1EA4FF">
<title>¬°Alerta, novato! No metas la pata ‚ö° | K√§mpe</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;700&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html,body{width:100%;height:100%;overflow:hidden;overscroll-behavior:none;font-family:'Baloo 2',system-ui,sans-serif;background:#F5F3EE;color:#1A1B2F;-webkit-font-smoothing:antialiased;touch-action:pan-y}
body.results-view{overflow-y:auto}
@supports (height:100svh){.scene{height:100svh!important}}
@supports not (height:100svh){.scene{height:100dvh!important}}
@supports not (height:100dvh){.scene{height:100vh!important}}
.scene{width:100%;display:flex;flex-direction:column;position:relative;padding:env(safe-area-inset-top,0) env(safe-area-inset-right,0) env(safe-area-inset-bottom,0) env(safe-area-inset-left,0);overflow:hidden}
.bg-avatar{position:absolute;top:0;left:0;width:100%;height:100%;background:url('https://techkampe.github.io/daily-streak/assets/Avatar%203_low.png') center 70%/contain no-repeat;opacity:0.08;pointer-events:none;z-index:0}
.hud{position:relative;z-index:10;display:flex;align-items:center;justify-content:space-between;padding:clamp(8px,2vw,12px) clamp(12px,4vw,20px);background:linear-gradient(135deg,#1EA4FF,#007BFF);box-shadow:0 2px 8px rgba(0,123,255,0.15);gap:12px}
.compact .hud{padding:6px 12px}
.logo-img{height:clamp(28px,7vw,40px);width:auto;object-fit:contain}
.hud-right{display:flex;align-items:center;gap:clamp(8px,2vw,12px)}
.progress-pill{background:rgba(255,255,255,0.95);border-radius:20px;padding:6px 14px;font-size:clamp(13px,3.2vw,15px);font-weight:600;color:#007BFF;box-shadow:0 2px 6px rgba(0,0,0,0.1)}
.compact .progress-pill{padding:4px 10px;font-size:12px}
.content-area{flex:1;display:flex;flex-direction:column;justify-content:space-between;position:relative;z-index:5;overflow:hidden;padding:clamp(12px,3vw,20px)}
.compact .content-area{padding:8px 12px}
.scene-text{background:rgba(255,255,255,0.96);border-radius:16px;padding:clamp(14px,3.5vw,20px);box-shadow:0 4px 12px rgba(0,0,0,0.08);margin-bottom:clamp(12px,3vw,16px)}
.compact .scene-text{padding:10px 14px;margin-bottom:8px;border-radius:12px}
.scene-text h2{font-size:clamp(16px,4vw,20px);font-weight:700;color:#1A1B2F;margin-bottom:8px;line-height:1.3;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.compact .scene-text h2{font-size:clamp(14px,3.5vw,17px);margin-bottom:6px}
.scene-text p{font-size:clamp(13px,3.2vw,15px);color:#4A4A68;line-height:1.4;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden}
.compact .scene-text p{font-size:clamp(12px,3vw,14px)}
.items-grid{display:grid;grid-template-columns:1fr 1fr;gap:clamp(10px,2.5vw,14px);margin-bottom:clamp(12px,3vw,16px)}
.compact .items-grid{gap:8px;margin-bottom:8px}
.item-btn{background:linear-gradient(135deg,rgba(255,255,255,0.98),rgba(240,248,255,0.98));border:2px solid #007BFF;border-radius:14px;padding:clamp(14px,3.5vw,18px) clamp(10px,2.5vw,14px);font-size:clamp(13px,3.2vw,15px);font-weight:600;color:#1A1B2F;cursor:pointer;transition:all 0.25s cubic-bezier(0.4,0,0.2,1);box-shadow:0 3px 10px rgba(0,123,255,0.15);min-height:clamp(60px,15vw,80px);display:flex;align-items:center;justify-content:center;text-align:center;font-family:'Baloo 2',sans-serif;line-height:1.3;touch-action:manipulation;position:relative;overflow:hidden}
.compact .item-btn{padding:10px 8px;min-height:52px;font-size:clamp(12px,3vw,14px);border-radius:10px}
.item-btn span{display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden;position:relative;z-index:2}
.item-btn:active{transform:scale(0.96)}
.item-btn.selected{background:linear-gradient(135deg,#1EA4FF,#007BFF);color:#fff;border-color:#007BFF;box-shadow:0 6px 16px rgba(30,164,255,0.4);animation:pulse 0.4s ease}
.item-btn.correct{background:linear-gradient(135deg,#22C55E,#16A34A);border-color:#16A34A;color:#fff}
.item-btn.wrong{background:linear-gradient(135deg,#EF4444,#DC2626);border-color:#DC2626;color:#fff}
@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.05)}}
.modal{position:fixed;inset:0;background:rgba(26,27,47,0.85);display:flex;align-items:center;justify-content:center;z-index:1000;padding:clamp(16px,4vw,24px);animation:fadeIn 0.3s ease;overflow-y:auto}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
.modal-box{background:#fff;border-radius:20px;padding:clamp(20px,5vw,32px);max-width:min(480px,92vw);width:100%;box-shadow:0 20px 60px rgba(0,0,0,0.3);animation:slideUp 0.4s cubic-bezier(0.34,1.56,0.64,1);max-height:90svh;overflow-y:auto;position:relative}
@keyframes slideUp{from{transform:translateY(40px);opacity:0}to{transform:translateY(0);opacity:1}}
.modal-box h1{font-size:clamp(20px,5vw,28px);font-weight:700;color:#1A1B2F;margin-bottom:clamp(12px,3vw,16px);line-height:1.2;text-align:center}
.modal-box p{font-size:clamp(14px,3.5vw,16px);color:#4A4A68;line-height:1.5;margin-bottom:clamp(16px,4vw,20px)}
.btn-primary{background:linear-gradient(135deg,#1EA4FF,#007BFF);color:#fff;border:none;border-radius:12px;padding:clamp(14px,3.5vw,16px) clamp(24px,6vw,32px);font-size:clamp(15px,3.8vw,17px);font-weight:700;cursor:pointer;box-shadow:0 6px 20px rgba(30,164,255,0.3);font-family:'Baloo 2',sans-serif;transition:all 0.3s ease;min-height:48px;width:100%;touch-action:manipulation;position:relative}
.btn-primary:active{transform:translateY(2px);box-shadow:0 3px 12px rgba(30,164,255,0.3)}
.results-grid{display:flex;flex-direction:column;gap:clamp(14px,3.5vw,18px);margin-bottom:clamp(20px,5vw,24px)}
.result-card{background:linear-gradient(135deg,rgba(245,247,250,0.98),rgba(255,255,255,0.98));border-radius:14px;padding:clamp(14px,3.5vw,18px);border-left:4px solid #007BFF;box-shadow:0 3px 10px rgba(0,0,0,0.06)}
.result-card.correct{border-left-color:#22C55E}
.result-card.wrong{border-left-color:#EF4444}
.result-card h3{font-size:clamp(13px,3.2vw,15px);font-weight:700;color:#1A1B2F;margin-bottom:6px}
.result-card p{font-size:clamp(12px,3vw,14px);color:#4A4A68;line-height:1.4;margin-bottom:4px}
.result-card .ans{font-weight:600;color:#007BFF}
.result-card.correct .ans{color:#16A34A}
.result-card.wrong .ans{color:#DC2626}
.advice-box{background:linear-gradient(135deg,#FEF3C7,#FDE68A);border-radius:14px;padding:clamp(16px,4vw,20px);margin-bottom:clamp(20px,5vw,24px);border:2px solid #F59E0B;box-shadow:0 4px 12px rgba(245,158,11,0.15)}
.advice-box h3{font-size:clamp(15px,3.8vw,18px);font-weight:700;color:#92400E;margin-bottom:8px}
.advice-box p{font-size:clamp(13px,3.2vw,15px);color:#78350F;line-height:1.4}
.score-banner{background:linear-gradient(135deg,#1EA4FF,#007BFF);color:#fff;border-radius:14px;padding:clamp(16px,4vw,20px);text-align:center;margin-bottom:clamp(20px,5vw,24px);box-shadow:0 6px 20px rgba(30,164,255,0.25)}
.score-banner h2{font-size:clamp(22px,5.5vw,32px);font-weight:700;margin-bottom:6px}
.score-banner p{font-size:clamp(14px,3.5vw,16px);opacity:0.95}
.hidden{display:none!important}
</style>
</head>
<body>
<div id="app"></div>
<script>
(function(){
const urlParams=new URLSearchParams(window.location.search);
const initDataParam=urlParams.get('initData')||'';
const scenarios=[
{scene:"Vas a instalar un enchufe en una cocina. Revisas el material:",items:["Cable de 1,5 mm¬≤ para toma de corriente","Destornillador aislado","Gafas de seguridad","Cinta aislante azul"],wrong:0,explain:"Cable de 1,5 mm¬≤ es insuficiente para enchufes de cocina (electrodom√©sticos potentes). Se requiere m√≠nimo 2,5 mm¬≤ seg√∫n normativa."},
{scene:"Antes de intervenir en el cuadro el√©ctrico:",items:["Cortar la corriente en el interruptor general","Verificar ausencia de tensi√≥n con pol√≠metro","Colocar se√±al de 'Trabajos en curso'","Usar guantes de algod√≥n"],wrong:3,explain:"Guantes de algod√≥n NO protegen de contacto el√©ctrico. Debes usar guantes diel√©ctricos homologados (categor√≠a m√≠nima 00 o 0)."},
{scene:"Tu compa√±ero sube a una escalera met√°lica para cablear:",items:["Escalera estable en suelo nivelado","Calzado con suela aislante","Escalera apoyada en pared","Arn√©s antica√≠das si supera 2 m"],wrong:2,explain:"Escalera met√°lica es conductora: riesgo de electrocuci√≥n. Usa escalera de fibra de vidrio o madera tratada en trabajos el√©ctricos."},
{scene:"Realizas empalmes en una caja de derivaci√≥n:",items:["Regletas de conexi√≥n homologadas","Cable pelado con 8-10 mm expuesto","Caja estanca si es zona h√∫meda","Empalmes retorcidos y con cinta aislante"],wrong:3,explain:"Empalmes retorcidos + cinta NO es seguro ni normativo. Siempre usar regletas, clemas o conectores homologados para garantizar contacto fiable."},
{scene:"Al terminar la jornada, dejas herramientas en la obra:",items:["Herramientas guardadas en malet√≠n","Cables recogidos y etiquetados","Cuadro el√©ctrico cerrado con llave","Pol√≠metro sobre el suelo junto al cuadro"],wrong:3,explain:"Dejar pol√≠metro (u otra herramienta) en el suelo es riesgo de tropiezo, robo o da√±o. Guarda todo el material en lugar seguro y ordenado."}
];
let currentScene=0;
let answers=[];
let gameState='intro';
function render(){
const app=document.getElementById('app');
if(gameState==='intro'){
app.innerHTML=`<div class="modal"><div class="modal-box"><img src="https://techkampe.github.io/daily-streak/assets/kampe_logo_oscuro.png" alt="K√§mpe" class="logo-img" style="display:block;margin:0 auto 16px;height:48px"><h1>¬°Alerta, novato! No metas la pata ‚ö°</h1><p>Te estrenas como electricista. En 5 situaciones reales, identifica el √∫nico elemento que representa un error o riesgo. Toca sobre √©l para avanzar. ¬°Atenci√≥n al detalle y seguridad primero!</p><button class="btn-primary" onclick="startGame()" aria-label="Comenzar reto">Comenzar reto</button></div></div>`;
}else if(gameState==='game'){
const s=scenarios[currentScene];
app.innerHTML=`<div class="scene"><div class="bg-avatar"></div><div class="hud"><img src="https://techkampe.github.io/daily-streak/assets/kampe_logo_oscuro.png" alt="K√§mpe" class="logo-img" loading="lazy"><div class="hud-right"><div class="progress-pill" aria-live="polite">${currentScene+1}/5</div></div></div><div class="content-area"><div class="scene-text"><h2>Situaci√≥n ${currentScene+1}</h2><p>${s.scene}</p></div><div class="items-grid" id="itemsGrid">${s.items.map((it,i)=>`<button class="item-btn" onclick="selectItem(${i})" aria-label="Opci√≥n: ${it}"><span>${it}</span></button>`).join('')}</div></div></div>`;
setTimeout(()=>ensureFits(),100);
}else if(gameState==='results'){
document.body.classList.add('results-view');
const correct=answers.filter(a=>a.correct).length;
const total=scenarios.length;
let advice="Recuerda: en electricidad no hay margen para el 'm√°s o menos'. Revisa siempre normativa, usa EPIs homologados y no improvises.";
if(correct===total)advice="¬°Excelente! Dominas los protocolos de seguridad. Mant√©n siempre esa atenci√≥n al detalle en cada intervenci√≥n.";
else if(correct>=3)advice="Buen ojo en la mayor√≠a de casos. Refuerza tu conocimiento de normativa y EPIs espec√≠ficos para trabajos el√©ctricos.";
app.innerHTML=`<div class="modal"><div class="modal-box"><img src="https://techkampe.github.io/daily-streak/assets/kampe_logo_oscuro.png" alt="K√§mpe" class="logo-img" style="display:block;margin:0 auto 16px;height:48px"><h1>Resumen del reto</h1><div class="score-banner"><h2>${correct} / ${total}</h2><p>Errores detectados correctamente</p></div><div class="results-grid">${answers.map((a,i)=>{const s=scenarios[i];const cls=a.correct?'correct':'wrong';return`<div class="result-card ${cls}"><h3>Situaci√≥n ${i+1}</h3><p><span class="ans">Tu elecci√≥n:</span> ${s.items[a.selected]}</p>${!a.correct?`<p><span class="ans">Correcto era:</span> ${s.items[s.wrong]}</p>`:'<p><span class="ans">¬°Correcto!</span></p>'}<p><strong>Explicaci√≥n:</strong> ${s.explain}</p></div>`;}).join('')}</div><div class="advice-box"><h3>üí° Consejo del maestro</h3><p>${advice}</p></div><button class="btn-primary" onclick="goReward()" aria-label="Ver recompensa">Ver mi recompensa</button></div></div>`;
}
}
window.startGame=function(){
gameState='game';
currentScene=0;
answers=[];
render();
};
window.selectItem=function(idx){
const s=scenarios[currentScene];
const btns=document.querySelectorAll('.item-btn');
btns.forEach(b=>b.style.pointerEvents='none');
const selected=btns[idx];
const isCorrect=idx===s.wrong;
selected.classList.add('selected');
setTimeout(()=>{
selected.classList.remove('selected');
selected.classList.add(isCorrect?'correct':'wrong');
if(!isCorrect){
btns[s.wrong].classList.add('correct');
}
},300);
answers.push({selected:idx,correct:isCorrect});
setTimeout(()=>{
currentScene++;
if(currentScene<scenarios.length){
gameState='game';
render();
}else{
gameState='results';
render();
}
},1400);
};
window.goReward=function(){
const target=`https://kampe-game-phaser.onrender.com/daily_streak?initData=${encodeURIComponent(initDataParam)}`;
window.location.href=target;
};
function ensureFits(){
const scene=document.querySelector('.scene');
if(!scene)return;
if(scene.scrollHeight<=scene.clientHeight+5)return;
scene.classList.add('compact');
setTimeout(()=>{
if(scene.scrollHeight<=scene.clientHeight+5)return;
const scale=Math.max(0.88,scene.clientHeight/scene.scrollHeight);
scene.style.transform=`scale(${scale})`;
scene.style.transformOrigin='top center';
},50);
}
window.addEventListener('resize',()=>{if(gameState==='game')setTimeout(ensureFits,100);});
window.addEventListener('orientationchange',()=>{if(gameState==='game')setTimeout(ensureFits,200);});
render();
})();
</script>
</body>
</html>

