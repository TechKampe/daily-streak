<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Kämpe | Elige la herramienta correcta ⚡️</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="color-scheme" content="light only" />
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    /* ===== Reset + base ===== */
    :root{
      --ui-scale: 1;
      --gap: 14px;
      --gap-sm: 10px;
      --radius: 14px;
      --glass: rgba(255,255,255,0.14);
      --glass-strong: rgba(255,255,255,0.20);
      --stroke: rgba(255,255,255,0.22);
      --txt: #f2f7ff;
      --txt-dim: #cfe3ff;
      --accent: #5CE1E6;
      --accent-2: #8BFF8F;
      --danger: #ff6b6b;
      --warn: #ffd166;
      --bg1: #0b3bdb;
      --bg2: #081f6b;
      --shadow: 0 8px 28px rgba(0,0,0,0.28);
      --h1: clamp(20px, 4.8vw, 26px);
      --h2: clamp(16px, 4.2vw, 20px);
      --body: clamp(14px, 3.7vw, 16px);
      --chip: clamp(14px, 3.8vw, 16px);
      --logoH: 28px;
    }
    *{ box-sizing: border-box; }
    html, body{
      height:100%;
      width:100%;
      margin:0;
      padding:0;
      overflow:hidden; /* locked during gameplay */
      overscroll-behavior: none;
      background: radial-gradient(120% 120% at 80% 0%, var(--bg1), var(--bg2) 60%);
      color: var(--txt);
      font-family: 'Manrope', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      -webkit-font-smoothing: antialiased;
      text-rendering: optimizeLegibility;
    }
    a { color: inherit; text-decoration: none; }

    /* ===== Scene sized to viewport with safe areas ===== */
    .scene{
      position: relative;
      isolation: isolate;
      width: 100%;
      height: 100vh; /* fallback */
      padding: calc(env(safe-area-inset-top, 0px) + 10px) calc(env(safe-area-inset-right, 0px) + 14px) calc(env(safe-area-inset-bottom, 0px) + 12px) calc(env(safe-area-inset-left, 0px) + 14px);
      display:flex;
      align-items: stretch;
      justify-content: center;
      overflow: hidden;
    }
    @supports (height: 100dvh){
      .scene{ height: 100dvh; }
    }
    @supports (height: 100svh){
      .scene{ height: 100svh; }
    }

    /* ===== Background avatar ===== */
    .avatar-bg{
      position:absolute;
      inset:0;
      background: radial-gradient(80% 60% at 100% -10%, rgba(255,255,255,0.10), transparent 60%);
      pointer-events:none;
      z-index:0;
      overflow:hidden;
    }
    .avatar-bg img{
      position:absolute;
      right:-10px; bottom:-6px;
      height: 65%;
      max-height: 520px;
      opacity: 0.18;
      filter: saturate(1.1);
      transform: translateZ(0);
      user-select:none;
      -webkit-user-drag: none;
    }

    /* ===== Main UI card ===== */
    .ui{
      position: relative;
      width: 100%;
      max-width: 460px;
      margin: auto;
      display:flex;
      flex-direction: column;
      justify-content: space-between;
      padding: 14px;
      background: linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.06));
      border: 1px solid var(--stroke);
      border-radius: 18px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(8px);
      transform-origin: top center;
      transform: scale(var(--ui-scale));
      z-index:1;
    }

    /* ===== HUD ===== */
    .hud{
      display:flex;
      align-items:center;
      gap: 10px;
      margin-bottom: 6px;
    }
    .logo{
      height: var(--logoH);
      width: auto;
      display:block;
    }
    .title-wrap{
      flex:1;
      min-width:0;
    }
    h1{
      margin:0;
      font-weight: 800;
      font-size: var(--h1);
      letter-spacing: 0.2px;
      line-height: 1.05;
      text-shadow: 0 2px 8px rgba(0,0,0,0.35);
      display:flex;
      align-items:center;
      gap:8px;
    }
    h1 .bolt{ filter: drop-shadow(0 3px 8px rgba(92,225,230,0.6)); }
    .progress{
      width:100%;
      height: 8px;
      background: rgba(255,255,255,0.16);
      border-radius: 999px;
      overflow:hidden;
      margin-top: 8px;
      border: 1px solid rgba(255,255,255,0.18);
    }
    .bar{
      height:100%;
      width: 0%;
      background: linear-gradient(90deg, var(--accent), #70F1D8 50%, var(--accent-2));
      box-shadow: 0 0 10px rgba(92,225,230,0.8);
      transition: width 280ms ease;
    }

    /* ===== Gameplay area (no scroll) ===== */
    .gameplay{
      position: relative;
      display:flex;
      flex-direction: column;
      justify-content: space-between;
      gap: var(--gap);
      padding: 10px 6px 8px;
      min-height: 320px;
      touch-action: none; /* anti-derrapes */
    }
    .question{
      margin-top: 4px;
      font-size: var(--h2);
      font-weight: 700;
      line-height: 1.25;
      min-height: 3.4em;
      display:flex;
      align-items:center;
      justify-content: center;
      text-align: center;
      color: var(--txt);
      text-wrap: balance;
    }
    .question .clamp{
      display: -webkit-box;
      -webkit-line-clamp: 2;
      line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    .blank{
      position: relative;
      display:inline-flex;
      align-items: center;
      padding: 0 4px;
      border-bottom: 3px solid var(--accent);
      color: var(--accent);
      min-width: 42px;
    }
    .blank .placeholder{
      opacity: 0.8;
      transition: opacity 160ms ease, transform 200ms ease;
    }
    .blank .fill{
      position:absolute;
      left:0; right:0;
      text-align:center;
      opacity: 0;
      transform: translateY(6px);
      transition: opacity 220ms ease, transform 220ms ease, color 220ms ease;
      pointer-events:none;
      white-space: nowrap;
    }
    .blank.filled .placeholder{ opacity: 0; transform: translateY(-6px); }
    .blank.filled .fill{ opacity: 1; transform: translateY(0); }

    .chips{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--gap);
      align-items: stretch;
    }
    .chip{
      user-select: none;
      display:flex;
      align-items:center;
      justify-content:center;
      min-height: 56px; /* >=44px */
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.06));
      color: var(--txt);
      font-weight: 700;
      font-size: var(--chip);
      letter-spacing: 0.1px;
      box-shadow: inset 0 -12px 18px rgba(0,0,0,0.12);
      transition: transform 80ms ease, background 180ms ease, border-color 180ms ease, box-shadow 180ms ease;
      -webkit-tap-highlight-color: transparent;
      position: relative;
    }
    .chip:active{ transform: translateY(1px) scale(0.99); }
    .chip:focus-visible{
      outline: 3px solid rgba(92,225,230,0.8);
      outline-offset: 2px;
    }
    .chip:hover{ background: linear-gradient(180deg, rgba(255,255,255,0.14), rgba(255,255,255,0.08)); }
    .chip .label{
      display: -webkit-box;
      -webkit-line-clamp: 2;
      line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      text-align: center;
    }
    .chip.correcting::after, .chip.wronging::after{
      content:'';
      position:absolute; inset:0;
      border-radius: inherit;
      box-shadow: 0 0 0 2px currentColor inset;
      opacity: 0; transform: scale(0.96);
      transition: opacity 220ms ease, transform 220ms ease;
    }
    .chip.correcting{ color: #082f12; background: linear-gradient(180deg,#8BFF8F,#57E36A); border-color: rgba(255,255,255,0.35); }
    .chip.correcting::after{ opacity: 0.35; transform: scale(1); }
    .chip.wronging{ color: #2b0b0b; background: linear-gradient(180deg,#ffb0b0,#ff6b6b); border-color: rgba(255,255,255,0.35); }
    .chip.wronging::after{ opacity: 0.25; transform: scale(1); }

    .foot{
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 10px;
      margin-top: 4px;
    }
    .step{
      font-size: 12px;
      color: var(--txt-dim);
      letter-spacing: 0.3px;
    }
    .hint{
      font-size: 12px;
      color: var(--txt-dim);
      text-align: right;
    }

    /* ===== Modals (intro + results) ===== */
    .modal{
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 16px;
      z-index: 3;
      background: linear-gradient(180deg, rgba(6,19,70,0.66), rgba(7,16,46,0.78));
      backdrop-filter: blur(3px);
    }
    .modal.active{ display:flex; }
    .sheet{
      width: 100%;
      max-width: 520px;
      max-height: 90svh;
      background: linear-gradient(180deg, rgba(255,255,255,0.13), rgba(255,255,255,0.08));
      border: 1px solid var(--stroke);
      border-radius: 18px;
      box-shadow: var(--shadow);
      padding: 16px;
      overflow-y: auto; /* allow internal scroll */
    }
    .sheet h2{
      margin: 0 0 8px 0;
      font-size: var(--h1);
    }
    .sheet p{
      margin: 6px 0;
      font-size: var(--body);
      color: var(--txt-dim);
    }
    .tutorial{
      margin: 8px 0 14px 0;
      padding: 10px 12px;
      border-radius: 12px;
      background: rgba(8, 31, 107, 0.38);
      border: 1px solid rgba(255,255,255,0.16);
      font-size: var(--body);
    }
    .cta-row{
      position: sticky;
      bottom: 0;
      display:flex;
      gap: 10px;
      padding-top: 10px;
      background: linear-gradient(180deg, transparent, rgba(0,0,0,0.12) 40%, rgba(0,0,0,0.18));
      margin-top: 10px;
    }
    .btn{
      flex:1;
      min-height: 48px;
      border-radius: 14px;
      border: 1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(255,255,255,0.14), rgba(255,255,255,0.08));
      color: var(--txt);
      font-weight: 800;
      font-size: var(--chip);
      display:flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      box-shadow: inset 0 -12px 18px rgba(0,0,0,0.12);
      -webkit-tap-highlight-color: transparent;
    }
    .btn.primary{
      background: linear-gradient(180deg, #70F1D8, #5CE1E6);
      color: #072b2f;
      border-color: rgba(255,255,255,0.35);
    }
    .btn.secondary{ }
    .btn:focus-visible{
      outline: 3px solid rgba(92,225,230,0.8);
      outline-offset: 3px;
    }
    .small-note{
      font-size: 12px; color: var(--txt-dim);
      text-align:center; width:100%;
      margin-top: 6px;
    }
    .warn{ color: var(--warn); }

    /* Results list */
    .result-item{
      margin: 10px 0;
      padding: 10px 12px;
      border-radius: 12px;
      background: rgba(255,255,255,0.10);
      border: 1px solid rgba(255,255,255,0.16);
    }
    .result-item .solved{
      font-weight: 800;
      margin: 0 0 6px;
      font-size: var(--body);
      line-height: 1.3;
    }
    .result-item .yours{
      font-size: 13px;
      margin: 0 0 6px;
      color: var(--txt-dim);
    }
    .result-item .yours .ok{ color: var(--accent-2); font-weight: 800; }
    .result-item .yours .bad{ color: var(--danger); font-weight: 800; }
    .result-item .explain{
      font-size: 13px;
      color: #eaf5ff;
    }

    /* ===== Compact mode for very small screens ===== */
    body.compact{
      --gap: 10px;
      --gap-sm: 8px;
      --radius: 12px;
      --logoH: 24px;
      --h1: clamp(18px, 5vw, 22px);
      --h2: clamp(15px, 4vw, 18px);
      --chip: clamp(13px, 3.6vw, 15px);
    }
    body.compact .question{ min-height: 3em; }
    body.compact .chip{ min-height: 52px; }

    /* Accessibility helpers */
    .sr-only{
      position:absolute !important;
      width:1px;height:1px;
      margin:-1px;padding:0;border:0;
      clip: rect(0 0 0 0); clip-path: inset(50%); overflow:hidden;
      white-space: nowrap;
    }
  </style>
</head>
<body>
  <div class="scene" id="scene" aria-live="polite">
    <div class="avatar-bg" aria-hidden="true">
      <img src="https://techkampe.github.io/daily-streak/assets/Avatar%203_low.png" alt="" loading="eager">
    </div>

    <div class="ui" id="ui">
      <!-- HUD -->
      <div class="hud">
        <img class="logo" src="https://techkampe.github.io/daily-streak/assets/kampe_logo_blanco.png" alt="Kämpe" loading="eager">
        <div class="title-wrap">
          <h1>Elige la herramienta correcta <span class="bolt" aria-hidden="true">⚡️</span></h1>
          <div class="progress" aria-hidden="true"><div class="bar" id="bar"></div></div>
        </div>
      </div>

      <!-- Gameplay -->
      <div class="gameplay" id="gameplay" role="group" aria-label="Reto de cloze">
        <div class="question" id="question">
          <span class="clamp">
            <span class="pre" id="preQ"></span>
            <span class="blank" id="blank" aria-live="polite" aria-label="hueco a completar">
              <span class="placeholder">___</span>
              <span class="fill" id="fill"></span>
            </span>
            <span class="post" id="postQ"></span>
          </span>
        </div>

        <div class="chips" id="chips" role="listbox" aria-label="Opciones">
          <!-- options injected -->
        </div>

        <div class="foot">
          <div class="step" id="step">1 / 6</div>
          <div class="hint">Toca una opción para continuar</div>
        </div>
      </div>
    </div>

    <!-- Intro Modal -->
    <div class="modal active" id="introModal" aria-modal="true" role="dialog" aria-labelledby="introTitle">
      <div class="sheet">
        <h2 id="introTitle">Elige la herramienta correcta ⚡️</h2>
        <p>Escenario: eres ayudante de electricista en una reforma; te piden herramientas y recuerdas pasos básicos de seguridad.</p>
        <div class="tutorial">
          Toca la opción correcta para completar la frase. 6 frases: al elegir, pasas a la siguiente.
        </div>
        <div class="cta-row">
          <button class="btn primary" id="startBtn" aria-label="Empezar el reto">Empezar</button>
        </div>
      </div>
    </div>

    <!-- Results Modal -->
    <div class="modal" id="resultsModal" aria-modal="true" role="dialog" aria-labelledby="resultsTitle">
      <div class="sheet">
        <h2 id="resultsTitle">Resultados</h2>
        <p id="scoreText">Has acertado 0/6.</p>
        <div id="resultsList">
          <!-- Filled with per-item feedback -->
        </div>
        <div class="tutorial" id="finalTip">
          Consejo: usa nombres correctos (multímetro, pinza, buscapolos, pelacables). Identifica símbolos V, A, Ω. Regla de oro: corta y verifica ausencia de tensión antes de manipular.
        </div>
        <div class="cta-row">
          <button class="btn secondary" id="retryBtn" aria-label="Repetir el reto">Repetir reto</button>
          <a class="btn primary" id="rewardBtn" href="#" aria-label="Ver mi recompensa">Ver mi recompensa</a>
        </div>
        <div class="small-note" id="initWarn" hidden>
          <span class="warn">Aviso:</span> no se encontró initData; podrás ver la recompensa, pero la sesión puede no guardarse.
        </div>
      </div>
    </div>
  </div>

  <script>
    /* =========================
       Data + State (in-memory)
       ========================= */
    const initData = new URLSearchParams(location.search).get('initData') || "";
    const DATA = [
      {
        pre: "Para medir tensión, uso el ",
        post: ".",
        options: [
          { text:"multímetro", correct:true },
          { text:"pinza amperimétrica", correct:false }
        ],
        explain: "El multímetro mide V de forma directa. La pinza está pensada para medir corriente sin abrir el circuito."
      },
      {
        pre: "Antes de tocar, corto el ",
        post: ".",
        options: [
          { text:"interruptor general", correct:true },
          { text:"neutro", correct:false }
        ],
        explain: "Se aísla cortando el interruptor general. Cortar solo el neutro deja la fase activa y es peligroso."
      },
      {
        pre: "Para detectar fase rápido, uso el ",
        post: ".",
        options: [
          { text:"buscapolos", correct:true },
          { text:"pelacables", correct:false }
        ],
        explain: "El buscapolos indica presencia de fase. El pelacables es para retirar aislamiento sin cortar el conductor."
      },
      {
        pre: "Para pelar sin dañar, uso ",
        post: ".",
        options: [
          { text:"pelacables", correct:true },
          { text:"cúter", correct:false }
        ],
        explain: "El pelacables ajusta al calibre y evita muescas. El cúter aumenta el riesgo de cortar hilos o la funda."
      },
      {
        pre: "Para apretar bornes, empleo ",
        post: ".",
        options: [
          { text:"destornillador aislado", correct:true },
          { text:"tenaza", correct:false }
        ],
        explain: "Usa destornillador con aislamiento. La tenaza no aplica par adecuado y puede dañar el borne."
      },
      {
        pre: "Para medir corriente sin abrir el circuito, uso ",
        post: ".",
        options: [
          { text:"pinza amperimétrica", correct:true },
          { text:"multímetro en serie", correct:false }
        ],
        explain: "La pinza mide corriente por efecto de campo sin interrumpir. El multímetro en serie requiere abrir el circuito."
      }
    ];
    const TOTAL = DATA.length;

    const state = {
      index: 0,
      answers: [] // { selected, correct }
    };

    /* =========================
       DOM refs
       ========================= */
    const scene = document.getElementById('scene');
    const ui = document.getElementById('ui');
    const introModal = document.getElementById('introModal');
    const resultsModal = document.getElementById('resultsModal');
    const startBtn = document.getElementById('startBtn');
    const retryBtn = document.getElementById('retryBtn');
    const rewardBtn = document.getElementById('rewardBtn');
    const initWarn = document.getElementById('initWarn');

    const preQ = document.getElementById('preQ');
    const postQ = document.getElementById('postQ');
    const blank = document.getElementById('blank');
    const fill = document.getElementById('fill');
    const chips = document.getElementById('chips');
    const step = document.getElementById('step');
    const bar = document.getElementById('bar');

    const scoreText = document.getElementById('scoreText');
    const resultsList = document.getElementById('resultsList');

    /* =========================
       Accessibility helpers
       ========================= */
    function setAriaProgress(i){
      const p = Math.round((i/TOTAL)*100);
      bar.style.width = p + '%';
      step.textContent = `${i+1} / ${TOTAL}`;
    }

    /* =========================
       Gameplay rendering
       ========================= */
    function renderQuestion(){
      const item = DATA[state.index];
      preQ.textContent = item.pre;
      postQ.textContent = item.post;
      fill.textContent = "";
      blank.classList.remove('filled');
      chips.innerHTML = "";
      item.options.slice(0,2).forEach((opt, idx)=>{
        const btn = document.createElement('button');
        btn.className = 'chip';
        btn.setAttribute('role', 'option');
        btn.setAttribute('aria-label', `Opción ${idx+1}: ${opt.text}`);
        btn.innerHTML = `<span class="label">${opt.text}</span>`;
        btn.addEventListener('click', ()=>onChoose(opt, btn));
        chips.appendChild(btn);
      });
      setAriaProgress(state.index);
      ensureFits();
    }

    function onChoose(opt, btn){
      // Prevent double taps
      if (chips.dataset.locked === '1') return;
      chips.dataset.locked = '1';

      // Fill microinteraction
      fill.textContent = opt.text;
      blank.classList.add('filled');

      // Correct/wrong flash
      const isCorrect = !!opt.correct;
      btn.classList.add(isCorrect ? 'correcting' : 'wronging');

      // Save answer
      state.answers[state.index] = { selected: opt.text, correct: isCorrect };

      // Advance after small delay
      setTimeout(()=>{
        if (state.index < TOTAL - 1){
          state.index += 1;
          renderQuestion();
          chips.dataset.locked = '0';
        } else {
          showResults();
        }
      }, 520);
    }

    /* =========================
       Results
       ========================= */
    function showResults(){
      // Update score
      const correctCount = state.answers.filter(a=>a && a.correct).length;
      scoreText.textContent = `Has acertado ${correctCount}/${TOTAL}.`;
      resultsList.innerHTML = "";

      // Build list
      DATA.forEach((item, i)=>{
        const chosen = state.answers[i]?.selected || "(sin respuesta)";
        const isCorrect = !!state.answers[i]?.correct;
        const correctText = item.options.find(o=>o.correct).text;

        const wrap = document.createElement('div');
        wrap.className = 'result-item';

        const solved = document.createElement('p');
        solved.className = 'solved';
        solved.textContent = `${item.pre}${correctText}${item.post}`;

        const yours = document.createElement('p');
        yours.className = 'yours';
        const markSpan = `<span class="${isCorrect? 'ok':'bad'}">${isCorrect? '✔' : '✘'}</span>`;
        yours.innerHTML = `Tu respuesta: ${chosen} ${markSpan}`;

        const explain = document.createElement('p');
        explain.className = 'explain';
        explain.textContent = item.explain;

        wrap.appendChild(solved);
        wrap.appendChild(yours);
        wrap.appendChild(explain);
        resultsList.appendChild(wrap);
      });

      // Prepare CTA link with initData
      const base = "https://kampe-game-phaser.onrender.com/daily_streak";
      const url = base + "?initData=" + encodeURIComponent(initData);
      rewardBtn.setAttribute('href', url);
      initWarn.hidden = !!initData;

      // Show modal
      resultsModal.classList.add('active');
      // Allow only modal to scroll (already overflow-y:auto on .sheet). Keep global locked.
    }

    /* =========================
       Start / Reset
       ========================= */
    function startGame(){
      state.index = 0;
      state.answers = new Array(TOTAL);
      introModal.classList.remove('active');
      resultsModal.classList.remove('active');
      renderQuestion();
    }
    function retryGame(){
      startGame();
    }

    /* =========================
       Fit-to-viewport utilities
       Required: assertNoOverflow, applyCompactMode, fitBoardToViewport, autoscaleUI, ensureFits
       ========================= */
    function assertNoOverflow(){
      // Check both dimensions; if content fits in scene without scroll
      return scene.scrollHeight <= scene.clientHeight && scene.scrollWidth <= scene.clientWidth;
    }
    function applyCompactMode(){
      document.body.classList.add('compact');
    }
    function fitBoardToViewport(){
      // Adjust spacing and internal sizes via CSS variables
      // We tweak by slightly reducing gap and min-heights through compact class already.
      // Here we can also reduce avatar opacity to declutter
      const avatar = document.querySelector('.avatar-bg img');
      if (avatar) avatar.style.opacity = '0.12';
    }
    function autoscaleUI(){
      // Compute a scale that makes UI fit vertically, capped at 0.88 minimum
      const contentH = scene.scrollHeight;
      const viewH = scene.clientHeight;
      let scale = Math.min(1, viewH / contentH);
      if (scale < 0.88) scale = 0.88;
      document.documentElement.style.setProperty('--ui-scale', scale.toFixed(3));
    }
    function ensureFits(){
      // Reset any previous scaling (but keep possible compact mode if already applied)
      document.documentElement.style.setProperty('--ui-scale', '1');
      // First try: normal
      if (assertNoOverflow()) return;
      // Second: compact mode
      if (!document.body.classList.contains('compact')) applyCompactMode();
      if (assertNoOverflow()) return;
      // Third: adjust board visuals
      fitBoardToViewport();
      if (assertNoOverflow()) return;
      // Fourth: autoscale
      autoscaleUI();
    }

    /* =========================
       Events
       ========================= */
    startBtn.addEventListener('click', ()=>{
      startGame();
      // Wait one frame to ensure layout updated, then fit
      requestAnimationFrame(ensureFits);
    });
    retryBtn.addEventListener('click', ()=>{
      resultsModal.classList.remove('active');
      retryGame();
      requestAnimationFrame(ensureFits);
    });
    // Keep UI fitted on viewport changes
    window.addEventListener('resize', ()=>ensureFits());
    window.addEventListener('orientationchange', ()=>{
      // Give time for address bar to settle
      setTimeout(ensureFits, 200);
    });

    // Initial mount: keep intro modal visible and fit card in viewport
    window.addEventListener('load', ()=>{
      // If intro is open, gameplay is hidden; still ensure the card fits
      ensureFits();
    });

    // Accessibility: allow Enter/Space to pick first focused option
    document.addEventListener('keydown', (e)=>{
      if ((e.key === 'Enter' || e.key === ' ') && document.activeElement.classList.contains('chip')){
        e.preventDefault();
        document.activeElement.click();
      }
    });
  </script>
</body>
</html>