<!DOCTYPE html><html lang="es"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no"><title>Kämpe · Detector de Peligros</title><link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;700&display=swap" rel="stylesheet"><style>
:root{--c-bg:#FFFFFF;--c-text:#1A1B2F;--c-cta-bg:#0B214A;--c-cta-text:#00E6BC;--c-accent:#00E6BC;--c-success:#04FFB4;--c-error:#F9577E;--c-info:#C5FFDF;--ui-scale:1;--v-gap:16px;--hudH:56px}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{height:100%;margin:0;background:#fff;color:var(--c-text);font-family:"Baloo 2",system-ui,Segoe UI,Roboto,Arial,sans-serif;overflow:hidden;overscroll-behavior:none}
button{font-family:inherit}
.app{position:relative;width:100%}
.scene{position:relative;display:flex;flex-direction:column;justify-content:space-between;gap:var(--v-gap);padding:calc(env(safe-area-inset-top) + 80px) max(16px,calc(env(safe-area-inset-right) + 16px)) calc(env(safe-area-inset-bottom) + 16px) max(16px,calc(env(safe-area-inset-left) + 16px));transform-origin:top center;touch-action:none}
@supports(height:100svh){.scene{height:100svh}}
@supports not (height:100svh){@supports(height:100dvh){.scene{height:100dvh}}}
@supports not (height:100dvh){.scene{height:100vh}}
.scene-inner{transform:scale(var(--ui-scale));display:flex;flex-direction:column;height:100%;justify-content:space-between}
.safeTR{position:absolute;top:0;right:0;width:110px;height:110px;pointer-events:none}
.avatar{position:absolute;left:0;bottom:6%;opacity:.10;filter:saturate(0.8) contrast(1.05);width:min(56vw,340px);max-width:360px;pointer-events:none}
.hud{min-height:var(--hudH);display:flex;align-items:center;justify-content:space-between;padding-right:120px}
.hud .title{font-weight:700;letter-spacing:.2px;font-size:clamp(16px,4.2vw,22px);margin:0;line-height:1.1}
.progress{display:flex;align-items:center;gap:8px}
.progress .pill{border:1px solid var(--c-accent);border-radius:999px;padding:6px 10px;font-weight:600;font-size:clamp(12px,3.3vw,14px);color:#0B214A}
.statement-wrap{display:flex;flex-direction:column;gap:10px;align-items:flex-start}
.statement{font-weight:700;font-size:clamp(18px,5.6vw,24px);line-height:1.15;max-width:680px}
.clamp2{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.controls{display:flex;gap:12px;align-items:center;justify-content:space-between}
.btn{flex:1;min-height:56px;border:none;border-radius:24px;background:var(--c-cta-bg);color:var(--c-cta-text);font-weight:700;font-size:clamp(15px,4.4vw,18px);box-shadow:0 8px 18px rgba(11,33,74,.25);cursor:pointer;outline:2px solid transparent;outline-offset:2px;transition:transform .06s ease,opacity .2s ease,box-shadow .2s}
.btn:active{transform:scale(.98)}
.btn:disabled{opacity:.45;box-shadow:none;cursor:not-allowed}
.btn:focus-visible{outline:2px dashed var(--c-accent)}
.flash{position:fixed;inset:0;pointer-events:none}
.flash::after{content:"";position:absolute;left:50%;top:50%;width:0;height:0;border-radius:999px;background:rgba(0,230,188,.12);transform:translate(-50%,-50%);animation:blip .34s ease}
@keyframes blip{0%{width:0;height:0;opacity:.6}100%{width:90vmax;height:90vmax;opacity:0}}
.progressbar{height:6px;border-radius:6px;background:rgba(11,33,74,.08);overflow:hidden;border:1px solid #E6FBF6}
.progressbar .fill{height:100%;width:0;background:linear-gradient(90deg,var(--c-success),#00ffc3);transition:width .28s ease}
.label-soft{display:inline-flex;align-items:center;gap:6px;background:#C5FFDF;color:#0B214A;border-radius:12px;padding:4px 8px;font-size:12px;border:1px solid var(--c-accent)}
.modal{position:absolute;left:50%;transform:translateX(-50%);top:calc(env(safe-area-inset-top) + 96px);width:min(92%,720px);max-height:90svh;background:#fff;border:1px solid var(--c-accent);border-radius:16px;box-shadow:0 12px 30px rgba(0,0,0,.08);padding:16px 16px 12px;display:none;overflow-y:auto}
.modal.visible{display:block}
.modal h2{margin:4px 0 6px;font-size:clamp(18px,5vw,22px);line-height:1.1}
.modal p{margin:6px 0 10px;font-size:clamp(14px,3.8vw,16px);color:#0B214A}
.modal .cta{position:sticky;bottom:0;margin-top:12px}
.list{display:flex;flex-direction:column;gap:10px;margin-top:8px}
.item{border:1px solid var(--c-accent);border-radius:12px;padding:10px 12px;background:#fff}
.item h3{margin:0 0 6px;font-size:15px;line-height:1.15}
.meta{display:flex;gap:8px;flex-wrap:wrap;margin:2px 0 6px}
.meta .tag{font-size:12px;padding:2px 6px;border-radius:10px;border:1px solid #E6FBF6}
.ok{color:#04795f}
.bad{color:#B0304E}
.small{font-size:13px;color:#0B214A}
.tip{margin:10px 0 12px;padding:10px;border:1px solid var(--c-accent);border-radius:12px;background:#C5FFDF;color:#0B214A}
.footer-cta{display:flex;gap:8px}
footer button, .cta .btn{width:100%}
.score{display:flex;align-items:center;justify-content:space-between;margin:6px 0 2px}
.score b{font-size:clamp(18px,5.2vw,22px)}
.kpi{display:flex;gap:8px}
.kpi .dot{width:10px;height:10px;border-radius:50%}
.kpi .g{background:var(--c-success)}.kpi .r{background:var(--c-error)}
.compact .hud .title{font-size:clamp(14px,3.6vw,18px)}
.compact .statement{font-size:clamp(16px,4.6vw,20px)}
.compact .btn{min-height:50px;font-size:clamp(14px,4vw,16px)}
.compact .avatar{width:min(48vw,280px)}
</style></head><body>
<div class="app">
  <div class="scene" id="scene" aria-live="polite">
    <img class="avatar" src="https://techkampe.github.io/daily-streak/assets/Avatar 4_low.png" alt="Avatar Kämpe" loading="eager">
    <div class="safeTR" aria-hidden="true"></div>
    <div class="scene-inner">
      <header class="hud" aria-label="Encabezado">
        <h1 class="title">Detector de Peligros ⚠️</h1>
        <div class="progress" aria-live="polite"><span class="pill" id="progText">0/8</span></div>
      </header>
      <div>
        <div class="statement-wrap">
          <div class="label-soft" id="miniHint">Ronda relámpago · PRL</div>
          <p class="statement clamp2" id="stmt">—</p>
        </div>
        <div style="margin-top:10px" class="progressbar" aria-hidden="true"><div class="fill" id="barFill"></div></div>
      </div>
      <footer>
        <div class="controls">
          <button class="btn" id="btnTrue" aria-label="Responder Verdadero">Verdadero</button>
          <button class="btn" id="btnFalse" aria-label="Responder Falso">Falso</button>
        </div>
      </footer>
    </div>
  </div>

  <div class="modal visible" id="intro" role="dialog" aria-modal="true" aria-labelledby="introT">
    <h2 id="introT">Cómo jugar</h2>
    <p>Lee la afirmación y decide rápido: ¿Verdadero o Falso? Tendrás 8 turnos. Verás el porqué al final.</p>
    <div class="cta"><button class="btn" id="startBtn" aria-label="Empezar">Empezar</button></div>
  </div>

  <div class="modal" id="results" role="dialog" aria-modal="true" aria-labelledby="resT">
    <h2 id="resT">Resumen del reto</h2>
    <div class="score">
      <b id="scoreText">Tu resultado</b>
      <div class="kpi"><span class="dot g"></span><span class="dot r"></span></div>
    </div>
    <div class="tip" id="finalTip">Consejo: prepara una checklist de EPIs antes de entrar a la obra. Dos minutos hoy evitan accidentes mañana.</div>
    <div class="list" id="detailList"></div>
    <div class="footer-cta" style="margin-top:12px">
      <button class="btn" onclick="completeTask()">Ver mi recompensa</button>
    </div>
  </div>
</div>

<script>
const data=[{t:"El casco se usa siempre dentro de la obra.",a:true,e:"Protege de impactos imprevistos y caídas de objetos; es EPI obligatorio salvo áreas claramente señalizadas como exentas."},{t:"Vale usar zapatillas si no hay riesgo.",a:false,e:"Se exige calzado de seguridad con puntera y suela reforzada; las zapatillas no son EPI y no protegen ante aplastamientos o clavos."},{t:"Las señales amarillas indican advertencia.",a:true,e:"En PRL, amarillo/negro avisa de peligro; rojo prohíbe, azul obliga y verde informa de salidas o socorro."},{t:"Subir a andamios con herramientas en mano.",a:false,e:"Usa portaherramientas o sistemas de izado; mantén las manos libres para agarrarte y evitar caídas."},{t:"Trabajar en altura sin arnés si es rápido.",a:false,e:"Cualquier trabajo con riesgo de caída requiere protección colectiva o arnés correctamente anclado."},{t:"Los guantes se eligen según el riesgo.",a:true,e:"No existe un guante universal: corte, químico, dieléctrico… deben ajustarse a la tarea."},{t:"Se puede fumar en zonas ventiladas de obra.",a:false,e:"Solo en áreas designadas; fuera de ellas hay riesgo de incendio, explosión y exposición a sustancias."},{t:"Mantener pasillos libres y bien iluminados.",a:true,e:"Orden y limpieza reducen tropiezos y choques; la iluminación ayuda a detectar riesgos a tiempo."}];
const total=data.length;
let i=0,answers=[];
const scene=document.getElementById("scene");
const intro=document.getElementById("intro");
const results=document.getElementById("results");
const stmt=document.getElementById("stmt");
const progText=document.getElementById("progText");
const barFill=document.getElementById("barFill");
const btnT=document.getElementById("btnTrue");
const btnF=document.getElementById("btnFalse");
const scoreText=document.getElementById("scoreText");
const detailList=document.getElementById("detailList");
const startBtn=document.getElementById("startBtn");

function clamp48(s){return s.length>48?s.slice(0,45)+"…":s}
function setScrollLock(locked){if(locked){document.documentElement.style.overflow="hidden";document.body.style.overflow="hidden";document.documentElement.style.overscrollBehavior="none"}else{document.documentElement.style.overflow="auto";document.body.style.overflowY="auto";document.documentElement.style.overscrollBehavior="auto"}}
function renderTurn(){const d=data[i];stmt.textContent=clamp48(d.t);progText.textContent=(i+1)+"/"+total;barFill.style.width=((i)/total*100)+"%";ensureFits()}
function flash(){const f=document.createElement("div");f.className="flash";document.body.appendChild(f);setTimeout(()=>f.remove(),340)}
function lockBtns(lock){btnT.disabled=lock;btnF.disabled=lock}
function next(){if(i<total-1){i++;renderTurn()}else{showResults()}}
function answer(val){lockBtns(true);answers[i]=val;flash();setTimeout(()=>{lockBtns(false);next()},280)}
btnT.onclick=()=>answer(true);btnF.onclick=()=>answer(false);
function start(){intro.classList.remove("visible");renderTurn();setScrollLock(true);ensureFits()}
startBtn.onclick=()=>{start()}

function showResults(){const score=answers.reduce((s,v,idx)=>s+(v===data[idx].a?1:0),0);scoreText.textContent=`Aciertos: ${score}/${total}`;detailList.innerHTML="";data.forEach((d,idx)=>{const li=document.createElement("div");li.className="item";const ok=answers[idx]===d.a;li.innerHTML=`<h3 class="clamp2">${clamp48(d.t)}</h3>
<div class="meta">
  <span class="tag">${ok?'<span style="color:var(--c-success)">✓</span>':'<span style="color:var(--c-error)">✕</span>'} ${ok?'Correcto':'Incorrecto'}</span>
  <span class="tag">Tu respuesta: <b>${answers[idx]?'Verdadero':'Falso'}</b></span>
  <span class="tag">Correcta: <b>${d.a?'Verdadero':'Falso'}</b></span>
</div>
<p class="small">${d.e}</p>`;detailList.appendChild(li)});barFill.style.width="100%";results.classList.add("visible");document.body.classList.add("results-mode");setScrollLock(false)}
function assertNoOverflow(){return scene.scrollHeight<=scene.clientHeight}
function applyCompactMode(on=true){document.body.classList.toggle("compact",on)}
function fitBoardToViewport(){document.documentElement.style.setProperty("--v-gap","10px");document.documentElement.style.setProperty("--hudH","48px")}
function autoscaleUI(){let scale=1;const min=0.88;while(!assertNoOverflow()&&scale>min){scale-=0.02;document.documentElement.style.setProperty("--ui-scale",scale.toFixed(2))}}
function resetFit(){document.documentElement.style.setProperty("--ui-scale","1");document.documentElement.style.setProperty("--v-gap","16px");document.documentElement.style.setProperty("--hudH","56px");applyCompactMode(false)}
function ensureFits(){resetFit();if(!assertNoOverflow()){applyCompactMode(true)}if(!assertNoOverflow()){fitBoardToViewport()}if(!assertNoOverflow()){autoscaleUI()}}
window.addEventListener("resize",ensureFits,{passive:true});window.addEventListener("orientationchange",()=>setTimeout(ensureFits,150),{passive:true});
document.addEventListener("keydown",e=>{if(intro.classList.contains("visible")&&(e.key==="Enter"||e.key===" ")){start()} else if(!results.classList.contains("visible")){if(e.key.toLowerCase()==="v"){answer(true)} if(e.key.toLowerCase()==="f"){answer(false)}}});
</script>
<script>
function completeTask(){if(window.ReactNativeWebView){window.ReactNativeWebView.postMessage(JSON.stringify({action:'TASK_COMPLETED'}))}}
</script>
</body></html>