
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no">
<title>Maestro de la Prevenci√≥n üë∑‚Äç‚ôÄÔ∏è | K√§mpe</title>
<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{width:100%;height:100%;overflow:hidden;overscroll-behavior:none;font-family:'Baloo 2',sans-serif;background:#F5F3EE;color:#1A1B2F}
.scene{width:100%;position:relative;display:flex;flex-direction:column;padding:env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);touch-action:none}
@supports(height:100svh){.scene{height:100svh}}
@supports not(height:100svh){.scene{height:100dvh}}
@supports not(height:100dvh){.scene{height:100vh}}
.scene.results-mode{overflow-y:auto;touch-action:auto}
.modal{position:fixed;inset:0;background:rgba(26,27,47,0.85);display:flex;align-items:center;justify-content:center;z-index:999;padding:1rem}
.modal-content{background:#FFF;border-radius:20px;padding:1.5rem;max-width:500px;width:100%;max-height:90svh;overflow-y:auto;box-shadow:0 8px 32px rgba(0,0,0,0.2);position:relative}
.modal-content h1{font-size:clamp(1.4rem,5vw,2rem);margin-bottom:0.5rem;color:#007BFF}
.modal-content p{font-size:clamp(0.9rem,3.5vw,1rem);line-height:1.4;margin-bottom:1rem;color:#1A1B2F}
.logo{width:80px;height:auto;margin-bottom:0.5rem}
.avatar-bg{position:absolute;bottom:0;right:0;width:40%;opacity:0.15;pointer-events:none;z-index:0}
.btn{background:linear-gradient(135deg,#1EA4FF,#007BFF);color:#FFF;border:none;padding:0.75rem 1.5rem;border-radius:50px;font-size:clamp(0.95rem,4vw,1.1rem);font-weight:600;font-family:'Baloo 2',sans-serif;cursor:pointer;transition:transform 0.2s,box-shadow 0.2s;box-shadow:0 4px 12px rgba(30,164,255,0.3);min-height:48px;touch-action:manipulation}
.btn:hover,.btn:focus{transform:translateY(-2px);box-shadow:0 6px 20px rgba(30,164,255,0.4);outline:3px solid #1EA4FF}
.btn:active{transform:translateY(0)}
.hud{display:flex;justify-content:space-between;align-items:center;padding:0.75rem 1rem;background:rgba(255,255,255,0.9);border-radius:16px;margin-bottom:0.75rem;box-shadow:0 2px 8px rgba(0,0,0,0.08)}
.hud-logo{height:32px;width:auto}
.progress-indicator{font-size:clamp(0.85rem,3.5vw,1rem);font-weight:700;color:#007BFF}
.question-container{flex:1;display:flex;flex-direction:column;justify-content:center;padding:1rem;overflow:hidden}
.question-text{font-size:clamp(1rem,4.5vw,1.3rem);font-weight:700;color:#1A1B2F;margin-bottom:1rem;line-height:1.3;display:-webkit-box;-webkit-line-clamp:4;-webkit-box-orient:vertical;overflow:hidden;text-align:center}
.options{display:flex;flex-direction:column;gap:0.75rem}
.option-btn{background:#FFF;color:#1A1B2F;border:3px solid #E0E0E0;padding:0.85rem 1rem;border-radius:16px;font-size:clamp(0.9rem,3.8vw,1rem);font-weight:600;font-family:'Baloo 2',sans-serif;cursor:pointer;transition:all 0.2s;min-height:48px;text-align:left;line-height:1.3;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;touch-action:manipulation}
.option-btn:hover,.option-btn:focus{border-color:#1EA4FF;background:#F0F9FF;transform:translateX(4px);outline:none}
.option-btn.correct{background:#4CAF50;color:#FFF;border-color:#4CAF50}
.option-btn.incorrect{background:#FF5252;color:#FFF;border-color:#FF5252}
.results-container{padding:1.5rem;background:#FFF;border-radius:20px;margin:1rem;box-shadow:0 4px 16px rgba(0,0,0,0.1)}
.results-container h2{font-size:clamp(1.3rem,5vw,1.8rem);color:#007BFF;margin-bottom:1rem}
.result-item{background:#F5F3EE;padding:1rem;border-radius:12px;margin-bottom:1rem;border-left:4px solid #007BFF}
.result-item.wrong{border-left-color:#FF5252}
.result-question{font-weight:700;margin-bottom:0.5rem;font-size:clamp(0.9rem,3.5vw,1rem)}
.result-answer{font-size:clamp(0.85rem,3.2vw,0.95rem);margin-bottom:0.25rem}
.result-answer.user{color:#1A1B2F}
.result-answer.correct{color:#4CAF50;font-weight:600}
.result-explanation{font-size:clamp(0.8rem,3vw,0.9rem);color:#555;margin-top:0.5rem;font-style:italic}
.advice-box{background:linear-gradient(135deg,#1EA4FF,#007BFF);color:#FFF;padding:1rem;border-radius:12px;margin:1rem 0;font-size:clamp(0.85rem,3.5vw,1rem);line-height:1.4}
.score-badge{background:linear-gradient(135deg,#FFD700,#FFA500);color:#1A1B2F;padding:0.75rem 1.5rem;border-radius:50px;font-size:clamp(1.1rem,4.5vw,1.4rem);font-weight:700;text-align:center;margin-bottom:1rem;box-shadow:0 4px 12px rgba(255,215,0,0.3)}
.fade-in{animation:fadeIn 0.3s ease-in}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
.compact .hud{padding:0.5rem 0.75rem;margin-bottom:0.5rem}
.compact .hud-logo{height:28px}
.compact .question-text{font-size:clamp(0.9rem,4vw,1.1rem);margin-bottom:0.75rem}
.compact .option-btn{padding:0.7rem 0.85rem;font-size:clamp(0.85rem,3.5vw,0.95rem)}
.compact .options{gap:0.5rem}
@media(max-height:640px){.question-container{padding:0.5rem}.options{gap:0.5rem}.option-btn{padding:0.7rem 0.85rem}}
</style>
</head>
<body>
<div class="scene" id="scene">
<div class="modal" id="introModal">
<div class="modal-content">
<img src="https://techkampe.github.io/daily-streak/assets/kampe_logo_oscuro.png" alt="K√§mpe" class="logo" loading="eager">
<h1>Maestro de la Prevenci√≥n üë∑‚Äç‚ôÄÔ∏è</h1>
<p>Est√°s en tu primer d√≠a en una obra y tu mentor te pone a prueba. Antes de coger ninguna herramienta, debes demostrar que sabes identificar los peligros.</p>
<p>Responde 5 situaciones sobre seguridad laboral eligiendo siempre la acci√≥n m√°s segura. ¬°Cada decisi√≥n cuenta!</p>
<button class="btn" id="startBtn" aria-label="Comenzar desaf√≠o">¬°Empezar!</button>
<img src="https://techkampe.github.io/daily-streak/assets/Avatar%203_low.png" alt="" class="avatar-bg" loading="lazy">
</div>
</div>
<div id="gameplayArea" style="display:none;height:100%;display:flex;flex-direction:column">
<div class="hud">
<img src="https://techkampe.github.io/daily-streak/assets/kampe_logo_oscuro.png" alt="K√§mpe" class="hud-logo" loading="eager">
<div class="progress-indicator" id="progressIndicator">1/5</div>
</div>
<div class="question-container fade-in" id="questionContainer">
<div class="question-text" id="questionText"></div>
<div class="options" id="optionsContainer"></div>
</div>
</div>
<div id="resultsArea" style="display:none"></div>
</div>
<script>
const questions=[
{q:"Vas a taladrar una pared. ¬øQu√© protecci√≥n es imprescindible?",opts:["Gafas de seguridad","Casco","Solo guantes"],correct:0,exp:"Las gafas protegen tus ojos de part√≠culas y polvo al taladrar."},
{q:"Encuentras cables sueltos en el suelo. ¬øQu√© haces?",opts:["Los recojo y se√±alizo la zona","Los dejo, no es mi trabajo","Los cubro con una alfombra"],correct:0,exp:"Recoger cables evita tropiezos y accidentes; se√±alizar advierte a otros."},
{q:"Debes levantar un saco de cemento de 25kg. ¬øC√≥mo lo haces?",opts:["Doblo rodillas, espalda recta","Doblo la espalda, piernas rectas","Pido ayuda siempre"],correct:0,exp:"Doblar rodillas y mantener la espalda recta previene lesiones lumbares."},
{q:"Ves una se√±al de 'Prohibido el paso'. ¬øQu√© haces?",opts:["Respeto la se√±al y busco otra ruta","Paso r√°pido, tengo prisa","Entro si no veo peligro visible"],correct:0,exp:"Las se√±ales protegen de peligros no siempre visibles; respetarlas es vital."},
{q:"Tu √°rea de trabajo est√° llena de herramientas. ¬øQu√© haces?",opts:["Organizo y guardo lo que no uso","Sigo trabajando con cuidado","Las apilo en una esquina"],correct:0,exp:"Un espacio ordenado reduce tropiezos y aumenta la eficiencia y seguridad."}
];
let currentQ=0,userAnswers=[],initData="";
const urlParams=new URLSearchParams(window.location.search);
initData=urlParams.get('initData')||"";
const scene=document.getElementById('scene');
const introModal=document.getElementById('introModal');
const gameplayArea=document.getElementById('gameplayArea');
const resultsArea=document.getElementById('resultsArea');
const startBtn=document.getElementById('startBtn');
const questionText=document.getElementById('questionText');
const optionsContainer=document.getElementById('optionsContainer');
const progressIndicator=document.getElementById('progressIndicator');
startBtn.addEventListener('click',()=>{
introModal.style.display='none';
gameplayArea.style.display='flex';
showQuestion();
ensureFits();
});
function showQuestion(){
if(currentQ>=questions.length){showResults();return}
const qData=questions[currentQ];
questionText.textContent=qData.q;
progressIndicator.textContent=`${currentQ+1}/${questions.length}`;
optionsContainer.innerHTML='';
qData.opts.forEach((opt,idx)=>{
const btn=document.createElement('button');
btn.className='option-btn';
btn.textContent=opt;
btn.setAttribute('aria-label',`Opci√≥n ${idx+1}: ${opt}`);
btn.addEventListener('click',()=>selectAnswer(idx));
optionsContainer.appendChild(btn);
});
document.getElementById('questionContainer').classList.add('fade-in');
setTimeout(()=>document.getElementById('questionContainer').classList.remove('fade-in'),300);
ensureFits();
}
function selectAnswer(idx){
userAnswers.push(idx);
const btns=optionsContainer.querySelectorAll('.option-btn');
btns.forEach(b=>b.disabled=true);
const correctIdx=questions[currentQ].correct;
btns[idx].classList.add(idx===correctIdx?'correct':'incorrect');
if(idx!==correctIdx)btns[correctIdx].classList.add('correct');
setTimeout(()=>{
currentQ++;
showQuestion();
},800);
}
function showResults(){
gameplayArea.style.display='none';
scene.classList.add('results-mode');
const score=userAnswers.filter((ans,i)=>ans===questions[i].correct).length;
let html=`<div class="results-container">
<img src="https://techkampe.github.io/daily-streak/assets/kampe_logo_oscuro.png" alt="K√§mpe" class="logo" loading="lazy">
<h2>Resultados üéØ</h2>
<div class="score-badge">Has acertado ${score} de ${questions.length}</div>`;
questions.forEach((q,i)=>{
const userAns=userAnswers[i];
const isCorrect=userAns===q.correct;
html+=`<div class="result-item ${isCorrect?'':'wrong'}">
<div class="result-question">${i+1}. ${q.q}</div>
<div class="result-answer user">Tu respuesta: ${q.opts[userAns]}</div>
${!isCorrect?`<div class="result-answer correct">Correcta: ${q.opts[q.correct]}</div>`:''}
<div class="result-explanation">${q.exp}</div>
</div>`;
});
html+=`<div class="advice-box"><strong>üí° Consejo:</strong> Usa siempre los EPIs adecuados y mant√©n tu zona de trabajo ordenada. La prevenci√≥n empieza por ti.</div>`;
const rewardUrl=`https://kampe-game-phaser.onrender.com/daily_streak${initData?'?initData='+encodeURIComponent(initData):''}`;
html+=`<button class="btn" onclick="window.location.href='${rewardUrl}'" aria-label="Ver mi recompensa">Ver mi recompensa</button>`;
if(!initData)html+=`<p style="font-size:0.8rem;color:#999;margin-top:0.5rem;text-align:center">‚ö†Ô∏è initData no detectado</p>`;
html+=`</div>`;
resultsArea.innerHTML=html;
resultsArea.style.display='block';
}
function ensureFits(){
if(currentQ>=questions.length||gameplayArea.style.display==='none')return;
const container=document.getElementById('questionContainer');
if(!container)return;
if(container.scrollHeight>container.clientHeight+5){
scene.classList.add('compact');
}
setTimeout(()=>{
if(container.scrollHeight>container.clientHeight+5){
const scale=Math.max(0.88,container.clientHeight/container.scrollHeight);
container.style.transform=`scale(${scale})`;
container.style.transformOrigin='top center';
}
},50);
}
window.addEventListener('resize',ensureFits);
window.addEventListener('orientationchange',()=>setTimeout(ensureFits,200));
</script>
</body>
</html>

