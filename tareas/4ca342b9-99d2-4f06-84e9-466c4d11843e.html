<!DOCTYPE html><html lang="es"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no"><title>¡Alerta Roja! Misión Electricista ⚡️</title><link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;700&display=swap" rel="stylesheet"><style>
:root{--txt:#1A1B2F;--cta:#0B214A;--ctaTxt:#00E6BC;--accent:#00E6BC;--ok:#04FFB4;--err:#F9577E;--soft:#C5FFDF;--ui-scale:1;--cellH:68px}
*{box-sizing:border-box}
html,body{height:100%;margin:0;background:#fff;color:var(--txt);font-family:"Baloo 2",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;overscroll-behavior:none}
html,body{overflow:hidden}
body.results-mode{overflow-y:auto}
button{font-family:inherit}
.scene{position:relative;width:100%;height:100vh}
@supports(height:100svh){.scene{height:100svh}}
@supports not (height:100svh){@supports(height:100dvh){.scene{height:100dvh}}}
.scene{padding-top:calc(80px + env(safe-area-inset-top));padding-right:calc(120px + env(safe-area-inset-right));padding-bottom:calc(16px + env(safe-area-inset-bottom));padding-left:calc(16px + env(safe-area-inset-left))}
.inner{height:100%;transform:scale(var(--ui-scale));transform-origin:top center;display:flex;flex-direction:column;gap:8px}
.hud{display:flex;align-items:center;gap:10px}
.progress{display:flex;align-items:center;gap:8px}
.pill{font-size:12px;background:var(--soft);color:#0B214A;border-radius:12px;padding:4px 10px;border:1px solid #A6F7D1}
.count{color:var(--accent);font-weight:700}
.bar{width:120px;height:8px;background:#E8FFF5;border:1px solid var(--accent);border-radius:8px;overflow:hidden}
.bar>i{display:block;height:100%;background:linear-gradient(90deg,#00E6BC,#04FFB4);width:0%}
.avatar{position:absolute;left:10px;bottom:10px;width:120px;opacity:.08;pointer-events:none;user-select:none}
.headerTitle{font-weight:700;font-size:clamp(18px,4.2vw,22px);line-height:1.1;margin:4px 0 0 0}
.question{margin:4px 0 0 0;font-weight:600;font-size:clamp(16px,3.6vw,20px);line-height:1.25;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.options{margin-top:6px;display:grid;grid-template-columns:1fr 1fr;gap:10px;touch-action:none}
.option{position:relative;min-height:44px;height:var(--cellH);border:1px solid var(--accent);border-radius:16px;background:#fff;box-shadow:0 8px 18px rgba(11,33,74,.08);padding:10px 12px;display:flex;align-items:center;justify-content:center;text-align:center;color:var(--cta);font-weight:700;font-size:clamp(14px,3.4vw,16px);cursor:pointer;transition:transform .1s ease,box-shadow .2s ease,border-color .2s ease,background .2s ease}
.option:focus-visible{outline:3px solid #00E6BC66}
.option span{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.option:active{transform:scale(.98)}
.option.selected{border-color:#0B214A;background:#F5FFFB}
.option.good{box-shadow:0 0 0 2px var(--ok) inset}
.option.bad{box-shadow:0 0 0 2px var(--err) inset}
.footerHint{margin-top:auto}
.hint{font-size:12px;color:#0B214A;background:#C5FFDF;border:1px solid #A6F7D1;padding:8px 10px;border-radius:12px;display:inline-block}
.cta{margin-top:12px;background:var(--cta);color:var(--ctaTxt);border:none;border-radius:24px;padding:12px 16px;min-height:44px;box-shadow:0 8px 18px rgba(11,33,74,.25);font-weight:700;font-size:clamp(15px,3.8vw,17px);width:100%}
.cta[disabled]{opacity:.45;box-shadow:none}
.fadeOut{animation:fo .28s ease forwards}
.fadeIn{animation:fi .28s ease forwards}
@keyframes fo{to{opacity:0;transform:translateY(10px)}}
@keyframes fi{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:none}}
.modal{position:fixed;inset:0;background:rgba(26,27,47,.14);display:flex;align-items:center;justify-content:center;padding:16px;z-index:20}
.card{max-height:90svh;max-width:520px;width:100%;background:#fff;border:1px solid var(--accent);border-radius:16px;padding:18px 16px;overflow-y:auto}
.card h2{margin:0 0 8px 0;font-size:clamp(20px,5vw,24px);line-height:1.1;color:var(--txt)}
.card p{margin:6px 0 0 0;line-height:1.25;font-size:clamp(14px,3.6vw,16px)}
.card .cta{margin-top:12px}
.hidden{display:none}
.resultsList{display:flex;flex-direction:column;gap:10px;margin-top:8px}
.itemCard{border:1px solid var(--accent);border-radius:14px;padding:12px}
.itemCard h4{margin:0 0 6px 0;font-size:16px}
.kv{display:grid;grid-template-columns:auto 1fr;gap:4px 8px;font-size:14px}
.kv b{color:#0B214A}
.kv .bad{color:var(--err)}
.kv .good{color:#059e79}
.tip{margin-top:12px;background:#C5FFDF;border:1px solid #A6F7D1;border-radius:12px;padding:10px;font-size:14px;color:#0B214A}
.compact .headerTitle{font-size:clamp(16px,3.6vw,19px)}
.compact .question{font-size:clamp(14px,3.2vw,18px)}
.compact .option{height:56px;border-radius:14px}
.compact .bar{width:100px}
.sr{position:absolute;clip:rect(0 0 0 0);clip-path:inset(50%);width:1px;height:1px;overflow:hidden;white-space:nowrap}
</style></head><body>
<div id="app" class="scene">
  <img class="avatar" src="https://techkampe.github.io/daily-streak/assets/Avatar%203_low.png" alt="" loading="eager">
  <div id="wrap" class="inner">
    <div class="hud">
      <span class="pill" aria-live="polite">Progreso <span class="count" id="count">1/5</span></span>
      <div class="bar" aria-hidden="true"><i id="bar"></i></div>
    </div>
    <h1 class="headerTitle">¡Alerta Roja! Misión Electricista ⚡️</h1>
    <div id="q" class="question">...</div>
    <div id="opts" class="options" role="group" aria-label="Opciones de escena"></div>
    <div class="footerHint"><span class="hint">Detecta el ítem peligroso. Avanzas solo.</span></div>
  </div>
</div>

<div id="intro" class="modal">
  <div class="card" role="dialog" aria-labelledby="t1" aria-modal="true">
    <h2 id="t1">¡Alerta Roja! Misión Electricista ⚡️</h2>
    <p>Te enfrentas a tus primeras tareas como electricista junior. En cada escena hay un fallo de seguridad. Toca el elemento incorrecto para evitar riesgos PRL.</p>
    <p class="hint" style="margin-top:8px">Tip: atención al detalle y corta la energía.</p>
    <button class="cta" id="startBtn" aria-label="Empezar el reto">Empezar</button>
  </div>
</div>

<div id="results" class="modal hidden">
  <div class="card" role="dialog" aria-labelledby="t2" aria-modal="true">
    <h2 id="t2">Resumen de la misión</h2>
    <p id="scoreP"></p>
    <div id="list" class="resultsList"></div>
    <div class="tip">Consejo: comunica riesgos al equipo, valida ausencia de tensión y no tengas prisa. La seguridad es parte del trabajo.</div>
    <button class="cta" onclick="completeTask()" aria-label="Ver mi recompensa">Ver mi recompensa</button>
  </div>
</div>

<script>
const MAX_LABEL=48,MAX_MODAL=180;
const scenes=[{
  scene:"Vas a cambiar un enchufe en una pared húmeda.",
  options:["Cortar la corriente desde el general","Trabajar con manos ligeramente mojadas","Usar guantes dieléctricos","Probar tensión con multímetro"],
  bad:1,
  why:"La humedad aumenta la conductividad. Seca y corta energía; usa EPIs y verifica ausencia de tensión."
},{
  scene:"Revisas un cuadro eléctrico doméstico.",
  options:["Destornillador con mango rajado","Gafas de seguridad","Bloquear y etiquetar LOTO","Comprobar ausencia de tensión"],
  bad:0,
  why:"Un mango dañado puede energizar la mano. Usa herramientas con aislamiento intacto y certificadas 1000V."
},{
  scene:"Tomas medidas en una lámpara del techo.",
  options:["Subir a una escalera estable","Apoyar escalera en puerta abierta","Usar calzado dieléctrico"],
  bad:1,
  why:"Una puerta puede moverse y volcarte. Asegura la escalera en suelo firme y bloquea accesos."
},{
  scene:"Empalmas cables en una caja de derivación.",
  options:["Usar regletas certificadas","Empalmar con cinta sin conector","Identificar fase/neutro/PE","Ajustar tornillos al par"],
  bad:1,
  why:"La cinta sola no garantiza contacto ni aislamiento. Usa bornes homologados y funda termo-retráctil."
},{
  scene:"Instalas una toma exterior en patio.",
  options:["Tomacorriente IP65 con tapa","Sin diferenciales 30 mA","Sellar pasamuros con silicona","Canaleta UV resistente"],
  bad:1,
  why:"En exterior, el diferencial de 30 mA es obligatorio para contactos indirectos y mayor protección."
}];
let state={i:0,answers:[],locked:false};

const el={app:document.getElementById('app'),wrap:document.getElementById('wrap'),q:document.getElementById('q'),opts:document.getElementById('opts'),count:document.getElementById('count'),bar:document.getElementById('bar'),intro:document.getElementById('intro'),results:document.getElementById('results'),list:document.getElementById('list'),scoreP:document.getElementById('scoreP')};

document.getElementById('startBtn').addEventListener('click',()=>{el.intro.classList.add('hidden');render();ensureFits()});

function trunc(s,max){return s.length>max?s.slice(0,max-1)+"…":s}
function render(){
  const sc=scenes[state.i];
  el.wrap.classList.remove('fadeIn');void el.wrap.offsetWidth;
  el.wrap.classList.add('fadeIn');
  el.count.textContent=(state.i+1)+"/"+scenes.length;
  el.bar.style.width=((state.i)/scenes.length*100)+"%";
  el.q.textContent=trunc(sc.scene,80);
  el.opts.innerHTML='';
  const opts=sc.options.map(o=>trunc(o,MAX_LABEL));
  opts.forEach((t,idx)=>{
    const b=document.createElement('button');
    b.className='option';
    b.setAttribute('aria-label','Opción '+(idx+1)+": "+t);
    b.innerHTML='<span>'+t+'</span>';
    b.onclick=()=>choose(idx);
    el.opts.appendChild(b);
  });
  state.locked=false;
  ensureFits();
}
function choose(idx){
  if(state.locked)return; state.locked=true;
  const sc=scenes[state.i], correct=sc.bad;
  const nodes=[...el.opts.children];
  nodes.forEach((n,i)=>{
    n.classList.add('selected');
    if(i===correct)n.classList.add('good');
    if(i===idx&&idx!==correct)n.classList.add('bad');
  });
  state.answers.push({i:state.i,chosen:idx,correct:correct});
  setTimeout(()=>{
    if(state.i<scenes.length-1){
      el.wrap.classList.add('fadeOut');
      setTimeout(()=>{state.i++;el.wrap.classList.remove('fadeOut');render()},240);
    }else{
      setTimeout(showResults,500);
    }
  },680);
}
function showResults(){
  htmlEnableScroll(true);
  el.bar.style.width="100%";
  const right=state.answers.filter(a=>a.chosen===a.correct).length;
  el.scoreP.textContent=`Aciertos: ${right}/${scenes.length}`;
  el.list.innerHTML='';
  state.answers.forEach((a,idx)=>{
    const sc=scenes[idx];
    const chosen=sc.options[a.chosen], ok=sc.options[a.correct];
    const card=document.createElement('div');
    card.className='itemCard';
    card.innerHTML=`<h4>Escena ${idx+1}</h4>
      <div class="kv"><b>Tu elección:</b><span class="${a.chosen===a.correct?'good':'bad'}">${trunc(chosen,MAX_LABEL)}</span>
      <b>Elemento incorrecto:</b><span>${trunc(ok,MAX_LABEL)}</span>
      <b>Por qué:</b><span>${trunc(sc.why,MAX_MODAL)}</span></div>`;
    el.list.appendChild(card);
  });
  el.results.classList.remove('hidden');
}
function htmlEnableScroll(on){document.documentElement.classList.toggle('results-mode',on);document.body.classList.toggle('results-mode',on)}
function assertNoOverflow(){const s=document.querySelector('.scene');return s.scrollHeight<=s.clientHeight}
function applyCompactMode(on=true){document.body.classList.toggle('compact',on)}
function fitBoardToViewport(){
  const h=window.innerHeight;let target=68;
  if(h<680)target=62;if(h<640)target=58;if(h<600)target=54;if(h<560)target=52;
  document.documentElement.style.setProperty('--cellH',target+'px');
}
function autoscaleUI(){
  const s=document.querySelector('.scene'),wrap=document.getElementById('wrap');
  let scale=1,tries=0;
  while(s.scrollHeight>s.clientHeight&&scale>0.88&&tries<8){scale-=0.02;tries++}
  document.documentElement.style.setProperty('--ui-scale',scale.toFixed(2));
}
function ensureFits(){
  document.documentElement.style.setProperty('--ui-scale',1);
  applyCompactMode(false);fitBoardToViewport();
  if(!assertNoOverflow()){applyCompactMode(true)}
  if(!assertNoOverflow()){fitBoardToViewport()}
  if(!assertNoOverflow()){autoscaleUI()}
}
window.addEventListener('resize',ensureFits);
window.addEventListener('orientationchange',()=>setTimeout(ensureFits,200));
</script>

<script>
function completeTask(){if(window.ReactNativeWebView){window.ReactNativeWebView.postMessage(JSON.stringify({action:'TASK_COMPLETED'}))}}
</script>
</body></html>