
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no">
<title>Maestro de la Prevenci√≥n üë∑‚Äç‚ôÄÔ∏è</title>
<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{width:100%;height:100%;overflow:hidden;overscroll-behavior:none;font-family:'Baloo 2',sans-serif;background:#F5F3EF;color:#1A1B2F}
.scene{width:100%;display:flex;flex-direction:column;position:relative;padding:env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left)}
@supports(height:100svh){.scene{height:100svh}}
@supports not(height:100svh){.scene{height:100dvh}}
@supports not(height:100dvh){.scene{height:100vh}}
.modal{position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(26,27,47,0.85);display:flex;align-items:center;justify-content:center;z-index:100;padding:1rem}
.modal-content{background:#FFF;border-radius:20px;padding:1.5rem;max-width:480px;width:100%;max-height:90svh;overflow-y:auto;box-shadow:0 8px 32px rgba(30,164,255,0.3);position:relative}
.modal-content h1{font-size:clamp(1.4rem,5vw,1.8rem);color:#1A1B2F;margin-bottom:0.5rem;font-weight:700}
.modal-content p{font-size:clamp(0.9rem,3.5vw,1rem);color:#4A5568;line-height:1.5;margin-bottom:1rem}
.btn{background:linear-gradient(135deg,#1EA4FF,#007BFF);color:#FFF;border:none;border-radius:12px;padding:0.75rem 1.5rem;font-size:clamp(0.95rem,4vw,1.1rem);font-weight:600;cursor:pointer;min-height:48px;font-family:'Baloo 2',sans-serif;transition:transform 0.2s,box-shadow 0.2s;box-shadow:0 4px 12px rgba(30,164,255,0.3);touch-action:manipulation}
.btn:hover,.btn:focus{transform:translateY(-2px);box-shadow:0 6px 20px rgba(30,164,255,0.4);outline:3px solid #1EA4FF;outline-offset:2px}
.btn:active{transform:translateY(0)}
.avatar-bg{position:absolute;bottom:-20px;right:-20px;width:280px;height:280px;opacity:0.15;pointer-events:none;z-index:0}
.game-container{flex:1;display:flex;flex-direction:column;padding:1rem;overflow:hidden;position:relative}
.hud{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;background:#FFF;border-radius:12px;padding:0.75rem 1rem;box-shadow:0 2px 8px rgba(0,0,0,0.08)}
.progress{font-size:clamp(0.9rem,3.5vw,1rem);font-weight:600;color:#1A1B2F}
.question-card{background:#FFF;border-radius:16px;padding:1.25rem;margin-bottom:1rem;box-shadow:0 4px 16px rgba(0,0,0,0.1);flex-shrink:0}
.question-card h2{font-size:clamp(1rem,4vw,1.2rem);color:#1A1B2F;margin-bottom:0.75rem;font-weight:600;line-height:1.4}
.options{display:flex;flex-direction:column;gap:0.75rem;overflow-y:auto;max-height:50vh}
.option-btn{background:#F7FAFC;border:2px solid #E2E8F0;border-radius:12px;padding:0.85rem 1rem;font-size:clamp(0.85rem,3.5vw,0.95rem);color:#1A1B2F;text-align:left;cursor:pointer;min-height:48px;font-family:'Baloo 2',sans-serif;font-weight:500;transition:all 0.2s;line-height:1.3;display:flex;align-items:center}
.option-btn:hover,.option-btn:focus{background:linear-gradient(135deg,#E0F2FF,#D0EBFF);border-color:#1EA4FF;outline:2px solid #1EA4FF;outline-offset:2px;transform:translateX(4px)}
.option-btn.correct{background:linear-gradient(135deg,#D4EDDA,#C3E6CB);border-color:#28A745;color:#155724}
.option-btn.incorrect{background:linear-gradient(135deg,#F8D7DA,#F5C6CB);border-color:#DC3545;color:#721C24}
.results{background:#FFF;border-radius:16px;padding:1.5rem;overflow-y:auto;max-height:calc(100svh - 2rem)}
.results h2{font-size:clamp(1.3rem,5vw,1.6rem);color:#1A1B2F;margin-bottom:1rem;font-weight:700}
.result-item{background:#F7FAFC;border-radius:12px;padding:1rem;margin-bottom:0.75rem;border-left:4px solid #1EA4FF}
.result-item.wrong{border-left-color:#DC3545}
.result-item h3{font-size:clamp(0.9rem,3.5vw,1rem);color:#1A1B2F;margin-bottom:0.5rem;font-weight:600}
.result-item p{font-size:clamp(0.8rem,3vw,0.9rem);color:#4A5568;margin:0.25rem 0;line-height:1.4}
.result-item .label{font-weight:600;color:#1A1B2F}
.advice{background:linear-gradient(135deg,#E0F2FF,#D0EBFF);border-radius:12px;padding:1rem;margin:1rem 0;border-left:4px solid #1EA4FF}
.advice p{font-size:clamp(0.85rem,3.5vw,0.95rem);color:#1A1B2F;line-height:1.5}
.score{text-align:center;font-size:clamp(1.1rem,4.5vw,1.3rem);color:#1EA4FF;font-weight:700;margin-bottom:1rem}
.hidden{display:none}
.fade-in{animation:fadeIn 0.3s ease-in}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
.compact .hud{padding:0.5rem 0.75rem;margin-bottom:0.5rem}
.compact .question-card{padding:1rem;margin-bottom:0.75rem}
.compact .question-card h2{font-size:clamp(0.9rem,3.5vw,1.05rem);margin-bottom:0.5rem}
.compact .option-btn{padding:0.65rem 0.85rem;font-size:clamp(0.8rem,3vw,0.9rem);min-height:44px}
.compact .options{gap:0.5rem}
@media(max-height:640px){.game-container{padding:0.75rem}.question-card{padding:1rem;margin-bottom:0.75rem}.options{gap:0.5rem}.option-btn{padding:0.65rem 0.85rem;min-height:44px}}
</style>
</head>
<body>
<div class="scene" id="app">
<div class="modal" id="intro-modal">
<div class="modal-content">
<h1>Maestro de la Prevenci√≥n üë∑‚Äç‚ôÄÔ∏è</h1>
<p>Est√°s en tu primer d√≠a en una obra y tu mentor te pone a prueba. Antes de coger ninguna herramienta, debes demostrar que sabes identificar los peligros.</p>
<p><strong>Tutorial:</strong> Lee cada situaci√≥n y elige la acci√≥n m√°s segura. Avanzar√°s autom√°ticamente tras cada respuesta.</p>
<img class="avatar-bg" src="https://techkampe.github.io/daily-streak/assets/Avatar%202_low.png" alt="" loading="eager">
<button class="btn" onclick="startGame()">Empezar el reto</button>
</div>
</div>
<div class="game-container hidden" id="game-container">
<div class="hud">
<div class="progress" id="progress">1/5</div>
</div>
<div class="question-card fade-in" id="question-card">
<h2 id="question-text"></h2>
</div>
<div class="options" id="options-container"></div>
</div>
<div class="results hidden" id="results"></div>
</div>
<script>
const urlParams=new URLSearchParams(window.location.search);
const initData=urlParams.get('initData')||'';
const questions=[
{q:"Vas a cortar madera con una sierra circular. ¬øQu√© debes usar?",options:["Gafas de seguridad y guantes","Solo guantes","Nada, ya tengo cuidado"],correct:0,explanation:"Las gafas protegen tus ojos de virutas y los guantes evitan cortes."},
{q:"Ves una zona con un cartel rojo de 'Prohibido el paso'. ¬øQu√© haces?",options:["Entro r√°pido, no pasa nada","Respeto la se√±al y busco otra ruta","Pregunto a un compa√±ero si puedo pasar"],correct:1,explanation:"Las se√±ales de prohibici√≥n existen para evitar accidentes graves. Siempre resp√©talas."},
{q:"Debes levantar un saco de cemento de 25kg. ¬øC√≥mo lo haces?",options:["Doblo las rodillas y mantengo la espalda recta","Lo levanto r√°pido tirando de la espalda","Pido ayuda a un compa√±ero"],correct:0,explanation:"Doblar rodillas protege tu columna. Si es muy pesado, pide ayuda."},
{q:"Tu zona de trabajo est√° llena de cables y herramientas. ¬øQu√© haces?",options:["Dejo todo como est√°, ya lo recoger√© luego","Organizo y retiro obst√°culos antes de empezar","Aparto solo lo que estorba mucho"],correct:1,explanation:"Un espacio ordenado previene tropiezos y accidentes. Siempre despeja antes."},
{q:"Hace calor y trabajas al sol. Tu compa√±ero se marea. ¬øQu√© haces?",options:["Le digo que descanse un rato a la sombra","Sigo trabajando, √©l sabr√° qu√© hacer","Le llevo agua y aviso al encargado"],correct:2,explanation:"El golpe de calor es grave. Hidrataci√≥n inmediata y avisar al responsable es clave."}
];
let currentQuestion=0;
let userAnswers=[];
function startGame(){
document.getElementById('intro-modal').classList.add('hidden');
document.getElementById('game-container').classList.remove('hidden');
loadQuestion();
setTimeout(ensureFits,100);
}
function loadQuestion(){
if(currentQuestion>=questions.length){
showResults();
return;
}
const q=questions[currentQuestion];
document.getElementById('progress').textContent=`${currentQuestion+1}/${questions.length}`;
document.getElementById('question-text').textContent=q.q;
const optionsContainer=document.getElementById('options-container');
optionsContainer.innerHTML='';
q.options.forEach((opt,idx)=>{
const btn=document.createElement('button');
btn.className='option-btn';
btn.textContent=opt;
btn.setAttribute('aria-label',opt);
btn.onclick=()=>selectAnswer(idx);
optionsContainer.appendChild(btn);
});
document.getElementById('question-card').classList.add('fade-in');
setTimeout(()=>document.getElementById('question-card').classList.remove('fade-in'),300);
setTimeout(ensureFits,50);
}
function selectAnswer(idx){
const q=questions[currentQuestion];
userAnswers.push(idx);
const btns=document.querySelectorAll('.option-btn');
btns.forEach((btn,i)=>{
btn.disabled=true;
if(i===q.correct)btn.classList.add('correct');
else if(i===idx)btn.classList.add('incorrect');
});
setTimeout(()=>{
currentQuestion++;
loadQuestion();
},800);
}
function showResults(){
document.getElementById('game-container').classList.add('hidden');
const resultsDiv=document.getElementById('results');
resultsDiv.classList.remove('hidden');
document.querySelector('.scene').style.overflowY='auto';
let score=0;
questions.forEach((q,i)=>{
if(userAnswers[i]===q.correct)score++;
});
let html=`<h2>Resultados</h2><div class="score">Has acertado ${score} de ${questions.length}</div>`;
questions.forEach((q,i)=>{
const isCorrect=userAnswers[i]===q.correct;
if(!isCorrect)score++;
html+=`<div class="result-item ${isCorrect?'':'wrong'}">
<h3>${q.q}</h3>
<p><span class="label">Tu respuesta:</span> ${q.options[userAnswers[i]]}</p>
<p><span class="label">Correcta:</span> ${q.options[q.correct]}</p>
<p><em>${q.explanation}</em></p>
</div>`;
});
html+=`<div class="advice"><p><strong>Consejo:</strong> La prevenci√≥n salva vidas. Usa siempre tus EPIs, respeta las se√±ales y mant√©n tu zona ordenada.</p></div>`;
if(!initData){
html+=`<p style="color:#DC3545;font-size:0.85rem;margin-bottom:0.5rem;">‚ö†Ô∏è initData no detectado</p>`;
}
html+=`<button class="btn" onclick="goToReward()" style="width:100%">Ver mi recompensa</button>`;
resultsDiv.innerHTML=html;
}
function goToReward(){
const url=`https://kampe-game-phaser.onrender.com/daily_streak?initData=${encodeURIComponent(initData)}`;
window.location.href=url;
}
function ensureFits(){
const scene=document.querySelector('.scene');
const gameContainer=document.getElementById('game-container');
if(gameContainer.classList.contains('hidden'))return;
if(scene.scrollHeight>scene.clientHeight+5){
gameContainer.classList.add('compact');
setTimeout(()=>{
if(scene.scrollHeight>scene.clientHeight+5){
const scale=Math.max(0.88,scene.clientHeight/scene.scrollHeight);
gameContainer.style.transform=`scale(${scale})`;
gameContainer.style.transformOrigin='top center';
}
},50);
}
}
window.addEventListener('resize',ensureFits);
window.addEventListener('orientationchange',()=>setTimeout(ensureFits,300));
</script>
</body>
</html>

