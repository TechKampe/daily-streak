
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no">
<title>Misi√≥n Seguridad: Primer d√≠a en la obra üë∑‚Äç‚ôÄÔ∏è</title>
<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{width:100%;height:100%;overflow:hidden;overscroll-behavior:none;font-family:'Baloo 2',sans-serif;background:#F5F5F0;color:#1A1B2F}
.scene{width:100%;position:relative;display:flex;flex-direction:column;padding:env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);touch-action:none}
@supports(height:100svh){.scene{height:100svh}}
@supports not(height:100svh){.scene{height:100dvh}}
@supports not(height:100dvh){.scene{height:100vh}}
.scene.results-view{overflow-y:auto;touch-action:auto}
.avatar-bg{position:absolute;top:0;left:0;width:100%;height:100%;background:url('https://techkampe.github.io/daily-streak/assets/Avatar%202_low.png') center/cover no-repeat;opacity:0.08;pointer-events:none;z-index:0}
.logo{position:absolute;top:12px;left:12px;width:80px;height:auto;z-index:10}
.compact .logo{width:60px;top:8px;left:8px}
.modal{position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(26,27,47,0.85);display:flex;align-items:center;justify-content:center;z-index:100;padding:20px}
.modal-content{background:#FFF;border-radius:16px;padding:clamp(20px,5vw,32px);max-width:500px;width:100%;max-height:90svh;overflow-y:auto;box-shadow:0 8px 24px rgba(0,0,0,0.2);text-align:center}
.modal-content h1{font-size:clamp(1.3rem,5vw,1.8rem);margin-bottom:12px;color:#007BFF;line-height:1.2}
.modal-content p{font-size:clamp(0.9rem,3.5vw,1rem);margin-bottom:20px;color:#555;line-height:1.4}
.btn{background:linear-gradient(135deg,#1EA4FF,#007BFF);color:#FFF;border:none;border-radius:12px;padding:14px 24px;font-size:clamp(0.95rem,4vw,1.1rem);font-weight:600;cursor:pointer;transition:transform 0.2s,box-shadow 0.2s;min-height:44px;font-family:inherit;display:inline-block;text-align:center;box-shadow:0 4px 12px rgba(30,164,255,0.3)}
.btn:hover,.btn:focus{transform:translateY(-2px);box-shadow:0 6px 16px rgba(30,164,255,0.4);outline:3px solid rgba(30,164,255,0.5)}
.btn:active{transform:translateY(0)}
.hud{position:relative;z-index:5;padding:clamp(12px,3vw,20px) clamp(12px,4vw,20px);background:rgba(255,255,255,0.9);border-radius:12px;margin:clamp(8px,2vw,12px) clamp(8px,3vw,12px);box-shadow:0 2px 8px rgba(0,0,0,0.1);display:flex;justify-content:space-between;align-items:center;flex-shrink:0}
.compact .hud{padding:8px 12px;margin:6px 8px}
.hud-progress{font-size:clamp(0.85rem,3.5vw,1rem);font-weight:600;color:#007BFF}
.compact .hud-progress{font-size:clamp(0.75rem,3vw,0.9rem)}
.gameplay{flex:1;display:flex;flex-direction:column;justify-content:center;align-items:center;padding:clamp(12px,3vw,20px);position:relative;z-index:5;overflow:hidden}
.compact .gameplay{padding:8px 12px}
.question-card{background:#FFF;border-radius:16px;padding:clamp(16px,4vw,24px);box-shadow:0 4px 16px rgba(0,0,0,0.1);width:100%;max-width:500px;text-align:center;animation:fadeIn 0.3s ease}
.compact .question-card{padding:12px 16px}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
.question-card h2{font-size:clamp(1rem,4.5vw,1.3rem);margin-bottom:clamp(12px,3vw,20px);color:#1A1B2F;line-height:1.3;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden}
.compact .question-card h2{font-size:clamp(0.9rem,4vw,1.1rem);margin-bottom:10px}
.answers{display:flex;flex-direction:column;gap:clamp(8px,2vw,12px)}
.compact .answers{gap:6px}
.answer-btn{background:linear-gradient(135deg,#E8F4FD,#D1E9F9);color:#1A1B2F;border:2px solid #1EA4FF;border-radius:12px;padding:clamp(10px,2.5vw,14px) clamp(12px,3vw,16px);font-size:clamp(0.85rem,3.8vw,1rem);font-weight:600;cursor:pointer;transition:all 0.2s;min-height:44px;font-family:inherit;text-align:center;line-height:1.3;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.compact .answer-btn{padding:8px 12px;font-size:clamp(0.8rem,3.5vw,0.95rem);min-height:40px}
.answer-btn:hover,.answer-btn:focus{background:linear-gradient(135deg,#1EA4FF,#007BFF);color:#FFF;transform:translateY(-2px);box-shadow:0 4px 12px rgba(30,164,255,0.3);outline:3px solid rgba(30,164,255,0.5)}
.answer-btn:active{transform:translateY(0)}
.answer-btn.correct{background:linear-gradient(135deg,#4CAF50,#45A049);color:#FFF;border-color:#4CAF50}
.answer-btn.incorrect{background:linear-gradient(135deg,#FF6B6B,#EE5A52);color:#FFF;border-color:#FF6B6B}
.results{padding:clamp(16px,4vw,24px);position:relative;z-index:5}
.results h2{font-size:clamp(1.2rem,5vw,1.6rem);color:#007BFF;margin-bottom:clamp(12px,3vw,20px);text-align:center}
.result-item{background:#FFF;border-radius:12px;padding:clamp(12px,3vw,16px);margin-bottom:clamp(10px,2.5vw,16px);box-shadow:0 2px 8px rgba(0,0,0,0.1)}
.result-item h3{font-size:clamp(0.9rem,4vw,1.1rem);margin-bottom:8px;color:#1A1B2F;line-height:1.3}
.result-item p{font-size:clamp(0.8rem,3.5vw,0.95rem);margin:4px 0;color:#555;line-height:1.4}
.result-item .user-answer{color:#FF6B6B;font-weight:600}
.result-item .correct-answer{color:#4CAF50;font-weight:600}
.result-item.correct-result{border-left:4px solid #4CAF50}
.result-item.incorrect-result{border-left:4px solid #FF6B6B}
.final-tip{background:linear-gradient(135deg,#FFF9E6,#FFF4CC);border-left:4px solid #FFC107;padding:clamp(12px,3vw,16px);border-radius:12px;margin:clamp(16px,4vw,24px) 0;font-size:clamp(0.85rem,3.8vw,1rem);color:#1A1B2F;line-height:1.4}
.final-tip strong{color:#F57C00}
.score-summary{text-align:center;font-size:clamp(1rem,4.5vw,1.3rem);font-weight:700;color:#007BFF;margin-bottom:clamp(16px,4vw,24px)}
.cta-final{text-align:center;margin-top:clamp(16px,4vw,24px)}
.warning{font-size:0.75rem;color:#FF6B6B;margin-top:8px}
</style>
</head>
<body>
<div class="scene" id="scene">
<div class="avatar-bg"></div>
<img src="https://techkampe.github.io/daily-streak/assets/kampe_logo_oscuro.png" alt="K√§mpe" class="logo" loading="eager">
<div class="modal" id="introModal">
<div class="modal-content">
<h1>Misi√≥n Seguridad: Primer d√≠a en la obra üë∑‚Äç‚ôÄÔ∏è</h1>
<p>Tu encargado te har√° 5 preguntas sobre EPIs y seguridad. Elige la respuesta correcta en cada una.</p>
<button class="btn" id="startBtn" aria-label="Comenzar misi√≥n">Comenzar</button>
</div>
</div>
<div class="hud" id="hud" style="display:none">
<div class="hud-progress" id="progress" aria-live="polite">1/5</div>
</div>
<div class="gameplay" id="gameplay" style="display:none"></div>
<div class="results" id="results" style="display:none"></div>
</div>
<script>
const urlParams=new URLSearchParams(window.location.search);
const initData=urlParams.get('initData')||'';
const questions=[
{q:'¬øQu√© EPI protege tu cabeza de ca√≠das de objetos?',a:['Casco','Gorra','Gafas','Guantes'],c:0,e:'El casco es obligatorio en obra; protege contra impactos de materiales.'},
{q:'¬øQu√© calzado debes usar en obra?',a:['Botas con puntera de acero','Zapatillas deportivas','Sandalias','Zapatos de vestir'],c:0,e:'Las botas con puntera protegen de aplastamientos y perforaciones.'},
{q:'¬øCu√°ndo usar guantes de seguridad?',a:['Al manipular materiales cortantes','Solo si hace fr√≠o','Nunca, molestan','Solo en altura'],c:0,e:'Los guantes previenen cortes, abrasiones y quemaduras al manejar materiales.'},
{q:'Se√±al amarilla con borde negro indica:',a:['Advertencia o peligro','Prohibici√≥n','Obligaci√≥n','Salida de emergencia'],c:0,e:'Amarillo con negro se√±aliza peligro: riesgo el√©ctrico, ca√≠das, etc.'},
{q:'Antes de usar una herramienta el√©ctrica:',a:['Verificar cable y enchufe','Encenderla para probar','Dejarla enchufada siempre','Usarla sin revisar'],c:0,e:'Revisar el estado previene cortocircuitos, descargas y accidentes graves.'}
];
let currentQ=0,userAnswers=[],correctCount=0;
const introModal=document.getElementById('introModal'),hud=document.getElementById('hud'),progress=document.getElementById('progress'),gameplay=document.getElementById('gameplay'),results=document.getElementById('results'),scene=document.getElementById('scene'),startBtn=document.getElementById('startBtn');
startBtn.addEventListener('click',()=>{
introModal.style.display='none';
hud.style.display='flex';
gameplay.style.display='flex';
showQuestion();
ensureFits();
});
function showQuestion(){
if(currentQ>=questions.length){showResults();return}
const q=questions[currentQ];
progress.textContent=`${currentQ+1}/${questions.length}`;
gameplay.innerHTML=`<div class="question-card"><h2>${q.q}</h2><div class="answers" id="answersContainer"></div></div>`;
const container=document.getElementById('answersContainer');
q.a.forEach((ans,idx)=>{
const btn=document.createElement('button');
btn.className='answer-btn';
btn.textContent=ans;
btn.setAttribute('aria-label',ans);
btn.addEventListener('click',()=>selectAnswer(idx));
container.appendChild(btn);
});
ensureFits();
}
function selectAnswer(idx){
const q=questions[currentQ];
userAnswers.push(idx);
if(idx===q.c)correctCount++;
const btns=document.querySelectorAll('.answer-btn');
btns.forEach((btn,i)=>{
btn.disabled=true;
if(i===q.c)btn.classList.add('correct');
else if(i===idx)btn.classList.add('incorrect');
});
setTimeout(()=>{
currentQ++;
showQuestion();
},800);
}
function showResults(){
hud.style.display='none';
gameplay.style.display='none';
results.style.display='block';
scene.classList.add('results-view');
let html=`<h2>Resultados</h2><div class="score-summary">Has acertado ${correctCount} de ${questions.length}</div>`;
questions.forEach((q,i)=>{
const userIdx=userAnswers[i],correct=userIdx===q.c;
html+=`<div class="result-item ${correct?'correct-result':'incorrect-result'}">
<h3>${q.q}</h3>
<p class="user-answer">Tu respuesta: ${q.a[userIdx]}</p>
${!correct?`<p class="correct-answer">Correcta: ${q.a[q.c]}</p>`:''}
<p>${q.e}</p>
</div>`;
});
html+=`<div class="final-tip"><strong>Consejo:</strong> Revisa siempre tu EPI antes de empezar y nunca ignores las se√±ales de seguridad.</div>`;
html+=`<div class="cta-final"><button class="btn" id="rewardBtn">Ver mi recompensa</button>`;
if(!initData)html+=`<p class="warning">‚ö†Ô∏è initData no detectado</p>`;
html+=`</div>`;
results.innerHTML=html;
document.getElementById('rewardBtn').addEventListener('click',()=>{
window.location.href=`https://kampe-game-phaser.onrender.com/daily_streak?initData=${encodeURIComponent(initData)}`;
});
}
function ensureFits(){
const sceneEl=document.getElementById('scene');
if(!sceneEl||sceneEl.classList.contains('results-view'))return;
if(sceneEl.scrollHeight>sceneEl.clientHeight+5){
sceneEl.classList.add('compact');
setTimeout(()=>{
if(sceneEl.scrollHeight>sceneEl.clientHeight+5){
const scale=Math.max(0.88,sceneEl.clientHeight/sceneEl.scrollHeight);
sceneEl.style.setProperty('--ui-scale',scale);
sceneEl.style.transform=`scale(${scale})`;
sceneEl.style.transformOrigin='top center';
}
},50);
}
}
window.addEventListener('resize',ensureFits);
window.addEventListener('orientationchange',()=>setTimeout(ensureFits,200));
</script>
</body>
</html>

