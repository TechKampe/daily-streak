
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no">
<meta name="theme-color" content="#007BFF">
<title>Tensi√≥n en el Circuito: ¬°Cliente a la vista! ‚ö°Ô∏è | K√§mpe</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{width:100%;overflow:hidden;overscroll-behavior:none;font-family:'Baloo 2',cursive;background:#F5F5F0;color:#1A1B2F;-webkit-font-smoothing:antialiased}
@supports (height:100svh){.scene{height:100svh}}
@supports not (height:100svh){.scene{height:100dvh}}
@supports not (height:100dvh){.scene{height:100vh}}
.scene{width:100%;display:flex;flex-direction:column;position:relative;padding:env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);touch-action:none}
.hud{padding:12px 16px;background:linear-gradient(135deg,#1EA4FF,#007BFF);color:#fff;display:flex;align-items:center;justify-content:space-between;box-shadow:0 2px 8px rgba(0,123,255,0.3);flex-shrink:0}
.hud-logo{height:32px;width:auto}
.hud-progress{font-size:clamp(13px,3.5vw,16px);font-weight:600}
.chat-wrapper{flex:1;overflow-y:auto;overflow-x:hidden;padding:16px;background:#fff;border-radius:16px 16px 0 0;margin:8px 8px 0 8px;position:relative;-webkit-overflow-scrolling:touch}
.chat-wrapper::-webkit-scrollbar{width:4px}
.chat-wrapper::-webkit-scrollbar-thumb{background:#007BFF;border-radius:4px}
.message-bubble{margin-bottom:16px;display:flex;align-items:flex-start;gap:10px;animation:fadeIn 0.3s ease-out}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
.message-bubble.user{flex-direction:row-reverse}
.message-avatar{width:48px;height:48px;border-radius:50%;object-fit:cover;flex-shrink:0;border:2px solid #007BFF}
.message-content{max-width:70%;display:flex;flex-direction:column;gap:4px}
.message-name{font-size:13px;font-weight:600;color:#007BFF}
.message-text{background:#F0F0F0;padding:10px 14px;border-radius:16px;font-size:clamp(13px,3.5vw,15px);line-height:1.4;color:#1A1B2F}
.message-bubble.user .message-text{background:linear-gradient(135deg,#1EA4FF,#007BFF);color:#fff}
.message-reaction{font-size:12px;color:#666;font-style:italic;margin-top:4px;padding-left:14px}
.actions{padding:16px;background:#fff;border-top:1px solid #E0E0E0;display:flex;flex-direction:column;gap:10px;flex-shrink:0}
.btn{padding:14px 20px;border:none;border-radius:12px;font-family:'Baloo 2',cursive;font-size:clamp(14px,3.8vw,16px);font-weight:600;cursor:pointer;transition:all 0.3s ease;min-height:44px;display:flex;align-items:center;justify-content:center;text-align:center;line-height:1.3}
.btn-primary{background:linear-gradient(135deg,#1EA4FF,#007BFF);color:#fff;box-shadow:0 4px 12px rgba(0,123,255,0.4)}
.btn-primary:active{transform:translateY(2px);box-shadow:0 2px 6px rgba(0,123,255,0.4)}
.btn-option{background:#fff;color:#1A1B2F;border:2px solid #007BFF;box-shadow:0 2px 8px rgba(0,0,0,0.1)}
.btn-option:active{background:#F0F8FF;transform:translateY(1px)}
.modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);display:flex;align-items:center;justify-content:center;z-index:1000;padding:20px}
.modal-content{background:#fff;border-radius:20px;padding:24px;max-width:500px;width:100%;max-height:90svh;overflow-y:auto;box-shadow:0 8px 32px rgba(0,0,0,0.3);animation:modalIn 0.3s ease-out}
@keyframes modalIn{from{opacity:0;transform:scale(0.9)}to{opacity:1;transform:scale(1)}}
.modal-header{display:flex;align-items:center;gap:12px;margin-bottom:16px}
.modal-avatar{width:56px;height:56px;border-radius:50%;object-fit:cover;border:3px solid #007BFF}
.modal-title{font-size:clamp(18px,5vw,22px);font-weight:700;color:#1A1B2F;line-height:1.3}
.modal-desc{font-size:clamp(14px,3.5vw,16px);color:#333;line-height:1.5;margin-bottom:20px}
.results-section{margin:20px 0}
.results-title{font-size:clamp(16px,4vw,18px);font-weight:700;color:#007BFF;margin-bottom:12px}
.result-item{background:#F0F8FF;padding:12px;border-radius:10px;margin-bottom:10px;border-left:4px solid #007BFF}
.result-choice{font-weight:600;color:#1A1B2F;margin-bottom:4px;font-size:clamp(13px,3.5vw,15px)}
.result-feedback{font-size:clamp(12px,3.2vw,14px);color:#555;line-height:1.4}
.advice-box{background:linear-gradient(135deg,#1EA4FF,#007BFF);color:#fff;padding:16px;border-radius:12px;margin:20px 0;font-size:clamp(13px,3.5vw,15px);line-height:1.5}
.warning{font-size:12px;color:#FF6B6B;margin-top:8px;text-align:center}
.hidden{display:none!important}
.compact .hud{padding:8px 12px}
.compact .hud-logo{height:28px}
.compact .hud-progress{font-size:13px}
.compact .chat-wrapper{padding:12px;margin:6px 6px 0 6px}
.compact .message-avatar{width:40px;height:40px}
.compact .actions{padding:12px;gap:8px}
.compact .btn{padding:12px 16px;font-size:14px;min-height:40px}
</style>
</head>
<body>
<div class="scene" id="scene">
<div class="hud">
<img src="https://techkampe.github.io/daily-streak/assets/kampe_logo_oscuro.png" alt="K√§mpe" class="hud-logo" loading="eager">
<div class="hud-progress" id="progress">1/6</div>
</div>
<div class="chat-wrapper" id="chatWrapper"></div>
<div class="actions" id="actions"></div>
</div>
<div class="modal hidden" id="introModal">
<div class="modal-content">
<div class="modal-header">
<img src="https://techkampe.github.io/daily-streak/assets/Avatar%204_low.png" alt="Cliente" class="modal-avatar" loading="eager">
<h1 class="modal-title">Tensi√≥n en el Circuito: ¬°Cliente a la vista! ‚ö°Ô∏è</h1>
</div>
<p class="modal-desc">Acabas de instalar un nuevo sistema de iluminaci√≥n en casa de un cliente. Todo parece perfecto, pero al revisar la factura, el cliente frunce el ce√±o y empieza a hacer preguntas con tono esc√©ptico. Este reto eval√∫a tu capacidad para comunicarte con asertividad y empat√≠a, gestionar las expectativas del cliente y resolver un posible conflicto de manera profesional. Dialogar√°s con el cliente y tu mentor a trav√©s de un chat simulado. En cada turno, deber√°s elegir la respuesta que mejor demuestre tu inteligencia emocional y conocimiento del trabajo realizado. Tus decisiones abordar√°n c√≥mo explicar costes inesperados, c√≥mo reaccionar ante una queja y cu√°ndo pedir ayuda a un superior. Al final, recibir√°s un an√°lisis de tus respuestas y consejos para mejorar la gesti√≥n de clientes. La simulaci√≥n consta de 5 turnos de di√°logo.</p>
<button class="btn btn-primary" onclick="startChallenge()">¬°Empezar Reto!</button>
</div>
</div>
<div class="modal hidden" id="resultsModal">
<div class="modal-content" id="resultsContent"></div>
</div>
<script>
const urlParams=new URLSearchParams(window.location.search);
const initData=urlParams.get('initData')||'';
const avatars={
mentor:'https://techkampe.github.io/daily-streak/assets/Avatar%201_low.png',
aprendiz:'https://techkampe.github.io/daily-streak/assets/Avatar%202_low.png',
reclutador:'https://techkampe.github.io/daily-streak/assets/Avatar%203_low.png',
cliente:'https://techkampe.github.io/daily-streak/assets/Avatar%204_low.png'
};
const turns=[
{speaker:'cliente',name:'Sr. Garc√≠a',avatar:avatars.cliente,text:'Disculpa... ¬øPor qu√© la factura es 150‚Ç¨ m√°s de lo que me dijiste?',options:[
{text:'Lo siento, surgieron imprevistos con el cableado antiguo que tuve que solucionar.',correct:true,reaction:'Ah, entiendo... pero hubiera preferido que me avisaras antes.',feedback:'Correcta. Explicaste el motivo con sinceridad.',next:1},
{text:'Bueno, as√≠ son estos trabajos, siempre sale algo extra.',correct:false,reaction:'Eso no es profesional. Quiero hablar con tu jefe.',feedback:'Incorrecta. Respuesta poco emp√°tica y defensiva.',next:1},
{text:'¬ø150‚Ç¨? Revisa bien la factura, est√° todo correcto.',correct:false,reaction:'¬°S√© leer una factura! No me gusta tu tono.',feedback:'Incorrecta. Actitud confrontativa.',next:1}
]},
{speaker:'mentor',name:'Carlos (Mentor)',avatar:avatars.mentor,text:'Te escuch√© hablar con el cliente. Recuerda: siempre avisa antes de cobros extra.',options:[
{text:'Tienes raz√≥n, deb√≠ llamarle antes de continuar.',correct:true,reaction:'As√≠ se hace. Aprende de esto para la pr√≥xima.',feedback:'Correcta. Aceptaste la retroalimentaci√≥n con madurez.',next:2},
{text:'S√≠, pero es que no tuve tiempo, estaba ocupado.',correct:false,reaction:'Siempre hay tiempo para una llamada r√°pida.',feedback:'Parcial. Justificaci√≥n d√©bil.',next:2},
{text:'El cliente exagera, solo fueron 150‚Ç¨.',correct:false,reaction:'No minimices. Para √©l es importante.',feedback:'Incorrecta. Falta de empat√≠a.',next:2}
]},
{speaker:'cliente',name:'Sr. Garc√≠a',avatar:avatars.cliente,text:'Adem√°s, una de las luces del pasillo parpadea. ¬øEso es normal?',options:[
{text:'D√©jame revisarlo ahora mismo, puede ser un contacto flojo.',correct:true,reaction:'Perfecto, te lo agradezco. Eso es lo que esperaba.',feedback:'Correcta. Actitud proactiva y profesional.',next:3},
{text:'Puede ser la bombilla, c√°mbiala y si persiste me avisas.',correct:false,reaction:'¬øY si no es la bombilla? Deber√≠as asegurarte t√∫.',feedback:'Parcial. Soluci√≥n insuficiente sin verificar.',next:3},
{text:'Eso no tiene que ver con mi instalaci√≥n.',correct:false,reaction:'¬°Acabas de instalarla! Claro que tiene que ver.',feedback:'Incorrecta. Respuesta evasiva.',next:3}
]},
{speaker:'mentor',name:'Carlos (Mentor)',avatar:avatars.mentor,text:'Bien manejado. Ahora resuelve el parpadeo y documenta la soluci√≥n.',options:[
{text:'S√≠, voy a revisar la conexi√≥n y le explico al cliente.',correct:true,reaction:'Perfecto. Comunicaci√≥n y acci√≥n.',feedback:'Correcta. Enfoque completo.',next:4},
{text:'Ok, lo arreglo y ya.',correct:false,reaction:'No olvides explicarle qu√© era y por qu√© pas√≥.',feedback:'Parcial. Falta comunicaci√≥n.',next:4},
{text:'¬øTengo que documentarlo? Con arreglarlo basta.',correct:false,reaction:'La documentaci√≥n te protege y profesionaliza tu trabajo.',feedback:'Incorrecta. Falta de profesionalismo.',next:4}
]},
{speaker:'cliente',name:'Sr. Garc√≠a',avatar:avatars.cliente,text:'Ya funciona bien. ¬øMe puedes dejar por escrito qu√© hiciste hoy?',options:[
{text:'Claro, te hago un resumen con las reparaciones y costes.',correct:true,reaction:'Excelente. As√≠ me quedo tranquilo. Gracias.',feedback:'Correcta. Transparencia y profesionalismo.',next:5},
{text:'¬øPara qu√©? Ya tienes la factura.',correct:false,reaction:'La factura no explica el problema t√©cnico.',feedback:'Incorrecta. Resistencia innecesaria.',next:5},
{text:'Te mando un mensaje luego con los detalles.',correct:false,reaction:'Prefiero algo oficial, por favor.',feedback:'Parcial. Soluci√≥n informal.',next:5}
]}
];
let currentTurn=0;
let userChoices=[];
let chatHistory=[];
function startChallenge(){
document.getElementById('introModal').classList.add('hidden');
document.body.style.overflow='hidden';
renderTurn();
ensureFits();
}
function renderTurn(){
if(currentTurn>=turns.length){
showResults();
return;
}
document.getElementById('progress').textContent=`${currentTurn+1}/6`;
const turn=turns[currentTurn];
addMessage(turn.speaker,turn.name,turn.avatar,turn.text);
const actionsDiv=document.getElementById('actions');
actionsDiv.innerHTML='';
turn.options.forEach((opt,idx)=>{
const btn=document.createElement('button');
btn.className='btn btn-option';
btn.textContent=opt.text;
btn.onclick=()=>selectOption(idx);
actionsDiv.appendChild(btn);
});
scrollChatToBottom();
}
function addMessage(speaker,name,avatar,text,reaction=''){
const bubble=document.createElement('div');
bubble.className=`message-bubble ${speaker==='user'?'user':''}`;
const img=document.createElement('img');
img.src=avatar;
img.alt=name;
img.className='message-avatar';
img.loading='lazy';
const content=document.createElement('div');
content.className='message-content';
if(speaker!=='user'){
const nameEl=document.createElement('div');
nameEl.className='message-name';
nameEl.textContent=name;
content.appendChild(nameEl);
}
const textEl=document.createElement('div');
textEl.className='message-text';
textEl.textContent=text;
content.appendChild(textEl);
if(reaction){
const reactionEl=document.createElement('div');
reactionEl.className='message-reaction';
reactionEl.textContent=reaction;
content.appendChild(reactionEl);
}
bubble.appendChild(img);
bubble.appendChild(content);
document.getElementById('chatWrapper').appendChild(bubble);
chatHistory.push({speaker,name,avatar,text,reaction});
}
function selectOption(idx){
const turn=turns[currentTurn];
const option=turn.options[idx];
userChoices.push({turn:currentTurn+1,choice:option.text,feedback:option.feedback,correct:option.correct});
addMessage('user','T√∫',avatars.aprendiz,option.text);
setTimeout(()=>{
addMessage(turn.speaker,turn.name,turn.avatar,'',option.reaction);
scrollChatToBottom();
setTimeout(()=>{
currentTurn++;
renderTurn();
},800);
},600);
document.getElementById('actions').innerHTML='';
}
function scrollChatToBottom(){
const chat=document.getElementById('chatWrapper');
chat.scrollTop=chat.scrollHeight;
}
function showResults(){
document.getElementById('progress').textContent='6/6';
document.getElementById('chatWrapper').innerHTML='';
document.getElementById('actions').innerHTML='';
const correct=userChoices.filter(c=>c.correct).length;
const total=userChoices.length;
let resultsHTML=`
<div class="modal-header">
<img src="${avatars.mentor}" alt="Mentor" class="modal-avatar">
<h1 class="modal-title">¬°Reto Completado! üéâ</h1>
</div>
<div class="results-section">
<div class="results-title">Tu Puntuaci√≥n: ${correct}/${total} decisiones correctas</div>
`;
userChoices.forEach((choice,i)=>{
const icon=choice.correct?'‚úÖ':'‚ùå';
resultsHTML+=`
<div class="result-item">
<div class="result-choice">${icon} Turno ${choice.turn}: ${choice.choice.substring(0,50)}${choice.choice.length>50?'...':''}</div>
<div class="result-feedback">${choice.feedback}</div>
</div>
`;
});
resultsHTML+=`
</div>
<div class="advice-box">
<strong>üí° Consejo Pro:</strong> Siempre comunica costes extra antes de ejecutarlos, documenta cada intervenci√≥n y resuelve dudas con empat√≠a. Un cliente bien informado es un cliente satisfecho y recurrente.
</div>
<button class="btn btn-primary" onclick="goToReward()">Ver mi recompensa</button>
`;
if(!initData){
resultsHTML+=`<div class="warning">‚ö†Ô∏è initData no detectado. La recompensa podr√≠a no registrarse.</div>`;
}
document.getElementById('resultsContent').innerHTML=resultsHTML;
document.getElementById('resultsModal').classList.remove('hidden');
document.body.style.overflow='auto';
}
function goToReward(){
const url=`https://kampe-game-phaser.onrender.com/daily_streak?initData=${encodeURIComponent(initData)}`;
window.location.href=url;
}
function ensureFits(){
const scene=document.getElementById('scene');
if(scene.scrollHeight>scene.clientHeight){
scene.classList.add('compact');
setTimeout(()=>{
if(scene.scrollHeight>scene.clientHeight){
const scale=Math.max(0.88,scene.clientHeight/scene.scrollHeight);
scene.style.transform=`scale(${scale})`;
scene.style.transformOrigin='top center';
}
},100);
}
}
window.addEventListener('load',()=>{
document.getElementById('introModal').classList.remove('hidden');
ensureFits();
});
window.addEventListener('resize',ensureFits);
window.addEventListener('orientationchange',()=>setTimeout(ensureFits,200));
</script>
</body>
</html>

