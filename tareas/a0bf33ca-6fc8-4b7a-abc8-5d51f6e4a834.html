
<!DOCTYPE html>
<html lang="es" class="gameplay">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>üó£Ô∏è Tu primera llamada al cliente - K√§mpe Games</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@500;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://techkampe.github.io/daily-streak/assets/css/daily_tasks.css">
</head>
<body>
<div class="scene gameplay" id="scene"></div>
<img class="avatar" src="https://techkampe.github.io/daily-streak/assets/Avatar%201_low.png" alt="" loading="lazy">
<script>
const avatars = {
mentor: { name: "Carlos (Mentor)", img: "https://techkampe.github.io/daily-streak/assets/Avatar%201_low.png" },
cliente: { name: "Sra. Garc√≠a", img: "https://techkampe.github.io/daily-streak/assets/Avatar%204_low.png" },
aprendiz: { name: "T√∫", img: "https://techkampe.github.io/daily-streak/assets/Avatar%202_low.png" }
};

const turns = [
{
messages: [
{ from: "mentor", text: "Suena el tel√©fono. Es tu primera llamada de cliente. ¬°Adelante, contesta!" },
{ from: "cliente", text: "¬øHola? ¬øEs el servicio t√©cnico de calderas?" }
],
options: [
{ text: "Buenos d√≠as, Servicios K√§mpe, ¬øen qu√© puedo ayudarle?", score: 2, reaction: "¬°Perfecto! Profesional y claro.", quality: "correct" },
{ text: "S√≠, d√≠game.", score: 1, reaction: "Funciona, pero podr√≠as ser m√°s profesional.", quality: "partial" },
{ text: "¬øQui√©n llama?", score: 0, reaction: "Eso suena brusco, el cliente se siente inc√≥modo.", quality: "incorrect" }
]
},
{
messages: [
{ from: "cliente", text: "Tengo un problema con mi caldera. No enciende y hace fr√≠o en casa." }
],
options: [
{ text: "Entiendo. ¬øPuede ver si hay luz en el piloto?", score: 2, reaction: "Muy bien, pregunta t√©cnica b√°sica y √∫til.", quality: "correct" },
{ text: "¬øHa probado a apagarla y encenderla?", score: 1, reaction: "Es un inicio, pero poco espec√≠fico.", quality: "partial" },
{ text: "Pues habr√° que ir a verla.", score: 0, reaction: "Sin hacer preguntas no puedes prepararte.", quality: "incorrect" }
]
},
{
messages: [
{ from: "cliente", text: "No veo ninguna luz. ¬°Necesito que vengan ya, tengo ni√±os en casa!" }
],
options: [
{ text: "Comprendo la urgencia. ¬øCu√°ndo fue la √∫ltima revisi√≥n?", score: 2, reaction: "Perfecto, muestras empat√≠a y sigues diagnosticando.", quality: "correct" },
{ text: "Tranquila, lo solucionaremos. ¬øHace cu√°nto que no funciona?", score: 1, reaction: "Bien la calma, pero la pregunta es menos √∫til.", quality: "partial" },
{ text: "No puedo hacer milagros, se√±ora.", score: 0, reaction: "Eso ha molestado al cliente. Mala idea.", quality: "incorrect" }
]
},
{
messages: [
{ from: "cliente", text: "Creo que fue hace m√°s de un a√±o... ¬øPueden venir hoy?" }
],
options: [
{ text: "D√©jeme consultar agenda. Podr√≠amos ir esta tarde, ¬øle viene bien?", score: 2, reaction: "Excelente, compromiso realista y consultivo.", quality: "correct" },
{ text: "Hoy est√° complicado, pero ma√±ana a primera hora seguro.", score: 1, reaction: "Honesto, aunque el cliente preferir√≠a hoy.", quality: "partial" },
{ text: "Vamos ahora mismo, en 20 minutos estamos.", score: 0, reaction: "Prometer sin consultar puede generar problemas.", quality: "incorrect" }
]
},
{
messages: [
{ from: "cliente", text: "Perfecto, esta tarde me viene bien. Muchas gracias." }
],
options: [
{ text: "Gracias a usted. Le llamamos 30 min antes. ¬°Hasta luego!", score: 2, reaction: "Despedida profesional con informaci√≥n √∫til.", quality: "correct" },
{ text: "Vale, hasta luego.", score: 1, reaction: "Correcto pero podr√≠as dar m√°s informaci√≥n.", quality: "partial" },
{ text: "*Cuelgas sin m√°s*", score: 0, reaction: "Nunca cuelgues sin despedirte correctamente.", quality: "incorrect" }
]
}
];

let currentTurn = 0, chatHistory = [], answers = [], totalScore = 0;
const scene = document.getElementById('scene');

function render() {
if (currentTurn >= turns.length) { showResults(); return; }
const turn = turns[currentTurn];
scene.innerHTML = `
<div class="hud">
<div class="hud-titles">
<div class="brand">üó£Ô∏è Tu primera llamada</div>
<div class="subtitle">Gestiona la llamada del cliente</div>
</div>
<div class="progress-row">
<div class="bar-wrap"><span class="bar-label">Progreso</span><div class="bar"><i style="width:${(currentTurn/turns.length)*100}%"></i></div></div>
<span class="badge">${currentTurn+1}/${turns.length}</span>
</div>
</div>
<div class="main" style="flex:1;display:flex;flex-direction:column;overflow:hidden;padding:0 16px;">
<div class="chat-container" id="chat" style="flex:1;overflow-y:auto;display:flex;flex-direction:column;gap:8px;padding:8px 0;"></div>
</div>
<div class="footer" style="flex-shrink:0;">
<div class="helper">Elige tu respuesta</div>
<div class="options" id="options" style="display:flex;flex-direction:column;gap:8px;"></div>
</div>`;
renderChat();
renderOptions(turn.options);
ensureFits();
}

function renderChat() {
const chat = document.getElementById('chat');
chat.innerHTML = chatHistory.map(m => {
const isPlayer = m.from === 'aprendiz' && m.isResponse;
const align = isPlayer ? 'flex-end' : 'flex-start';
const bgClass = isPlayer ? 'player-msg' : 'npc-msg';
return `<div style="display:flex;flex-direction:column;align-items:${align};max-width:85%;">
<span style="font-size:11px;color:#888;margin-bottom:2px;">${avatars[m.from].name}</span>
<div class="${bgClass}" style="padding:10px 14px;border-radius:16px;${isPlayer?'background:#222;color:#fff;':'background:#f0f0f0;color:#333;'}">${m.text}</div>
</div>`;
}).join('');
const turn = turns[currentTurn];
if (turn) {
turn.messages.forEach(m => {
chat.innerHTML += `<div style="display:flex;flex-direction:column;align-items:flex-start;max-width:85%;">
<span style="font-size:11px;color:#888;margin-bottom:2px;">${avatars[m.from].name}</span>
<div style="padding:10px 14px;border-radius:16px;background:#f0f0f0;color:#333;">${m.text}</div>
</div>`;
});
}
chat.scrollTop = chat.scrollHeight;
}

function renderOptions(options) {
const opts = document.getElementById('options');
opts.innerHTML = options.map((o, i) => `<button class="btn-option" onclick="selectOption(${i})">${o.text}</button>`).join('');
}

function selectOption(i) {
const turn = turns[currentTurn];
const opt = turn.options[i];
turn.messages.forEach(m => chatHistory.push(m));
chatHistory.push({ from: 'aprendiz', text: opt.text, isResponse: true });
answers.push({ turn: currentTurn + 1, text: opt.text, score: opt.score, reaction: opt.reaction, quality: opt.quality });
totalScore += opt.score;
currentTurn++;
showReaction(opt.reaction, () => render());
}

function showReaction(text, cb) {
const modal = document.createElement('div');
modal.className = 'modal-backdrop active';
modal.innerHTML = `<div class="modal"><div class="modal-title">Reacci√≥n</div><div class="modal-body">${text}</div><div class="modal-actions"><button class="cta" id="continueBtn">Continuar</button></div></div>`;
document.body.appendChild(modal);
document.getElementById('continueBtn').onclick = () => { modal.remove(); cb(); };
}

function showResults() {
setTimeout(() => {
document.documentElement.classList.replace('gameplay', 'results');
scene.classList.replace('gameplay', 'results');
const maxScore = turns.length * 2;
const pct = Math.round((totalScore / maxScore) * 100);
scene.innerHTML = `
<div class="results-scroll">
<div class="results-header">
<div class="results-title">¬°Llamada completada!</div>
<div class="results-score">${totalScore}/${maxScore}</div>
<div class="results-subtitle">${pct >= 80 ? '¬°Excelente comunicaci√≥n!' : pct >= 50 ? 'Buen intento, puedes mejorar' : 'Necesitas practicar m√°s'}</div>
</div>
<div class="results-list">
${answers.map((a, i) => `<div class="result-item ${a.quality === 'correct' ? 'correct' : a.quality === 'partial' ? '' : 'incorrect'}">
<div class="result-question">Turno ${a.turn}</div>
<div class="result-answer">${a.text}</div>
<div class="result-explanation">${a.reaction}</div>
</div>`).join('')}
</div>
<div class="result-item" style="background:#e8f5e9;margin-top:16px;">
<div class="result-question">üí° Consejo pr√°ctico</div>
<div class="result-explanation">Prepara un guion mental: saludo ‚Üí escucha ‚Üí preguntas t√©cnicas ‚Üí compromiso realista ‚Üí despedida. As√≠ transmitir√°s confianza.</div>
</div>
<div class="footer" style="position:sticky;bottom:0;background:#fff;padding:16px 0;">
<button class="cta" onclick="completeTask()">Ver mi recompensa</button>
</div>
</div>`;
}, 500);
}

function completeTask() {
if (window.ReactNativeWebView) {
window.ReactNativeWebView.postMessage(JSON.stringify({ action: 'TASK_COMPLETED' }));
}
}

function ensureFits() {
scene.classList.remove('compact', 'compact-xs');
document.documentElement.style.setProperty('--ui-scale', 1);
if (scene.scrollHeight > scene.clientHeight) scene.classList.add('compact');
if (scene.scrollHeight > scene.clientHeight) scene.classList.add('compact-xs');
if (scene.scrollHeight > scene.clientHeight) {
document.documentElement.style.setProperty('--ui-scale', Math.max(0.88, scene.clientHeight / scene.scrollHeight));
}
}

function showIntro() {
const modal = document.createElement('div');
modal.className = 'modal-backdrop active';
modal.innerHTML = `<div class="modal"><div class="modal-title">üó£Ô∏è Tu primera llamada</div><div class="modal-body">Un cliente llama con un problema en su caldera. Tu mentor observa. ¬°Demuestra tu profesionalidad!</div><div class="modal-actions"><button class="cta" id="startBtn">Comenzar</button></div></div>`;
document.body.appendChild(modal);
document.getElementById('startBtn').onclick = () => { modal.remove(); render(); };
}

window.addEventListener('load', () => { ensureFits(); showIntro(); });
window.addEventListener('resize', ensureFits);
window.addEventListener('orientationchange', () => setTimeout(ensureFits, 100));
</script>
</body>
</html>
