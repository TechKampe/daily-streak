
<!DOCTYPE html>
<html lang="es" class="gameplay">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>Completa el Manual ðŸ“‹ - KÃ¤mpe Games</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@500;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://techkampe.github.io/daily-streak/assets/css/daily_tasks.css">
</head>
<body>
<div class="scene gameplay" id="scene">
<div class="hud">
<div class="hud-titles">
<div class="brand">Completa el Manual ðŸ“‹</div>
<div class="subtitle" id="subtitle">Primer dÃ­a en la empresa</div>
</div>
<div class="progress-row">
<div class="bar-wrap">
<span class="bar-label">Progreso</span>
<div class="bar"><i id="progress" style="width:0%"></i></div>
</div>
<span class="badge" id="counter">1/6</span>
</div>
</div>
<div class="main" id="main">
<div class="cloze-container" id="cloze-container">
<p class="cloze-text" id="cloze-text"></p>
</div>
<div class="options" id="options"></div>
</div>
<div class="footer">
<div class="helper" id="helper">Selecciona la palabra correcta</div>
</div>
</div>
<img class="avatar" src="https://techkampe.github.io/daily-streak/assets/Avatar%201_low.png" alt="" loading="lazy">

<div class="modal-backdrop" id="modal">
<div class="modal">
<div class="modal-title">ðŸ“‹ Manual de Procedimientos</div>
<div class="modal-body">Tu jefe quiere comprobar que dominas la terminologÃ­a bÃ¡sica. Completa cada frase del manual.</div>
<div class="modal-actions">
<button class="cta" onclick="startGame()">Comenzar</button>
</div>
</div>
</div>

<script>
const clozeData = [
  {
    text: "Para medir tensiÃ³n elÃ©ctrica, uso el ___.",
    options: ["multÃ­metro", "buscapolos", "alicate"],
    correct: 0,
    explanation: "El multÃ­metro mide tensiÃ³n, corriente y resistencia. El buscapolos solo detecta fase y el alicate es para cortar."
  },
  {
    text: "El cable de color azul corresponde al ___.",
    options: ["neutro", "fase", "tierra"],
    correct: 0,
    explanation: "Por normativa, el azul es neutro. La fase es marrÃ³n/negro y tierra es verde/amarillo."
  },
  {
    text: "La intensidad de corriente se mide en ___.",
    options: ["amperios", "voltios", "ohmios"],
    correct: 0,
    explanation: "Los amperios miden intensidad. Los voltios miden tensiÃ³n y los ohmios miden resistencia."
  },
  {
    text: "Para pelar cables uso los alicates ___.",
    options: ["pelacables", "universales", "de corte"],
    correct: 0,
    explanation: "Los pelacables estÃ¡n diseÃ±ados para retirar el aislante sin daÃ±ar el conductor."
  },
  {
    text: "El ___ protege contra contactos indirectos.",
    options: ["diferencial", "magnetotÃ©rmico", "fusible"],
    correct: 0,
    explanation: "El diferencial detecta fugas a tierra. El magnetotÃ©rmico protege contra sobrecargas y cortocircuitos."
  },
  {
    text: "Antes de trabajar, verifico ausencia de ___ con el buscapolos.",
    options: ["tensiÃ³n", "corriente", "potencia"],
    correct: 0,
    explanation: "El buscapolos detecta presencia de tensiÃ³n (fase). No mide corriente ni potencia."
  }
];

let currentIdx = 0;
let answers = [];
let score = 0;

const scene = document.getElementById('scene');
const clozeText = document.getElementById('cloze-text');
const options = document.getElementById('options');
const progress = document.getElementById('progress');
const counter = document.getElementById('counter');
const subtitle = document.getElementById('subtitle');
const helper = document.getElementById('helper');
const modal = document.getElementById('modal');

function startGame() {
  modal.classList.remove('active');
  render();
}

function render() {
  if (currentIdx >= clozeData.length) {
    showResults();
    return;
  }
  
  const item = clozeData[currentIdx];
  const textParts = item.text.split('___');
  clozeText.innerHTML = textParts[0] + '<span class="cloze-blank">___</span>' + (textParts[1] || '');
  
  options.innerHTML = item.options.map((opt, i) => 
    `<button class="btn-option" onclick="selectOption(${i})">${opt}</button>`
  ).join('');
  
  progress.style.width = ((currentIdx) / clozeData.length * 100) + '%';
  counter.textContent = (currentIdx + 1) + '/' + clozeData.length;
  subtitle.textContent = 'Frase ' + (currentIdx + 1) + ' de ' + clozeData.length;
  
  ensureFits();
}

function selectOption(idx) {
  const item = clozeData[currentIdx];
  const isCorrect = idx === item.correct;
  const btns = options.querySelectorAll('.btn-option');
  
  btns.forEach((btn, i) => {
    btn.disabled = true;
    if (i === item.correct) btn.classList.add('correct');
    else if (i === idx && !isCorrect) btn.classList.add('incorrect');
  });
  
  const textParts = item.text.split('___');
  const selectedWord = item.options[idx];
  clozeText.innerHTML = textParts[0] + '<span class="cloze-filled ' + (isCorrect ? 'correct' : 'incorrect') + '">' + selectedWord + '</span>' + (textParts[1] || '');
  
  if (isCorrect) score++;
  answers.push({
    question: item.text,
    correct: isCorrect,
    userAnswer: item.options[idx],
    correctAnswer: item.options[item.correct],
    explanation: item.explanation
  });
  
  setTimeout(() => {
    currentIdx++;
    render();
  }, 800);
}

function showResults() {
  setTimeout(() => {
    document.documentElement.classList.replace('gameplay', 'results');
    scene.classList.replace('gameplay', 'results');
    
    scene.innerHTML = `
      <div class="results-header">
        <div class="results-title">ðŸ“‹ Manual Revisado</div>
        <div class="results-score">${score}/${clozeData.length}</div>
        <div class="results-subtitle">TÃ©rminos correctos</div>
      </div>
      <div class="results-list">
        ${answers.map((a, i) => `
          <div class="result-item ${a.correct ? 'correct' : 'incorrect'}">
            <div class="result-question">${clozeData[i].text.replace('___', '<strong>' + a.correctAnswer + '</strong>')}</div>
            <div class="result-answer">${a.correct ? 'âœ“ Correcto' : 'âœ— Tu respuesta: ' + a.userAnswer}</div>
            <div class="result-explanation">${a.explanation}</div>
          </div>
        `).join('')}
        <div class="result-item" style="background: var(--surface-2);">
          <div class="result-question">ðŸ’¡ Consejo del jefe</div>
          <div class="result-explanation">Usar la terminologÃ­a correcta evita malentendidos peligrosos en obra. Un "cable azul" siempre es neutro, nunca "el de color".</div>
        </div>
      </div>
      <div class="footer">
        <button class="cta" onclick="completeTask()">Ver mi recompensa</button>
      </div>
    `;
  }, 500);
}

function completeTask() {
  if (window.ReactNativeWebView) {
    window.ReactNativeWebView.postMessage(JSON.stringify({
      action: 'TASK_COMPLETED'
    }));
  }
}

function ensureFits() {
  scene.classList.remove('compact', 'compact-xs');
  document.documentElement.style.setProperty('--ui-scale', 1);
  if (scene.scrollHeight > scene.clientHeight) scene.classList.add('compact');
  if (scene.scrollHeight > scene.clientHeight) scene.classList.add('compact-xs');
  if (scene.scrollHeight > scene.clientHeight) {
    document.documentElement.style.setProperty('--ui-scale', Math.max(0.88, scene.clientHeight / scene.scrollHeight));
  }
}

window.addEventListener('load', () => { modal.classList.add('active'); ensureFits(); });
window.addEventListener('resize', ensureFits);
window.addEventListener('orientationchange', () => setTimeout(ensureFits, 100));
</script>
</body>
</html>
