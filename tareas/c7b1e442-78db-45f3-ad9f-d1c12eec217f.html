
<!DOCTYPE html>
<html lang="es" class="gameplay">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>Tu primer servicio elÃ©ctrico âš¡ - KÃ¤mpe Games</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@500;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://techkampe.github.io/daily-streak/assets/css/daily_tasks.css">
</head>
<body>
<div class="scene gameplay" id="scene">
<div class="hud">
<div class="hud-titles">
<div class="brand">Tu primer servicio elÃ©ctrico âš¡</div>
<div class="subtitle">Completa la frase eligiendo la opciÃ³n correcta</div>
</div>
<div class="progress-row">
<div class="bar-wrap">
<span class="bar-label">Progreso</span>
<div class="bar"><i id="progress-bar" style="width:0%"></i></div>
</div>
<span class="badge" id="counter">1/6</span>
</div>
</div>
<div class="main">
<p id="cloze-sentence"></p>
<div class="options" id="options"></div>
</div>
<div class="footer">
<div class="helper">Selecciona la herramienta o EPI correcto</div>
</div>
</div>
<img class="avatar" src="https://techkampe.github.io/daily-streak/assets/Avatar 1_low.png" alt="" loading="lazy">
<script>
const clozes = [
{
sentence: "Para comprobar si hay tensiÃ³n en el enchufe, uso el ___.",
options: ["buscapolos", "martillo"],
correct: 0,
explanation: "El buscapolos detecta presencia de tensiÃ³n. El martillo es una herramienta de golpeo, no sirve para mediciones elÃ©ctricas."
},
{
sentence: "Para medir el voltaje exacto del circuito, uso el ___.",
options: ["multÃ­metro", "pinza amperimÃ©trica"],
correct: 0,
explanation: "El multÃ­metro mide tensiÃ³n con precisiÃ³n. La pinza amperimÃ©trica mide intensidad sin cortar el cable."
},
{
sentence: "Antes de manipular el enchufe, me pongo ___.",
options: ["guantes dielÃ©ctricos", "gafas de sol"],
correct: 0,
explanation: "Los guantes dielÃ©ctricos aÃ­slan de descargas. Las gafas de sol no son un EPI para electricidad."
},
{
sentence: "Para cortar la alimentaciÃ³n, bajo el ___ del circuito.",
options: ["automÃ¡tico", "interruptor de lÃ¡mpara"],
correct: 0,
explanation: "El automÃ¡tico (magnetotÃ©rmico) corta todo el circuito. El interruptor de lÃ¡mpara solo controla un punto de luz."
},
{
sentence: "Para pelar el cable correctamente, empleo ___.",
options: ["pelacables", "cÃºter sin control"],
correct: 0,
explanation: "El pelacables corta solo el aislante sin daÃ±ar el conductor. Un cÃºter puede cortar hilos y causar accidentes."
},
{
sentence: "Para identificar el cable neutro, consulto el ___.",
options: ["cÃ³digo de colores", "termÃ³metro"],
correct: 0,
explanation: "El cÃ³digo de colores (azul=neutro) identifica conductores. El termÃ³metro mide temperatura, no tiene relaciÃ³n."
}
];

let currentIndex = 0;
let answers = [];
let score = 0;

const scene = document.getElementById('scene');
const progressBar = document.getElementById('progress-bar');
const counter = document.getElementById('counter');
const sentenceEl = document.getElementById('cloze-sentence');
const optionsEl = document.getElementById('options');

function renderCloze() {
if (currentIndex >= clozes.length) {
showResults();
return;
}
const cloze = clozes[currentIndex];
progressBar.style.width = (currentIndex / clozes.length * 100) + '%';
counter.textContent = (currentIndex + 1) + '/' + clozes.length;
sentenceEl.innerHTML = cloze.sentence.replace('___', '<u>___</u>');
optionsEl.innerHTML = cloze.options.map((opt, i) =>
`<button class="btn-option" onclick="selectOption(${i})">${opt}</button>`
).join('');
ensureFits();
}

function selectOption(index) {
const cloze = clozes[currentIndex];
const isCorrect = index === cloze.correct;
const buttons = optionsEl.querySelectorAll('.btn-option');
buttons.forEach((btn, i) => {
btn.disabled = true;
if (i === cloze.correct) btn.classList.add('correct');
else if (i === index && !isCorrect) btn.classList.add('incorrect');
});
const filledSentence = cloze.sentence.replace('___', `<u><strong>${cloze.options[index]}</strong></u>`);
sentenceEl.innerHTML = filledSentence;
if (isCorrect) score++;
answers.push({
sentence: cloze.sentence,
userAnswer: cloze.options[index],
correctAnswer: cloze.options[cloze.correct],
isCorrect: isCorrect,
explanation: cloze.explanation
});
setTimeout(() => {
currentIndex++;
renderCloze();
}, 800);
}

function showResults() {
setTimeout(() => {
document.documentElement.classList.replace('gameplay', 'results');
scene.classList.replace('gameplay', 'results');
scene.innerHTML = `
<div class="results-scroll">
<div class="results-header">
<div class="results-title">Â¡Servicio completado!</div>
<div class="results-score">${score}/${clozes.length}</div>
<div class="results-subtitle">Frases correctas</div>
</div>
<div class="results-list">
${answers.map(a => `
<div class="result-item ${a.isCorrect ? 'correct' : 'incorrect'}">
<div class="result-question">${a.sentence.replace('___', '<strong>' + a.correctAnswer + '</strong>')}</div>
<div class="result-answer">${a.isCorrect ? 'âœ“ Correcto' : 'âœ— Dijiste: ' + a.userAnswer}</div>
<div class="result-explanation">${a.explanation}</div>
</div>
`).join('')}
</div>
<div class="result-item">
<div class="result-question">ðŸ’¡ Consejo final</div>
<div class="result-explanation">Repasa la diferencia entre multÃ­metro (mide valores) y buscapolos (detecta tensiÃ³n). Usa siempre EPI y corta el automÃ¡tico antes de trabajar.</div>
</div>
<div class="footer">
<button class="cta" onclick="completeTask()">Ver mi recompensa</button>
</div>
</div>
`;
}, 500);
}

function completeTask() {
if (window.ReactNativeWebView) {
window.ReactNativeWebView.postMessage(JSON.stringify({ action: 'TASK_COMPLETED' }));
}
}

function ensureFits() {
scene.classList.remove('compact', 'compact-xs');
document.documentElement.style.setProperty('--ui-scale', 1);
if (scene.scrollHeight > scene.clientHeight) scene.classList.add('compact');
if (scene.scrollHeight > scene.clientHeight) scene.classList.add('compact-xs');
if (scene.scrollHeight > scene.clientHeight) {
const scale = Math.max(0.88, scene.clientHeight / scene.scrollHeight);
document.documentElement.style.setProperty('--ui-scale', scale);
}
}

window.addEventListener('load', () => { ensureFits(); renderCloze(); });
window.addEventListener('resize', ensureFits);
window.addEventListener('orientationchange', () => setTimeout(ensureFits, 100));

renderCloze();
</script>
</body>
</html>
