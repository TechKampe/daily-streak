
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no">
<meta name="theme-color" content="#1EA4FF">
<title>Modo Inspector: ¬°Caza el fallo! üïµÔ∏è | K√§mpe</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}html,body{width:100%;font-family:'Baloo 2',sans-serif;background:#F5F5F0;color:#1A1B2F;overflow:hidden;overscroll-behavior:none;touch-action:pan-x pan-y}body.results-view{overflow-y:auto}
@supports(height:100svh){.scene{height:100svh}}
@supports not(height:100svh){.scene{height:100dvh}}
@supports not(height:100dvh){.scene{height:100vh}}
.scene{display:flex;flex-direction:column;width:100%;padding:env(safe-area-inset-top,0) env(safe-area-inset-right,12px) env(safe-area-inset-bottom,0) env(safe-area-inset-left,12px);position:relative;overflow:hidden}
.logo{position:absolute;top:max(8px,env(safe-area-inset-top,0));left:12px;width:80px;height:auto;z-index:10;opacity:.9}
.compact .logo{width:60px;top:max(4px,env(safe-area-inset-top,0))}
.avatar-bg{position:absolute;bottom:-20px;right:-20px;width:200px;height:200px;background:url('https://techkampe.github.io/daily-streak/assets/Avatar%203_low.png') no-repeat center/contain;opacity:.12;z-index:0;pointer-events:none}
.compact .avatar-bg{width:150px;height:150px;bottom:-10px;right:-10px}
.modal{position:absolute;inset:0;background:rgba(26,27,47,.85);display:flex;align-items:center;justify-content:center;z-index:100;padding:16px;animation:fadeIn .3s}
@keyframes fadeIn{from{opacity:0}}
.modal-content{background:#fff;border-radius:20px;padding:clamp(20px,5vw,32px);max-width:420px;width:100%;max-height:90svh;overflow-y:auto;box-shadow:0 8px 32px rgba(30,164,255,.3);position:relative}
.modal-content h2{font-size:clamp(1.4rem,5vw,1.8rem);color:#1A1B2F;margin-bottom:12px;line-height:1.3}
.modal-content p{font-size:clamp(.95rem,3.5vw,1.05rem);color:#4A4A68;margin-bottom:16px;line-height:1.5}
.btn{display:inline-block;background:linear-gradient(135deg,#1EA4FF,#007BFF);color:#fff;border:none;border-radius:12px;padding:14px 28px;font-size:clamp(1rem,4vw,1.1rem);font-weight:600;cursor:pointer;min-height:44px;min-width:44px;transition:transform .2s,box-shadow .2s;box-shadow:0 4px 12px rgba(30,164,255,.3);font-family:inherit;touch-action:manipulation}
.btn:active{transform:scale(.96)}
.btn:hover{box-shadow:0 6px 16px rgba(30,164,255,.4)}
.compact .btn{padding:12px 24px;font-size:clamp(.9rem,3.5vw,1rem)}
.gameplay{flex:1;display:flex;flex-direction:column;padding-top:clamp(60px,15vw,90px);justify-content:space-between;position:relative;z-index:1}
.compact .gameplay{padding-top:clamp(50px,12vw,70px)}
.hud{text-align:center;margin-bottom:clamp(12px,3vw,16px)}
.hud h3{font-size:clamp(1.2rem,4.5vw,1.5rem);color:#1A1B2F;margin-bottom:6px;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.compact .hud h3{font-size:clamp(1rem,4vw,1.3rem);margin-bottom:4px}
.progress{font-size:clamp(.85rem,3vw,1rem);color:#007BFF;font-weight:600}
.compact .progress{font-size:clamp(.75rem,2.5vw,.9rem)}
.scenario{background:rgba(255,255,255,.95);border-radius:16px;padding:clamp(12px,3vw,16px);margin-bottom:clamp(12px,3vw,16px);box-shadow:0 2px 8px rgba(0,0,0,.08);border-left:4px solid #1EA4FF}
.scenario p{font-size:clamp(.9rem,3.5vw,1rem);color:#1A1B2F;line-height:1.4;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden}
.compact .scenario{padding:clamp(10px,2.5vw,12px);margin-bottom:clamp(10px,2.5vw,12px)}
.compact .scenario p{font-size:clamp(.85rem,3vw,.95rem)}
.options{display:flex;flex-direction:column;gap:clamp(10px,2.5vw,12px);flex:1;overflow-y:auto;max-height:calc(100svh - 320px);padding-bottom:8px}
.compact .options{gap:clamp(8px,2vw,10px);max-height:calc(100svh - 280px)}
.option-btn{background:#fff;border:2px solid #E0E0E8;border-radius:12px;padding:clamp(12px,3vw,16px);font-size:clamp(.9rem,3.5vw,1rem);color:#1A1B2F;text-align:left;cursor:pointer;transition:all .2s;min-height:44px;font-family:inherit;font-weight:500;line-height:1.3;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;box-shadow:0 2px 6px rgba(0,0,0,.06);touch-action:manipulation}
.option-btn:active{transform:scale(.98)}
.option-btn.selected{background:linear-gradient(135deg,#1EA4FF,#007BFF);color:#fff;border-color:#007BFF;animation:pulse .3s}
@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.02)}}
.compact .option-btn{padding:clamp(10px,2.5vw,12px);font-size:clamp(.85rem,3vw,.95rem)}
.results-screen{padding:clamp(16px,4vw,24px);max-width:600px;margin:0 auto;padding-top:max(80px,env(safe-area-inset-top,0) + 60px);padding-bottom:max(24px,env(safe-area-inset-bottom,0) + 16px)}
.results-screen h2{font-size:clamp(1.6rem,5.5vw,2rem);color:#1A1B2F;margin-bottom:clamp(16px,4vw,24px);text-align:center}
.result-item{background:#fff;border-radius:12px;padding:clamp(14px,3.5vw,18px);margin-bottom:clamp(12px,3vw,16px);box-shadow:0 2px 8px rgba(0,0,0,.08);border-left:4px solid #1EA4FF}
.result-item.wrong{border-left-color:#FF6B6B}
.result-item h4{font-size:clamp(1rem,3.8vw,1.15rem);color:#1A1B2F;margin-bottom:6px}
.result-item p{font-size:clamp(.85rem,3.2vw,.95rem);color:#4A4A68;line-height:1.4;margin-bottom:4px}
.result-item .label{font-weight:600;color:#007BFF}
.advice{background:linear-gradient(135deg,#1EA4FF,#007BFF);color:#fff;border-radius:12px;padding:clamp(16px,4vw,20px);margin:clamp(16px,4vw,24px) 0;text-align:center}
.advice h3{font-size:clamp(1.1rem,4vw,1.3rem);margin-bottom:8px}
.advice p{font-size:clamp(.9rem,3.5vw,1rem);line-height:1.4}
.final-cta{text-align:center;margin-top:clamp(16px,4vw,24px);position:sticky;bottom:max(16px,env(safe-area-inset-bottom,0) + 8px);background:#F5F5F0;padding:12px 0}
</style>
</head>
<body>
<div id="app"></div>
<script>
const params=new URLSearchParams(window.location.search);
const initData=params.get('initData')||'';
const scenes=[
{desc:"Revisando el cuadro el√©ctrico del s√≥tano",options:["Uso guantes aislantes de goma","Abro la tapa sin cortar corriente","Verifico tensi√≥n con mult√≠metro","Se√±alizo la zona de trabajo"],correct:1,explanation:"Nunca abras un cuadro el√©ctrico sin cortar la corriente. Es riesgo de electrocuci√≥n grave."},
{desc:"Reparando una fuga en la tuber√≠a del ba√±o",options:["Cierro la llave de paso general","Uso cinta tefl√≥n en rosca","Dejo herramientas en el suelo","Coloco cubo debajo de la fuga"],correct:2,explanation:"Dejar herramientas en el suelo es un riesgo de tropiezo. Mantenlas organizadas en tu caja."},
{desc:"Cambiando una bombilla en el techo del pasillo",options:["Uso escalera estable y firme","Subo a una silla de oficina","Pido a alguien que sujete la base","Desconecto el interruptor"],correct:1,explanation:"Una silla de oficina con ruedas es muy inestable. Usa siempre escalera homologada."},
{desc:"Sellando grietas en pared exterior con humedad",options:["Limpio y seco la superficie antes","Aplico sellador directamente","Uso mascarilla anti-polvo","Preparo mezcla seg√∫n fabricante"],correct:1,explanation:"Aplicar sellador sobre humedad impide el agarre. Seca bien la zona antes de sellar."},
{desc:"Instalando toma de corriente nueva en cocina",options:["Corto luz del circuito","Verifico con buscapolos sin tensi√≥n","Uso destornillador con mango aislante","Conecto cable azul a fase"],correct:3,explanation:"Cable azul es neutro, no fase. Fase es marr√≥n/negro. Conectar mal provoca cortocircuito."}
];
let state={currentScene:0,answers:[],started:false};
function render(){
const app=document.getElementById('app');
if(!state.started){
app.innerHTML=`<div class="scene"><img class="logo" src="https://techkampe.github.io/daily-streak/assets/kampe_logo_oscuro.png" alt="K√§mpe" loading="eager"><div class="avatar-bg"></div><div class="modal"><div class="modal-content"><h2>Modo Inspector: ¬°Caza el fallo! üïµÔ∏è</h2><p>Te enfrentas a 5 micro-escenas como t√©cnico de mantenimiento. Identifica en cada una el elemento incorrecto o inseguro. ¬°Demuestra tu ojo cl√≠nico!</p><button class="btn" onclick="startGame()">Comenzar inspecci√≥n</button></div></div></div>`;
return;
}
if(state.currentScene<scenes.length){
const scene=scenes[state.currentScene];
app.innerHTML=`<div class="scene"><img class="logo" src="https://techkampe.github.io/daily-streak/assets/kampe_logo_oscuro.png" alt="K√§mpe"><div class="avatar-bg"></div><div class="gameplay"><div class="hud"><h3>Escena ${state.currentScene+1}</h3><div class="progress">${state.currentScene+1}/5</div></div><div class="scenario"><p>${scene.desc}</p></div><div class="options">${scene.options.map((opt,i)=>`<button class="option-btn" onclick="selectOption(${i})">${opt}</button>`).join('')}</div></div></div>`;
setTimeout(ensureFits,50);
}else{
showResults();
}
}
function startGame(){
state.started=true;
render();
}
function selectOption(idx){
const btns=document.querySelectorAll('.option-btn');
btns[idx].classList.add('selected');
state.answers.push(idx);
setTimeout(()=>{
state.currentScene++;
render();
},400);
}
function showResults(){
document.body.classList.add('results-view');
const correct=state.answers.filter((a,i)=>a===scenes[i].correct).length;
const resultsHTML=scenes.map((sc,i)=>{
const chosen=state.answers[i];
const isCorrect=chosen===sc.correct;
return`<div class="result-item ${isCorrect?'':'wrong'}"><h4>Escena ${i+1}</h4><p><span class="label">Tu elecci√≥n:</span> ${sc.options[chosen]}</p>${!isCorrect?`<p><span class="label">Correcto:</span> ${sc.options[sc.correct]}</p>`:''}<p>${sc.explanation}</p></div>`;
}).join('');
const advice=correct>=4?"¬°Excelente! Tu atenci√≥n al detalle es clave en mantenimiento.":correct>=3?"Buen trabajo. Revisa siempre las normas de PRL antes de actuar.":"Recuerda: la seguridad es lo primero. Estudia procedimientos y EPIs necesarios.";
const warningHTML=!initData?`<p style="font-size:.85rem;color:#FF6B6B;margin-bottom:8px">‚ö†Ô∏è Sin initData detectado</p>`:'';
document.getElementById('app').innerHTML=`<div class="results-screen"><img class="logo" src="https://techkampe.github.io/daily-streak/assets/kampe_logo_oscuro.png" alt="K√§mpe"><h2>Inspector: ${correct}/5 correctas</h2>${resultsHTML}<div class="advice"><h3>üí° Consejo pro</h3><p>${advice}</p></div><div class="final-cta">${warningHTML}<button class="btn" onclick="goToReward()">Ver mi recompensa</button></div></div>`;
}
function goToReward(){
window.location.href=`https://kampe-game-phaser.onrender.com/daily_streak?initData=${encodeURIComponent(initData)}`;
}
function ensureFits(){
const scene=document.querySelector('.scene');
if(!scene||document.body.classList.contains('results-view'))return;
if(scene.scrollHeight>scene.clientHeight+5){
scene.classList.add('compact');
setTimeout(()=>{
if(scene.scrollHeight>scene.clientHeight+5){
const scale=Math.max(.88,scene.clientHeight/scene.scrollHeight);
scene.style.transform=`scale(${scale})`;
scene.style.transformOrigin='top center';
}
},50);
}
}
window.addEventListener('resize',ensureFits);
window.addEventListener('orientationchange',()=>setTimeout(ensureFits,200));
render();
</script>
</body>
</html>

