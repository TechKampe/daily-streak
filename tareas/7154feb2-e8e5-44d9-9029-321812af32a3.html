
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
<meta name="theme-color" content="#1EA4FF">
<title>¬°Ojo Avizor en la Obra! üöß</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{width:100%;font-family:'Baloo 2',sans-serif;background:#F5F5F0;color:#1A1B2F;overflow:hidden;overscroll-behavior:none;touch-action:pan-y}
body.results-view{overflow-y:auto}
.scene{width:100%;height:100vh;height:100dvh;display:flex;flex-direction:column;position:relative;padding:env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left)}
@supports(height:100svh){.scene{height:100svh}}
.logo{position:absolute;top:max(8px,env(safe-area-inset-top));left:12px;width:90px;z-index:10}
.logo img{width:100%;height:auto;display:block}
.avatar{position:absolute;bottom:0;right:0;width:140px;opacity:0.15;pointer-events:none;z-index:1}
.avatar img{width:100%;height:auto;display:block}
.compact .avatar{width:110px}
.modal{position:fixed;inset:0;background:rgba(26,27,47,0.85);display:flex;align-items:center;justify-content:center;z-index:100;padding:20px;animation:fadeIn 0.3s}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
.modal-content{background:#fff;border-radius:20px;padding:24px 20px;max-width:420px;width:100%;max-height:90svh;overflow-y:auto;box-shadow:0 8px 32px rgba(30,164,255,0.3);position:relative}
.modal-content h1{font-size:clamp(1.4rem,5vw,1.8rem);margin-bottom:8px;color:#1A1B2F;font-weight:700}
.modal-content p{font-size:clamp(0.9rem,3.5vw,1rem);line-height:1.4;margin-bottom:16px;color:#4A4A68}
.btn{background:linear-gradient(135deg,#1EA4FF,#007BFF);color:#fff;border:none;padding:14px 28px;border-radius:50px;font-size:clamp(1rem,4vw,1.1rem);font-weight:600;cursor:pointer;font-family:'Baloo 2',sans-serif;box-shadow:0 4px 12px rgba(30,164,255,0.3);transition:all 0.3s;min-height:44px;min-width:44px;touch-action:manipulation}
.btn:active{transform:scale(0.96);box-shadow:0 2px 8px rgba(30,164,255,0.4)}
.game-container{flex:1;display:flex;flex-direction:column;padding:80px 16px 16px;overflow:hidden;position:relative;z-index:2}
.compact .game-container{padding:70px 12px 12px}
.hud{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;gap:12px}
.compact .hud{margin-bottom:8px}
.progress{background:#E0E0E8;border-radius:20px;padding:8px 16px;font-weight:600;color:#1A1B2F;font-size:clamp(0.85rem,3.5vw,1rem);box-shadow:0 2px 8px rgba(0,0,0,0.08)}
.scene-text{background:#fff;border-radius:16px;padding:16px;margin-bottom:16px;box-shadow:0 4px 16px rgba(0,0,0,0.08);border-left:4px solid #1EA4FF}
.compact .scene-text{padding:12px;margin-bottom:12px}
.scene-text p{font-size:clamp(0.9rem,3.8vw,1.05rem);line-height:1.4;color:#1A1B2F;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden}
.options{display:flex;flex-direction:column;gap:10px;flex:1;overflow-y:auto;padding-bottom:8px}
.compact .options{gap:8px}
.option-btn{background:#fff;border:3px solid #E0E0E8;border-radius:16px;padding:14px 16px;font-size:clamp(0.9rem,3.8vw,1rem);font-weight:600;color:#1A1B2F;cursor:pointer;transition:all 0.3s;font-family:'Baloo 2',sans-serif;text-align:left;min-height:56px;box-shadow:0 2px 8px rgba(0,0,0,0.05);display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;touch-action:manipulation}
.compact .option-btn{padding:12px 14px;min-height:50px;font-size:clamp(0.85rem,3.5vw,0.95rem)}
.option-btn:active{transform:scale(0.98)}
.option-btn.selected{border-color:#1EA4FF;background:linear-gradient(135deg,rgba(30,164,255,0.1),rgba(0,123,255,0.1));animation:pulse 0.4s}
@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.02)}}
.results-container{padding:100px 16px 80px;max-width:600px;margin:0 auto}
.result-item{background:#fff;border-radius:16px;padding:16px;margin-bottom:16px;box-shadow:0 4px 16px rgba(0,0,0,0.08)}
.result-item.correct{border-left:4px solid #22C55E}
.result-item.incorrect{border-left:4px solid #EF4444}
.result-item h3{font-size:clamp(0.95rem,4vw,1.1rem);margin-bottom:8px;color:#1A1B2F}
.result-item p{font-size:clamp(0.85rem,3.5vw,0.95rem);line-height:1.4;color:#4A4A68;margin-bottom:6px}
.result-item .label{font-weight:600;color:#1A1B2F}
.advice-box{background:linear-gradient(135deg,#1EA4FF,#007BFF);color:#fff;border-radius:16px;padding:20px;margin:24px 0;box-shadow:0 6px 20px rgba(30,164,255,0.3)}
.advice-box h3{font-size:clamp(1rem,4.2vw,1.2rem);margin-bottom:8px}
.advice-box p{font-size:clamp(0.9rem,3.8vw,1rem);line-height:1.4}
.final-btn{width:100%;margin-top:16px}
.warning{font-size:0.8rem;color:#EF4444;margin-top:8px;text-align:center}
</style>
</head>
<body>
<div class="logo"><img src="https://techkampe.github.io/daily-streak/assets/kampe_logo_oscuro.png" alt="K√§mpe" loading="eager"></div>
<div class="avatar"><img src="https://techkampe.github.io/daily-streak/assets/Avatar%203_low.png" alt="" loading="lazy"></div>
<div id="app"></div>
<script>
const urlParams=new URLSearchParams(window.location.search);
const initData=urlParams.get('initData')||'';
const scenes=[
{text:"Zona de andamios: los trabajadores suben material. Observas:",options:["Arn√©s de seguridad colocado","Casco con barboquejo ajustado","Barandillas desmontadas en un lateral","Se√±al de 'Uso obligatorio de EPI'"],correct:2,explanation:"Las barandillas nunca deben retirarse mientras haya trabajo en altura; es un riesgo de ca√≠da grave."},
{text:"Almac√©n de herramientas al final del turno:",options:["Martillos y llaves ordenados en estantes","Cables el√©ctricos enrollados correctamente","Escalera apoyada sobre sacos de cemento","Extintores accesibles y se√±alizados"],correct:2,explanation:"Apoyar escaleras sobre superficies inestables puede provocar ca√≠das. Siempre debe estar en suelo firme y nivelado."},
{text:"Trabajador cortando azulejos con radial:",options:["Gafas de protecci√≥n puestas","Guantes anticorte en ambas manos","Protector auditivo colocado","Sin mascarilla FFP2 (polvo visible)"],correct:3,explanation:"El polvo de cer√°mica es muy perjudicial para las v√≠as respiratorias; la mascarilla FFP2 es obligatoria en este tipo de cortes."},
{text:"Entrada a la obra por la ma√±ana:",options:["Cartel con normas de PRL en la puerta","Cono de se√±alizaci√≥n en el acceso","Caja de herramientas bloqueando el paso","Extintor junto a la caseta de obra"],correct:2,explanation:"Bloquear zonas de paso con material genera riesgo de tropiezos y dificulta evacuaciones en caso de emergencia."},
{text:"Instalaci√≥n el√©ctrica provisional en planta baja:",options:["Cuadro el√©ctrico con tapa cerrada","Enchufes con toma de tierra","Cables pelados sin protecci√≥n sujetos con cinta","Interruptor diferencial activado"],correct:2,explanation:"Los cables pelados sin protecci√≥n pueden causar electrocuci√≥n; siempre deben ir enfundados o protegidos con canaletas."}
];
let currentScene=0;
let userAnswers=[];
let gameStarted=false;
function render(){
const app=document.getElementById('app');
if(!gameStarted){
app.innerHTML=`<div class="modal"><div class="modal-content"><h1>üöß ¬°Ojo Avizor en la Obra!</h1><p>Est√°s en tu primer d√≠a como ayudante. En cada escena ver√°s 3-4 elementos: toca el que representa un riesgo o error de seguridad.</p><button class="btn" onclick="startGame()">Comenzar</button></div></div>`;
}else if(currentScene<scenes.length){
const scene=scenes[currentScene];
app.innerHTML=`<div class="scene"><div class="game-container"><div class="hud"><div class="progress">${currentScene+1}/5</div></div><div class="scene-text"><p>${scene.text}</p></div><div class="options">${scene.options.map((opt,i)=>`<button class="option-btn" onclick="selectOption(${i})">${opt}</button>`).join('')}</div></div></div>`;
setTimeout(ensureFits,50);
}else{
showResults();
}
}
function startGame(){
gameStarted=true;
render();
}
function selectOption(index){
const scene=scenes[currentScene];
userAnswers.push(index);
document.querySelectorAll('.option-btn')[index].classList.add('selected');
setTimeout(()=>{
currentScene++;
render();
},600);
}
function showResults(){
document.body.classList.add('results-view');
let correct=0;
let html='<div class="results-container"><div class="logo"><img src="https://techkampe.github.io/daily-streak/assets/kampe_logo_oscuro.png" alt="K√§mpe"></div><h1 style="margin:20px 0 24px;font-size:clamp(1.5rem,5.5vw,2rem);color:#1A1B2F">üìã Resultados</h1>';
scenes.forEach((sc,i)=>{
const isCorrect=userAnswers[i]===sc.correct;
if(isCorrect)correct++;
html+=`<div class="result-item ${isCorrect?'correct':'incorrect'}"><h3>Escena ${i+1}</h3><p><span class="label">Tu elecci√≥n:</span> ${sc.options[userAnswers[i]]}</p>`;
if(!isCorrect){
html+=`<p><span class="label">Correcto:</span> ${sc.options[sc.correct]}</p>`;
}
html+=`<p style="margin-top:8px">${sc.explanation}</p></div>`;
});
html+=`<div class="advice-box"><h3>üí° Consejo del experto</h3><p>La seguridad en obra depende de tu atenci√≥n al detalle. Revisa siempre EPIs, se√±alizaci√≥n y zonas de paso antes de empezar cualquier tarea.</p></div><p style="text-align:center;font-size:clamp(1.1rem,4.5vw,1.3rem);font-weight:700;color:#1A1B2F;margin-bottom:12px">Has detectado ${correct} de 5 riesgos</p><button class="btn final-btn" onclick="goToReward()">Ver mi recompensa</button>`;
if(!initData){
html+=`<p class="warning">‚ö†Ô∏è No se detect√≥ initData. La recompensa puede no funcionar correctamente.</p>`;
}
html+=`</div>`;
document.getElementById('app').innerHTML=html;
}
function goToReward(){
const url=`https://kampe-game-phaser.onrender.com/daily_streak?initData=${encodeURIComponent(initData)}`;
window.location.href=url;
}
function ensureFits(){
const scene=document.querySelector('.scene');
if(!scene)return;
if(scene.scrollHeight>scene.clientHeight+5){
scene.classList.add('compact');
setTimeout(()=>{
if(scene.scrollHeight>scene.clientHeight+5){
const scale=Math.max(0.88,scene.clientHeight/scene.scrollHeight);
scene.style.setProperty('--ui-scale',scale);
scene.style.transform=`scale(${scale})`;
scene.style.transformOrigin='top center';
}
},50);
}
}
window.addEventListener('resize',()=>{
if(gameStarted&&currentScene<scenes.length){
setTimeout(ensureFits,100);
}
});
window.addEventListener('orientationchange',()=>{
if(gameStarted&&currentScene<scenes.length){
setTimeout(ensureFits,200);
}
});
render();
</script>
</body>
</html>

