
<!DOCTYPE html>
<html lang="es" class="gameplay">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>ğŸ—£ï¸ Tu primera llamada al cliente - KÃ¤mpe Games</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@500;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://techkampe.github.io/daily-streak/assets/css/daily_tasks.css">
</head>
<body>
<div class="scene gameplay" id="scene">
<div class="hud">
<div class="hud-titles">
<div class="brand">ğŸ—£ï¸ Tu primera llamada</div>
<div class="subtitle" id="subtitle">Gestiona tu primera llamada con un cliente</div>
</div>
<div class="progress-row">
<div class="bar-wrap">
<span class="bar-label">Progreso</span>
<div class="bar"><i id="progress-bar" style="width:0%"></i></div>
</div>
<span class="badge" id="turn-badge">0/5</span>
</div>
</div>
<div class="main" id="main-area">
<div class="chat-container" id="chat-container"></div>
</div>
<div class="footer" id="footer">
<div class="helper" id="helper">Tu mentor observa cÃ³mo gestionas la llamada</div>
<div class="options" id="options"></div>
</div>
</div>
<img class="avatar" src="https://techkampe.github.io/daily-streak/assets/Avatar%201_low.png" alt="" loading="lazy">
<script>
const avatars={
mentor:{name:"Carlos (Mentor)",img:"https://techkampe.github.io/daily-streak/assets/Avatar%201_low.png"},
cliente:{name:"Sra. GarcÃ­a",img:"https://techkampe.github.io/daily-streak/assets/Avatar%204_low.png"},
player:{name:"TÃº",img:"https://techkampe.github.io/daily-streak/assets/Avatar%202_low.png"}
};

const turns=[
{
messages:[
{from:"mentor",text:"Suena el telÃ©fono. Es tu primera llamada real. Â¡TÃº puedes! ğŸ’ª"},
{from:"cliente",text:"Â¿Hola? Llamo porque mi caldera no enciende y hace mucho frÃ­o..."}
],
options:[
{text:"Buenos dÃ­as, soy tÃ©cnico de KÃ¤mpe. Â¿En quÃ© puedo ayudarle?",score:2,reaction:"cliente",reactionText:"Ah, quÃ© bien. Pues mire, la caldera no arranca..."},
{text:"SÃ­, dÃ­game, Â¿quÃ© pasa?",score:1,reaction:"cliente",reactionText:"Pues... que la caldera no funciona, Â¿me pueden ayudar?"},
{text:"Ahora mismo estoy ocupado, Â¿puede llamar luego?",score:0,reaction:"cliente",reactionText:"Â¿CÃ³mo? Pero si llevo esperando..."}
]
},
{
messages:[
{from:"cliente",text:"La caldera no enciende desde esta maÃ±ana. Â¿Pueden venir ya?"}
],
options:[
{text:"Entiendo. Â¿Puede ver si hay luz en el piloto o display?",score:2,reaction:"cliente",reactionText:"Espere... No, no veo ninguna lucecita encendida."},
{text:"Â¿Ha probado a apagarla y encenderla?",score:1,reaction:"cliente",reactionText:"SÃ­, varias veces, pero nada..."},
{text:"Uf, eso suena grave. Igual hay que cambiarla.",score:0,reaction:"cliente",reactionText:"Â¿Cambiarla? Â¡Pero si es nueva!"}
]
},
{
messages:[
{from:"cliente",text:"Â¿Y cuÃ¡ndo pueden venir? Es que tengo mucho frÃ­o y niÃ±os en casa..."}
],
options:[
{text:"DÃ©jeme consultar agenda. Le confirmo hora en 10 minutos.",score:2,reaction:"cliente",reactionText:"Vale, perfecto. EsperarÃ© su llamada entonces."},
{text:"Intentaremos ir hoy, pero no le prometo nada.",score:1,reaction:"cliente",reactionText:"Bueno... avÃ­senme cuando sepan algo."},
{text:"Hoy es imposible, tendrÃ¡ que esperar a maÃ±ana.",score:0,reaction:"cliente",reactionText:"Â¿MaÃ±ana? Â¡Pero hace muchÃ­simo frÃ­o!"}
]
},
{
messages:[
{from:"cliente",text:"Â¿Y mÃ¡s o menos cuÃ¡nto me va a costar la reparaciÃ³n?"}
],
options:[
{text:"Hasta ver la caldera no puedo darle precio exacto.",score:2,reaction:"cliente",reactionText:"Entiendo, tiene sentido. Gracias por ser honesto."},
{text:"Depende, pero seguro que no serÃ¡ muy caro.",score:1,reaction:"cliente",reactionText:"Bueno, esperemos que no..."},
{text:"Estas cosas salen caras, prepÃ¡rese para el susto.",score:0,reaction:"cliente",reactionText:"Vaya... quÃ© desastre de dÃ­a."}
]
},
{
messages:[
{from:"cliente",text:"Vale, entonces espero su llamada. Â¿Algo mÃ¡s que deba saber?"}
],
options:[
{text:"No toque nada. Le llamo en breve. Â¡Que no cunda el pÃ¡nico!",score:2,reaction:"mentor",reactionText:"Â¡Muy bien! Profesional y cercano. Buen trabajo ğŸ‘"},
{text:"No, eso es todo. AdiÃ³s.",score:1,reaction:"mentor",reactionText:"Correcto, pero podrÃ­as haber sido mÃ¡s cÃ¡lido al despedirte."},
{text:"Pues nada, ya veremos quÃ© pasa.",score:0,reaction:"mentor",reactionText:"Eso no transmite confianza al cliente..."}
]
}
];

let currentTurn=0,answers=[],chatHistory=[];
const scene=document.getElementById('scene'),chatContainer=document.getElementById('chat-container'),optionsEl=document.getElementById('options'),helperEl=document.getElementById('helper'),progressBar=document.getElementById('progress-bar'),turnBadge=document.getElementById('turn-badge'),subtitleEl=document.getElementById('subtitle');

function addMessage(from,text,isPlayer=false){
const msg=document.createElement('div');
msg.className='chat-msg'+(isPlayer?' chat-msg-player':' chat-msg-npc');
const avatar=avatars[from];
msg.innerHTML=`
<div class="chat-avatar"><img src="${avatar.img}" alt="${avatar.name}"></div>
<div class="chat-bubble${isPlayer?' chat-bubble-player':''}">
<div class="chat-name">${avatar.name}</div>
<div class="chat-text">${text}</div>
</div>`;
chatContainer.appendChild(msg);
chatHistory.push({from,text,isPlayer});
chatContainer.scrollTop=chatContainer.scrollHeight;
}

function renderTurn(){
if(currentTurn>=turns.length){showResults();return}
const turn=turns[currentTurn];
turn.messages.forEach(m=>addMessage(m.from,m.text));
progressBar.style.width=((currentTurn)/turns.length*100)+'%';
turnBadge.textContent=`${currentTurn}/5`;
helperEl.textContent='Elige tu respuesta:';
optionsEl.innerHTML=turn.options.map((o,i)=>`<button class="btn-option" onclick="selectOption(${i})">${o.text}</button>`).join('');
ensureFits();
}

function selectOption(idx){
const turn=turns[currentTurn];
const opt=turn.options[idx];
answers.push({turn:currentTurn+1,chosen:opt.text,score:opt.score,maxScore:2});
addMessage('player',opt.text,true);
optionsEl.innerHTML='';
helperEl.textContent='...';
setTimeout(()=>{
addMessage(opt.reaction,opt.reactionText);
currentTurn++;
setTimeout(()=>{
if(currentTurn<turns.length){
renderTurn();
}else{
progressBar.style.width='100%';
turnBadge.textContent='5/5';
helperEl.textContent='Â¡Llamada completada!';
setTimeout(showResults,800);
}
},600);
},500);
}

function showResults(){
setTimeout(()=>{
document.documentElement.classList.replace('gameplay','results');
scene.classList.replace('gameplay','results');
const totalScore=answers.reduce((a,b)=>a+b.score,0);
const maxScore=answers.length*2;
const pct=Math.round((totalScore/maxScore)*100);
let rating='';
if(pct>=80)rating='Â¡Excelente comunicaciÃ³n! ğŸŒŸ';
else if(pct>=60)rating='Buen trabajo, sigue mejorando ğŸ‘';
else rating='Necesitas practicar mÃ¡s ğŸ’ª';
const feedbackTexts=[
['Saludo profesional que genera confianza.','Saludo correcto pero mejorable.','Evita rechazar llamadas, transmite mala imagen.'],
['Pregunta tÃ©cnica clave para diagnÃ³stico.','Pregunta bÃ¡sica pero Ãºtil.','No alarmes al cliente sin informaciÃ³n.'],
['Compromiso realista y profesional.','Respuesta vaga que genera incertidumbre.','Negativa directa que frustra al cliente.'],
['Honestidad sobre presupuesto sin prometer.','Respuesta ambigua sobre costes.','Generar alarma innecesaria sobre precio.'],
['Despedida cÃ¡lida y profesional.','Despedida correcta pero frÃ­a.','Cierre poco profesional.']
];
scene.innerHTML=`
<div class="results-scroll">
<div class="results-header">
<div class="results-title">${rating}</div>
<div class="results-score">${totalScore}/${maxScore}</div>
<div class="results-subtitle">PuntuaciÃ³n en comunicaciÃ³n</div>
</div>
<div class="results-list">
${answers.map((a,i)=>`
<div class="result-item ${a.score===2?'correct':a.score===1?'':'incorrect'}">
<div class="result-question">Turno ${a.turn}</div>
<div class="result-answer">${a.score===2?'âœ“ Ã“ptimo':a.score===1?'â— Mejorable':'âœ— Inadecuado'}</div>
<div class="result-explanation">${feedbackTexts[i][2-a.score]}</div>
</div>`).join('')}
</div>
<div class="result-item">
<div class="result-question">ğŸ’¡ Consejo prÃ¡ctico</div>
<div class="result-explanation">Prepara un guion mental: saludo â†’ escucha â†’ preguntas tÃ©cnicas â†’ compromiso realista â†’ despedida cÃ¡lida.</div>
</div>
<div class="footer">
<button class="cta" onclick="completeTask()">Ver mi recompensa</button>
</div>
</div>`;
},500);
}

function completeTask(){
if(window.ReactNativeWebView){
window.ReactNativeWebView.postMessage(JSON.stringify({action:'TASK_COMPLETED'}));
}
}

function ensureFits(){
scene.classList.remove('compact','compact-xs');
document.documentElement.style.setProperty('--ui-scale',1);
if(scene.scrollHeight>scene.clientHeight)scene.classList.add('compact');
if(scene.scrollHeight>scene.clientHeight)scene.classList.add('compact-xs');
if(scene.scrollHeight>scene.clientHeight){
document.documentElement.style.setProperty('--ui-scale',Math.max(0.88,scene.clientHeight/scene.scrollHeight));
}
}

function showIntro(){
const modal=document.createElement('div');
modal.className='modal-backdrop active';
modal.id='intro-modal';
modal.innerHTML=`
<div class="modal">
<div class="modal-title">ğŸ—£ï¸ Tu primera llamada</div>
<div class="modal-body">Tu mentor observa mientras gestionas una llamada de un cliente con problemas en su caldera. Â¡Demuestra tu profesionalidad!</div>
<div class="modal-actions">
<button class="cta" onclick="startGame()">Comenzar</button>
</div>
</div>`;
document.body.appendChild(modal);
}

function startGame(){
document.getElementById('intro-modal').remove();
renderTurn();
}

window.addEventListener('load',()=>{ensureFits();showIntro();});
window.addEventListener('resize',ensureFits);
window.addEventListener('orientationchange',()=>setTimeout(ensureFits,100));
</script>
</body>
</html>
