<!DOCTYPE html><html lang="es"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/><title>El Orden del Electricista ⚡️</title><link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@500;700&display=swap" rel="stylesheet"/><style>
:root{--bg:#FFFFFF;--text:#1A1B2F;--turq:#00E6BC;--blue:#0B214A;--ok:#04FFB4;--err:#F9577E;--soft:#C5FFDF;--cardH:64px;--gap:10px;--ui-scale:1}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:"Baloo 2",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;overflow:hidden;overscroll-behavior:none}
button{font-family:inherit}
h1,h2,h3,p{margin:0}
.app{position:relative;isolation:isolate}
.avatar-bg{position:absolute;inset:auto -16px -16px auto;width:min(58vw,330px);opacity:.12;pointer-events:none;z-index:0;transform:translateY(10px)}
.scene{position:relative;display:grid;grid-template-rows:auto 1fr auto;gap:8px;transform:scale(var(--ui-scale));transform-origin:top center;padding:16px;padding-left: max(16px,env(safe-area-inset-left));padding-right:calc(max(16px,env(safe-area-inset-right))+100px);padding-top:calc(16px + env(safe-area-inset-top) + 80px);padding-bottom:calc(12px + env(safe-area-inset-bottom));}
@supports(height:100svh){.scene{height:100svh}}
@supports not (height:100svh){@supports(height:100dvh){.scene{height:100dvh}}}
@supports not (height:100dvh){.scene{height:100vh}}
.hud{display:flex;align-items:center;justify-content:space-between;gap:8px}
.brand{font-weight:700;font-size:clamp(16px,4.6vw,20px);letter-spacing:.2px}
.progress{display:flex;align-items:center;gap:8px}
.badge{background:#C5FFDF;color:#0B214A;border-radius:12px;padding:6px 10px;font-size:13px;line-height:1}
.bar{width:86px;height:8px;background:#E9FBF4;border-radius:6px;overflow:hidden;border:1px solid var(--turq)}
.bar>i{display:block;height:100%;background:linear-gradient(90deg,var(--turq),#04FFB4);width:0%}
.subtitle{font-size:clamp(14px,4.3vw,16px);opacity:.9}
.board{position:relative;display:flex;flex-direction:column;gap:var(--gap);touch-action:none;z-index:1}
.card{display:grid;grid-template-columns:36px 1fr 92px;align-items:center;gap:8px;height:var(--cardH);padding:8px 10px;border:1px solid var(--turq);border-radius:14px;background:#fff;box-shadow:0 1px 0 rgba(0,0,0,.02);transition:transform .14s ease}
.card.bump{animation:bump .18s}
@keyframes bump{50%{transform:scale(.98)}}
.step-num{width:28px;height:28px;display:grid;place-items:center;background:#E9FBF4;border:1px solid var(--turq);color:var(--turq);border-radius:50%;font-size:14px}
.step-text{font-size:clamp(14px,4.2vw,16px);line-height:1.15;display:-webkit-box;-webkit-line-clamp:2;line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.ctrls{display:flex;gap:6px;justify-content:flex-end}
.btn-ghost{min-width:44px;min-height:44px;background:#fff;border:1px solid var(--turq);border-radius:14px;color:var(--blue);display:inline-grid;place-items:center;font-size:18px}
.btn-ghost:active{transform:translateY(1px)}
.footer{display:flex;align-items:center;justify-content:space-between;gap:10px}
.cta{flex:1;min-height:48px;background:var(--blue);color:var(--turq);border:none;border-radius:24px;font-weight:700;font-size:clamp(16px,4.8vw,18px);box-shadow:0 8px 18px rgba(11,33,74,.25)}
.cta[disabled]{opacity:.45;box-shadow:none}
.cta.buzz{animation:buzz .18s}
@keyframes buzz{20%{transform:translateX(-1px)}40%{transform:translateX(1px)}60%{transform:translateX(-1px)}80%{transform:translateX(1px)}}
.helper{font-size:12px;color:#0B214A;background:#C5FFDF;border-radius:12px;padding:6px 8px}
.modal{position:fixed;inset:0;background:rgba(26,27,47,.54);display:flex;align-items:center;justify-content:center;z-index:50;padding:16px}
.modal>.sheet{width:min(720px,94vw);max-height:90svh;background:#fff;border:1px solid var(--turq);border-radius:16px;padding:18px 16px;overflow-y:auto}
.sheet h2{font-size:clamp(18px,5.2vw,22px)}
.sheet p{margin-top:8px;font-size:15px;opacity:.95}
.sheet .info{margin-top:10px;background:#C5FFDF;border-radius:12px;padding:10px 12px;color:#0B214A}
.sheet .actions{margin-top:12px;display:flex;gap:10px}
.sheet .actions .cta{flex:1}
.compact .brand{font-size:clamp(14px,4vw,16px)}
.compact .subtitle{display:none}
.compact .card{grid-template-columns:30px 1fr 82px}
.compact .btn-ghost{min-width:40px;min-height:40px}
.compact .helper{display:none}
.hide{display:none!important}
.results{display:none}
.results.on{display:block}
.results .seq{border:1px solid var(--turq);border-radius:14px;padding:12px;margin-top:12px}
.results h3{font-size:18px;margin-bottom:6px}
.pair{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.list{border:1px dashed #C5FFDF;border-radius:12px;padding:8px}
.li{display:flex;align-items:center;gap:6px;padding:6px 8px;border-radius:10px;background:#fff;border:1px solid #E9FBF4}
.li i{width:22px;height:22px;border:1px solid var(--turq);border-radius:50%;display:grid;place-items:center;font-size:12px;color:var(--turq)}
.tag-ok{color:#0B214A;background:#C5FFDF;border-radius:8px;padding:4px 8px;font-size:12px}
.tag-err{color:#fff;background:#F9577E;border-radius:8px;padding:4px 8px;font-size:12px}
.results .tip{margin-top:12px;background:#C5FFDF;border-radius:12px;padding:10px;color:#0B214A}
.results .final{position:sticky;bottom:0;background:#fff;padding:12px 0}
a,button:focus-visible{outline:2px dashed var(--turq);outline-offset:2px}
</style></head><body><div class="app">
<img class="avatar-bg" src="https://techkampe.github.io/daily-streak/assets/Avatar 3_low.png" alt="Avatar Kämpe" loading="lazy"/>
<div class="scene" id="scene">
  <div class="hud">
    <div class="brand">El Orden del Electricista ⚡️</div>
    <div class="progress">
      <span class="badge" id="badge">Reto 1/3</span>
      <div class="bar" aria-hidden="true"><i id="bar"></i></div>
    </div>
  </div>
  <div>
    <div class="subtitle" id="seqTitle">Ordena los pasos del corte seguro</div>
    <div class="board" id="board" aria-live="polite"></div>
  </div>
  <div class="footer">
    <span class="helper" id="helper">Usa ↑/↓ para ordenar. Luego confirma.</span>
    <button class="cta" id="confirmBtn" aria-label="Confirmar orden">Confirmar orden</button>
  </div>
</div>

<div class="modal" id="intro">
  <div class="sheet">
    <h2>El Orden del Electricista ⚡️</h2>
    <p>Estás en tu primer día de prácticas y te toca una tarea básica pero crucial: cambiar un interruptor de luz defectuoso. ¡La seguridad es lo primero! Ordena los pasos correctos en 3 secuencias.</p>
    <div class="info">Tip rápido: Usa ↑/↓ para mover cada paso. También puedes tocar el número del paso para guiarte mentalmente. Pulsa Confirmar.</div>
    <div class="actions"><button class="cta" id="start">Empezar</button></div>
  </div>
</div>

<div class="results" id="results">
  <div class="sheet" style="max-width:880px;margin:0 auto;padding:16px">
    <h2>Resumen del reto</h2>
    <p style="margin-top:6px">Así quedó tu orden vs el correcto. Lee por qué importa y aplica el consejo.</p>
    <div id="resContainer"></div>
    <div class="tip">Consejo: Nunca confíes en el solo hecho de “bajé el magneto”. Verifica ausencia de tensión con método de 3 puntos y bloquea/etiqueta antes de tocar.</div>
    <div class="final">
      <button class="cta" onclick="completeTask()">Ver mi recompensa</button>
    </div>
  </div>
</div>
</div>
<script>
function completeTask(){if(window.ReactNativeWebView){window.ReactNativeWebView.postMessage(JSON.stringify({action:'TASK_COMPLETED'}));}}
const sequences=[{name:"Corte seguro de corriente",steps:["Avisar a todos del trabajo eléctrico","Identificar el circuito del interruptor","Abrir el magnetotérmico del circuito","Bloquear y señalizar el corte (LOTO)"],explain:"Primero comunica, luego identifica el circuito, corta la energía y finalmente bloquea/señaliza para evitar reenergizaciones."},{name:"Verificación de ausencia de tensión",steps:["Probar el medidor en un punto con tensión","Medir fase‑neutro en el interruptor","Medir fase‑tierra en el interruptor","Reprobar el medidor en punto con tensión"],explain:"Verifica el comprobador antes y después (3 puntos) y mide fase-neutro y fase-tierra para confirmar cero voltios."},{name:"Rearme y comprobación final",steps:["Retirar bloqueo y señalización","Rearmar el magnetotérmico","Probar el nuevo interruptor","Informar y registrar la intervención"],explain:"Retira LOTO solo al finalizar, rearma, prueba el funcionamiento y deja registro para trazabilidad y seguridad."}];
let current=0,orders=[],playerOrders=[];
function clampText(s,lim=48){return s.length>lim?s.slice(0,lim-1)+"…":s}
function shuffle(a){return a.map((v,i)=>[Math.random(),i]).sort((x,y)=>x[0]-y[0]).map(p=>p[1])}
function render(){const sc=document.getElementById('scene');const seq=sequences[current];document.getElementById('badge').textContent=`Reto ${current+1}/3`;document.getElementById('bar').style.width=`${((current)/3)*100}%`;document.getElementById('seqTitle').textContent=`Ordena los pasos: ${seq.name}`;const board=document.getElementById('board');board.innerHTML='';orders[current]||(orders[current]=shuffle(seq.steps));orders[current].forEach((idx,pos)=>{const card=document.createElement('div');card.className='card';card.setAttribute('role','group');card.setAttribute('aria-label',`Paso ${pos+1}`);const num=document.createElement('div');num.className='step-num';num.textContent=pos+1;const txt=document.createElement('div');txt.className='step-text';txt.textContent=clampText(seq.steps[idx]);const ctr=document.createElement('div');ctr.className='ctrls';const up=document.createElement('button');up.className='btn-ghost';up.setAttribute('aria-label','Subir paso');up.innerHTML='↑';up.onclick=()=>move(idx,-1);const dn=document.createElement('button');dn.className='btn-ghost';dn.setAttribute('aria-label','Bajar paso');dn.innerHTML='↓';dn.onclick=()=>move(idx,1);ctr.appendChild(up);ctr.appendChild(dn);card.appendChild(num);card.appendChild(txt);card.appendChild(ctr);board.appendChild(card)});ensureFits()}
function move(stepIdx,dir){const arr=orders[current];const pos=arr.indexOf(stepIdx);const np=pos+dir;if(np<0||np>=arr.length)return;[arr[pos],arr[np]]=[arr[np],arr[pos]];microBump();render()}
function microBump(){const board=document.getElementById('board');Array.from(board.children).forEach(el=>{el.classList.remove('bump');requestAnimationFrame(()=>el.classList.add('bump'))})}
function confirm(){const btn=document.getElementById('confirmBtn');btn.classList.add('buzz');setTimeout(()=>btn.classList.remove('buzz'),180);playerOrders[current]=orders[current].slice();if(current<sequences.length-1){current++;render()}else{setTimeout(showResults,500)}}
function showResults(){document.getElementById('bar').style.width='100%';document.getElementById('scene').classList.add('hide');document.querySelector('html').style.overflowY='auto';document.body.style.overflowY='auto';const wrap=document.getElementById('results');const box=document.getElementById('resContainer');box.innerHTML='';sequences.forEach((seq,i)=>{const correct=[...seq.steps.keys()];const ok=JSON.stringify(playerOrders[i])===JSON.stringify(correct);const sec=document.createElement('div');sec.className='seq';const h=document.createElement('h3');h.textContent=seq.name;sec.appendChild(h);const tag=document.createElement('span');tag.className=ok?'tag-ok':'tag-err';tag.textContent=ok?'Perfecto':'Revisa el orden';sec.appendChild(tag);const pair=document.createElement('div');pair.className='pair';const user=document.createElement('div');user.className='list';const corr=document.createElement('div');corr.className='list';playerOrders[i].forEach((idx,ii)=>{const li=document.createElement('div');li.className='li';const dot=document.createElement('i');dot.textContent=ii+1;const t=document.createElement('span');t.textContent=clampText(seq.steps[idx]);li.appendChild(dot);li.appendChild(t);user.appendChild(li)});correct.forEach((idx,ii)=>{const li=document.createElement('div');li.className='li';const dot=document.createElement('i');dot.textContent=ii+1;const t=document.createElement('span');t.textContent=clampText(seq.steps[idx]);li.appendChild(dot);li.appendChild(t);corr.appendChild(li)});pair.appendChild(user);pair.appendChild(corr);sec.appendChild(pair);const why=document.createElement('div');why.className='info';why.textContent=seq.explain;sec.appendChild(why);box.appendChild(sec)});wrap.classList.add('on')}
function assertNoOverflow(){const sc=document.getElementById('scene');return sc.scrollHeight<=sc.clientHeight}
function applyCompactMode(){document.body.classList.add('compact')}
function fitBoardToViewport(){const sc=document.getElementById('scene');const cards=sc.querySelectorAll('.card').length||4;const hudH=sc.querySelector('.hud').getBoundingClientRect().height;const footH=sc.querySelector('.footer').getBoundingClientRect().height;const total=sc.clientHeight;const avail=total-hudH-footH-24;let each=Math.floor(avail/cards)-8;each=Math.max(48,Math.min(70,each));sc.style.setProperty('--cardH',each+'px')}
function autoscaleUI(){const sc=document.getElementById('scene');sc.style.setProperty('--ui-scale','1');if(!assertNoOverflow()){sc.style.setProperty('--ui-scale','.96')}if(!assertNoOverflow()){sc.style.setProperty('--ui-scale','.92')}if(!assertNoOverflow()){sc.style.setProperty('--ui-scale','.88')}}
function ensureFits(){const sc=document.getElementById('scene');if(!sc||sc.classList.contains('hide'))return;document.body.classList.remove('compact');sc.style.setProperty('--ui-scale','1');fitBoardToViewport();if(!assertNoOverflow()){applyCompactMode();fitBoardToViewport()}autoscaleUI()}
document.getElementById('confirmBtn').onclick=confirm;
document.getElementById('start').onclick=()=>{document.getElementById('intro').classList.add('hide');render()};
window.addEventListener('resize',ensureFits,{passive:true});window.addEventListener('orientationchange',()=>setTimeout(ensureFits,120));
render();
</script></body></html>