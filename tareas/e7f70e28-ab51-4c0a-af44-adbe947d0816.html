
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no">
<title>EPIs: ¬øCheck o Next? ü§î - K√§mpe</title>
<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;800&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{width:100%;overflow:hidden;overscroll-behavior:none;font-family:'Baloo 2',sans-serif;background:#F5F5F0;color:#1A1B2F}
@supports(height:100svh){.scene{height:100svh}}
@supports not(height:100svh){.scene{height:100dvh}}
@supports not(height:100dvh){.scene{height:100vh}}
.scene{width:100%;display:flex;flex-direction:column;position:relative;padding:env(safe-area-inset-top,0) env(safe-area-inset-right,0) env(safe-area-inset-bottom,0) env(safe-area-inset-left,0)}
.avatar-bg{position:absolute;bottom:-5%;right:-5%;width:50%;height:50%;background:url('https://techkampe.github.io/daily-streak/assets/Avatar%202_low.png') no-repeat bottom right/contain;opacity:0.15;pointer-events:none;z-index:0}
.logo{position:absolute;top:max(env(safe-area-inset-top,0),12px);left:max(env(safe-area-inset-left,0),16px);width:90px;height:auto;z-index:10}
.modal-overlay{position:fixed;inset:0;background:rgba(26,27,47,0.85);display:flex;align-items:center;justify-content:center;z-index:100;padding:20px}
.modal{background:#fff;border-radius:24px;box-shadow:0 8px 32px rgba(0,0,0,0.2);max-width:420px;width:100%;max-height:90svh;overflow-y:auto;padding:28px 24px;position:relative}
.modal h2{font-size:clamp(1.4rem,5vw,1.8rem);font-weight:800;color:#1A1B2F;margin-bottom:12px;line-height:1.2}
.modal p{font-size:clamp(0.95rem,3.5vw,1.05rem);color:#4A4A68;line-height:1.5;margin-bottom:20px}
.btn{display:inline-block;background:linear-gradient(135deg,#1EA4FF,#007BFF);color:#fff;border:none;border-radius:12px;padding:14px 28px;font-size:clamp(1rem,4vw,1.1rem);font-weight:700;font-family:'Baloo 2',sans-serif;cursor:pointer;box-shadow:0 4px 12px rgba(30,164,255,0.3);transition:transform 0.2s,box-shadow 0.2s;min-height:48px;touch-action:manipulation}
.btn:active{transform:scale(0.97);box-shadow:0 2px 8px rgba(30,164,255,0.4)}
.btn-full{width:100%}
.gameplay{flex:1;display:flex;flex-direction:column;padding:max(env(safe-area-inset-top,0),80px) max(env(safe-area-inset-right,0),20px) max(env(safe-area-inset-bottom,0),20px) max(env(safe-area-inset-left,0),20px);position:relative;z-index:1;overflow:hidden}
.hud{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;flex-shrink:0}
.hud.compact{margin-bottom:8px}
.progress{font-size:clamp(0.85rem,3vw,0.95rem);font-weight:600;color:#007BFF}
.card-container{flex:1;display:flex;align-items:center;justify-content:center;position:relative;touch-action:none;min-height:0}
.card{position:absolute;width:min(100%,340px);background:#fff;border-radius:20px;box-shadow:0 8px 24px rgba(0,0,0,0.15);padding:32px 24px;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;cursor:grab;user-select:none;transition:transform 0.3s ease,opacity 0.3s ease;max-height:calc(100% - 20px)}
.card.dragging{cursor:grabbing;transition:none}
.card.swipe-left{transform:translateX(-150vw) rotate(-30deg);opacity:0}
.card.swipe-right{transform:translateX(150vw) rotate(30deg);opacity:0}
.card-text{font-size:clamp(1.05rem,4vw,1.2rem);font-weight:600;color:#1A1B2F;line-height:1.4;display:-webkit-box;-webkit-line-clamp:4;-webkit-box-orient:vertical;overflow:hidden}
.hint{display:flex;justify-content:space-between;width:100%;margin-top:20px;font-size:clamp(0.8rem,3vw,0.9rem);font-weight:600;flex-shrink:0}
.hint-left{color:#FF4757}
.hint-right{color:#2ED573}
.desktop-btns{display:flex;gap:12px;margin-top:16px;flex-shrink:0}
.desktop-btns button{flex:1;min-width:100px;padding:12px 20px;font-size:clamp(0.9rem,3.5vw,1rem)}
@media(min-width:640px){.desktop-btns{display:flex}.hint{display:none}}
@media(max-width:639px){.desktop-btns{display:none}.hint{display:flex}}
.results-scene{display:flex;flex-direction:column;height:auto;min-height:100svh;overflow-y:auto;padding:max(env(safe-area-inset-top,0),100px) max(env(safe-area-inset-right,0),20px) max(env(safe-area-inset-bottom,0),40px) max(env(safe-area-inset-left,0),20px)}
.results-header{text-align:center;margin-bottom:24px}
.results-header h2{font-size:clamp(1.5rem,5vw,2rem);font-weight:800;color:#1A1B2F;margin-bottom:8px}
.results-score{font-size:clamp(1.1rem,4vw,1.3rem);font-weight:600;color:#007BFF}
.results-list{display:flex;flex-direction:column;gap:16px;margin-bottom:28px}
.result-item{background:#fff;border-radius:16px;padding:16px;box-shadow:0 2px 8px rgba(0,0,0,0.08);border-left:4px solid #ccc}
.result-item.correct{border-left-color:#2ED573}
.result-item.incorrect{border-left-color:#FF4757}
.result-question{font-size:clamp(0.95rem,3.5vw,1.05rem);font-weight:700;color:#1A1B2F;margin-bottom:6px;line-height:1.3}
.result-answer{font-size:clamp(0.85rem,3vw,0.95rem);color:#4A4A68;margin-bottom:8px}
.result-explanation{font-size:clamp(0.85rem,3vw,0.95rem);color:#6B6B85;line-height:1.4;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden}
.results-footer{text-align:center}
.results-footer p{font-size:clamp(1rem,4vw,1.1rem);color:#4A4A68;margin-bottom:20px;line-height:1.5}
.compact .hud{font-size:0.8rem}
.compact .card{padding:24px 20px}
.compact .card-text{font-size:clamp(0.95rem,3.5vw,1.05rem)}
@supports not(height:100svh){.scene{height:100vh}.modal{max-height:90vh}.results-scene{min-height:100vh}}
.hidden{display:none!important}
</style>
</head>
<body>
<div class="scene" id="introScene">
<img src="https://techkampe.github.io/daily-streak/assets/kampe_logo_oscuro.png" alt="K√§mpe" class="logo" loading="eager">
<div class="avatar-bg"></div>
<div class="modal-overlay">
<div class="modal">
<h2>EPIs: ¬øCheck o Next? ü§î</h2>
<p>Est√°s en tu primer d√≠a de pr√°cticas en una obra y el jefe de equipo quiere comprobar que controlas lo b√°sico de seguridad.</p>
<p style="margin-bottom:24px"><strong>¬øC√≥mo jugar?</strong><br>Desliza <strong style="color:#FF4757">izquierda</strong> si la acci√≥n es incorrecta o innecesaria.<br>Desliza <strong style="color:#2ED573">derecha</strong> si es segura y obligatoria.</p>
<button class="btn btn-full" onclick="startGame()">¬°Empezar!</button>
</div>
</div>
</div>
<div class="scene hidden" id="gameScene">
<img src="https://techkampe.github.io/daily-streak/assets/kampe_logo_oscuro.png" alt="K√§mpe" class="logo" loading="lazy">
<div class="avatar-bg"></div>
<div class="gameplay">
<div class="hud" id="hud">
<div class="progress" id="progress">Pregunta 1 de 6</div>
</div>
<div class="card-container" id="cardContainer"></div>
<div class="hint">
<span class="hint-left">‚Üê Incorrecta</span>
<span class="hint-right">Correcta ‚Üí</span>
</div>
<div class="desktop-btns">
<button class="btn" style="background:linear-gradient(135deg,#FF4757,#E84118)" onclick="answerCard(false)">‚ùå Incorrecta</button>
<button class="btn" onclick="answerCard(true)">‚úÖ Correcta</button>
</div>
</div>
</div>
<div class="scene results-scene hidden" id="resultsScene">
<img src="https://techkampe.github.io/daily-streak/assets/kampe_logo_oscuro.png" alt="K√§mpe" class="logo" loading="lazy">
<div class="results-header">
<h2>¬°Reto completado! üéâ</h2>
<div class="results-score" id="resultsScore">0 de 6 correctas</div>
</div>
<div class="results-list" id="resultsList"></div>
<div class="results-footer">
<p id="finalMessage">¬°Sigue aprendiendo y protege tu seguridad en el trabajo!</p>
<button class="btn btn-full" id="rewardBtn" onclick="goToReward()">Ver mi recompensa</button>
</div>
</div>
<script>
const cards=[
{text:"Llevar casco en una obra de construcci√≥n",correct:true,explanation:"El casco protege de golpes y ca√≠das de objetos. Es obligatorio en toda obra."},
{text:"Trabajar en altura sin arn√©s de seguridad",correct:false,explanation:"El arn√©s es vital para evitar ca√≠das mortales. Nunca trabajes en altura sin √©l."},
{text:"Usar guantes al manipular materiales con bordes cortantes",correct:true,explanation:"Los guantes protegen tus manos de cortes y abrasiones graves."},
{text:"Soldar sin gafas de protecci√≥n",correct:false,explanation:"La luz de la soldadura puede da√±ar tus ojos permanentemente. Siempre usa gafas."},
{text:"Usar protecci√≥n auditiva en zonas de ruido intenso",correct:true,explanation:"La exposici√≥n prolongada a ruido alto causa p√©rdida auditiva irreversible."},
{text:"Entrar en una zanja sin entibaci√≥n ni protecci√≥n",correct:false,explanation:"Las zanjas pueden colapsar en segundos. Requieren entibaci√≥n y protecci√≥n adecuada."}
];
let currentIndex=0,answers=[],startX=0,currentX=0,isDragging=false,initData="";
function getInitData(){const params=new URLSearchParams(window.location.search);return params.get('initData')||""}
function startGame(){initData=getInitData();document.getElementById('introScene').classList.add('hidden');document.getElementById('gameScene').classList.remove('hidden');document.body.style.overflow='hidden';renderCard();ensureFits()}
function renderCard(){if(currentIndex>=cards.length){showResults();return}
document.getElementById('progress').textContent=`Pregunta ${currentIndex+1} de ${cards.length}`;const container=document.getElementById('cardContainer');container.innerHTML='';const card=document.createElement('div');card.className='card';card.innerHTML=`<div class="card-text">${cards[currentIndex].text}</div>`;card.addEventListener('mousedown',onStart);card.addEventListener('touchstart',onStart,{passive:false});container.appendChild(card);setTimeout(()=>ensureFits(),50)}
function onStart(e){if(e.type==='touchstart')e.preventDefault();isDragging=true;startX=e.type.includes('mouse')?e.clientX:e.touches[0].clientX;currentX=startX;const card=e.currentTarget;card.classList.add('dragging');const onMove=e.type.includes('mouse')?'mousemove':'touchmove';const onEnd=e.type.includes('mouse')?'mouseup':'touchend';document.addEventListener(onMove,onMoveHandler);document.addEventListener(onEnd,onEndHandler);function onMoveHandler(ev){if(!isDragging)return;currentX=ev.type.includes('mouse')?ev.clientX:ev.touches[0].clientX;const deltaX=currentX-startX;const rotation=deltaX*0.1;card.style.transform=`translateX(${deltaX}px) rotate(${rotation}deg)`;card.style.transition='none'}
function onEndHandler(){if(!isDragging)return;isDragging=false;const deltaX=currentX-startX;document.removeEventListener(onMove,onMoveHandler);document.removeEventListener(onEnd,onEndHandler);if(Math.abs(deltaX)>80){const isRight=deltaX>0;card.classList.remove('dragging');card.classList.add(isRight?'swipe-right':'swipe-left');answers.push(isRight);setTimeout(()=>{currentIndex++;renderCard()},300)}else{card.style.transform='';card.style.transition='transform 0.3s ease';card.classList.remove('dragging')}}}
function answerCard(isCorrect){answers.push(isCorrect);const card=document.querySelector('.card');if(card){card.classList.add(isCorrect?'swipe-right':'swipe-left');setTimeout(()=>{currentIndex++;renderCard()},300)}}
function showResults(){document.getElementById('gameScene').classList.add('hidden');const resultsScene=document.getElementById('resultsScene');resultsScene.classList.remove('hidden');document.body.style.overflow='auto';let correctCount=0;const listHTML=cards.map((card,i)=>{const userAnswer=answers[i];const isCorrect=userAnswer===card.correct;if(isCorrect)correctCount++;return `<div class="result-item ${isCorrect?'correct':'incorrect'}">
<div class="result-question">${card.text}</div>
<div class="result-answer"><strong>Tu respuesta:</strong> ${userAnswer?'Correcta':'Incorrecta'} ${isCorrect?'‚úÖ':'‚ùå'}</div>
<div class="result-explanation">${card.explanation}</div>
</div>`}).join('');document.getElementById('resultsList').innerHTML=listHTML;document.getElementById('resultsScore').textContent=`${correctCount} de ${cards.length} correctas`;const messages=[
"¬°Excelente! Dominas la seguridad en el trabajo.",
"¬°Buen trabajo! Sigue reforzando tus conocimientos.",
"Vas por buen camino. Repasa los EPIs y mejora tu seguridad."
];const msgIndex=correctCount>=5?0:correctCount>=3?1:2;document.getElementById('finalMessage').textContent=messages[msgIndex];const rewardBtn=document.getElementById('rewardBtn');if(!initData){const warning=document.createElement('p');warning.style.cssText='font-size:0.85rem;color:#FF4757;margin-top:8px';warning.textContent='‚ö†Ô∏è No se detect√≥ initData. El enlace puede no funcionar.';rewardBtn.parentElement.appendChild(warning)}}
function goToReward(){window.location.href=`https://kampe-game-phaser.onrender.com/daily_streak?initData=${encodeURIComponent(initData)}`}
function ensureFits(){const gameplay=document.querySelector('.gameplay');if(!gameplay)return;const hud=document.getElementById('hud');if(gameplay.scrollHeight>gameplay.clientHeight){hud.classList.add('compact');setTimeout(()=>{if(gameplay.scrollHeight>gameplay.clientHeight){const scale=Math.max(0.88,gameplay.clientHeight/gameplay.scrollHeight);gameplay.style.transform=`scale(${scale})`;gameplay.style.transformOrigin='top center'}},50)}}
window.addEventListener('resize',()=>{if(!document.getElementById('gameScene').classList.contains('hidden'))ensureFits()});window.addEventListener('orientationchange',()=>{setTimeout(()=>{if(!document.getElementById('gameScene').classList.contains('hidden'))ensureFits()},200)});initData=getInitData();
</script>
</body>
</html>

